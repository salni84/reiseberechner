import * as tslib_1 from "tslib";
import DomElement from "../DomElement";
import { searchAndInitialize } from "../Utils";
import { removeAllChildren, tryGetData, isColor } from "./ChartFunctions";
import anime from "animejs";
var QUERY_CHART = ".js-chart";
var QUERY_LEGEND = ".js-legend";
var DASH_SEPARATOR_WIDTH = 3;
var ANIMATION_DURATION = 1500;
var ANIMATION_DURATION_LEGEND = 500;
var QUERY_META_TITLE = ".meta .title";
var QUERY_META_SUBTITLE = ".meta .subtitle";
/**
 * Pie Chart Component.
 */
var PieChart = /** @class */ (function (_super) {
    tslib_1.__extends(PieChart, _super);
    /**
     * Creates and initializes the Pie Chart component.
     * @param {DomElement} - root element of the chart.
     * @param {Array} - pie chart data definitions.
     */
    function PieChart(element, data) {
        var _this = _super.call(this, element) || this;
        if (data) {
            _this._data = data;
        }
        _this._initialize();
        return _this;
    }
    PieChart.prototype._initialize = function () {
        this._chart = this.element.querySelector(QUERY_CHART);
        this._legend = this.element.querySelector(QUERY_LEGEND);
        this._title = this.element.querySelector(QUERY_META_TITLE);
        this._subtitle = this.element.querySelector(QUERY_META_SUBTITLE);
        this._unit = this.getAttribute("data-unit") || "";
        this._alwaysShowLegend = this.element.hasAttribute("data-always-show-legend");
        if (!this._data) {
            this._data = tryGetData(this.element);
        }
        this._render();
    };
    PieChart.prototype._render = function () {
        var total = this._data.reduce(function (a, b) { return a + b.value; }, 0);
        var r = 16;
        var dashTotal = (2 * r * Math.PI);
        var currentRotate = 9;
        // Cleanup
        removeAllChildren(this._chart);
        if (this._legend) {
            removeAllChildren(this._legend);
        }
        var percentageAdjustTotal = 0;
        var percentageAdjust = 0;
        var separatorPercentage = DASH_SEPARATOR_WIDTH / 100;
        for (var i = 0; i < this._data.length; i++) {
            var entry = this._data[i];
            var percentage = entry.value / total;
            if (percentage < separatorPercentage) {
                percentageAdjustTotal += (separatorPercentage - percentage);
                percentageAdjust++;
            }
        }
        if (percentageAdjust > 0) {
            percentageAdjust = percentageAdjustTotal / (this._data.length - percentageAdjust);
        }
        var animations = anime.timeline();
        var animationOffset = 0;
        var _loop_1 = function (i) {
            var entry = this_1._data[i];
            var displayPercentage = entry.value / total;
            var percentage = Math.max(separatorPercentage, displayPercentage - percentageAdjust);
            var dashWidth = (percentage * dashTotal) - DASH_SEPARATOR_WIDTH;
            var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("viewBox", "0 0 34 34");
            svg.setAttribute("role", "img");
            svg.setAttribute("aria-labelledby", "title desc");
            var title = document.createElementNS("http://www.w3.org/2000/svg", "title");
            title.setAttribute("id", "title");
            title.innerHTML = "Pie chart segment " + Math.floor(displayPercentage * 100) + "%";
            var description = document.createElementNS("http://www.w3.org/2000/svg", "desc");
            description.setAttribute("id", "desc");
            description.innerHTML = entry.title + ": " + entry.value;
            var circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute("cx", "17");
            circle.setAttribute("cy", "17");
            circle.setAttribute("r", String(r));
            if (isColor(entry.color) === true) {
                circle.setAttribute("stroke", "" + entry.color);
            }
            else {
                circle.setAttribute("class", entry.color);
            }
            circle.setAttribute("role", "presentation");
            svg.setAttribute("style", "transform: rotate(" + currentRotate + "deg);");
            svg.appendChild(title);
            svg.appendChild(description);
            svg.appendChild(circle);
            this_1._chart.appendChild(svg);
            var animationDuration = ANIMATION_DURATION * percentage;
            circle.style.display = "none";
            var counter = { var: 0.5 };
            animations.add({
                targets: counter,
                var: dashWidth,
                begin: function () {
                    circle.style.display = "";
                },
                update: function () {
                    circle.setAttribute("stroke-dasharray", counter.var + " " + dashTotal);
                },
                duration: animationDuration,
                easing: "easeInQuint"
            });
            // Legend
            if (this_1._legend && (this_1._data.length > 1) || this_1._alwaysShowLegend) {
                var bullet = new DomElement("span")
                    .addClass("bullet");
                if (isColor(entry.color) === true) {
                    bullet.setAttribute("style", "background-color: " + entry.color);
                }
                else {
                    bullet.addClass(entry.color);
                }
                var caption = new DomElement("span");
                var captionElement = caption.element;
                captionElement.innerText = entry.title;
                var legendItem = new DomElement("li")
                    .appendChild(bullet)
                    .appendChild(caption);
                this_1._legend.appendChild(legendItem.element);
                this_1._animateLegend(legendItem.element, animationOffset);
            }
            animationOffset += animationDuration;
            currentRotate += (360 * percentage);
            if (i === this_1._data.length - 1) {
                this_1._title.innerHTML = entry.value + " " + this_1._unit;
                this_1._subtitle.innerHTML = entry.title;
            }
        };
        var this_1 = this;
        for (var i = 0; i < this._data.length; i++) {
            _loop_1(i);
        }
    };
    PieChart.prototype._animateLegend = function (legendItem, animationOffset) {
        legendItem.style.opacity = "0";
        anime({
            targets: legendItem,
            duration: ANIMATION_DURATION_LEGEND,
            opacity: 1,
            easing: "easeInOutQuint",
            delay: animationOffset,
            complete: function () {
                legendItem.style.opacity = null;
            }
        });
    };
    /**
     * Updates the pie chart with the specified data definitions.
     * @param {Array} - pie chart data definitions.
     */
    PieChart.prototype.update = function (data) {
        if (data) {
            this._data = data;
        }
        this._render();
    };
    /**
     * Removes all event handlers and clears references.
     */
    PieChart.prototype.destroy = function () {
        this._data = undefined;
        this._title = undefined;
        this._subtitle = undefined;
        this._unit = undefined;
        removeAllChildren(this._chart);
        this._chart = undefined;
        if (this._legend) {
            removeAllChildren(this._legend);
            this._legend = undefined;
        }
    };
    /**
     * @deprecated use destroy() instead.
     * @todo remove in version 2.0.0
     */
    PieChart.prototype.destory = function () {
        this.destroy();
    };
    return PieChart;
}(DomElement));
export function init() {
    searchAndInitialize(".pie-chart", function (e) {
        new PieChart(e);
    });
}
export default PieChart;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4vc3JjL2NoYXJ0cy9QaWVDaGFydC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxVQUFVLE1BQU0sZUFBZSxDQUFBO0FBQ3RDLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUM5QyxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBYSxNQUFNLGtCQUFrQixDQUFBO0FBQ3BGLE9BQU8sS0FBSyxNQUFNLFNBQVMsQ0FBQTtBQUUzQixJQUFNLFdBQVcsR0FBRyxXQUFXLENBQUE7QUFDL0IsSUFBTSxZQUFZLEdBQUcsWUFBWSxDQUFBO0FBRWpDLElBQU0sb0JBQW9CLEdBQUcsQ0FBQyxDQUFBO0FBQzlCLElBQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFBO0FBQy9CLElBQU0seUJBQXlCLEdBQUcsR0FBRyxDQUFBO0FBRXJDLElBQU0sZ0JBQWdCLEdBQUcsY0FBYyxDQUFBO0FBQ3ZDLElBQU0sbUJBQW1CLEdBQUcsaUJBQWlCLENBQUE7QUFFN0M7O0dBRUc7QUFDSDtJQUF1QixvQ0FBdUI7SUFXNUM7Ozs7T0FJRztJQUNILGtCQUFZLE9BQW9CLEVBQUUsSUFBZ0I7UUFBbEQsWUFDRSxrQkFBTSxPQUFPLENBQUMsU0FNZjtRQUxDLElBQUksSUFBSSxFQUFFO1lBQ1IsS0FBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUE7U0FDbEI7UUFFRCxLQUFJLENBQUMsV0FBVyxFQUFFLENBQUE7O0lBQ3BCLENBQUM7SUFFUyw4QkFBVyxHQUFyQjtRQUNFLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFpQixDQUFBO1FBQ3JFLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsWUFBWSxDQUFpQixDQUFBO1FBQ3ZFLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsZ0JBQWdCLENBQWlCLENBQUE7UUFDMUUsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBaUIsQ0FBQTtRQUVoRixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFBO1FBQ2pELElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFBO1FBRTdFLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFO1lBQ2YsSUFBSSxDQUFDLEtBQUssR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO1NBQ3RDO1FBRUQsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFBO0lBQ2hCLENBQUM7SUFFUywwQkFBTyxHQUFqQjtRQUNFLElBQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSyxPQUFBLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFYLENBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQTtRQUN6RCxJQUFNLENBQUMsR0FBRyxFQUFFLENBQUE7UUFDWixJQUFNLFNBQVMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1FBRW5DLElBQUksYUFBYSxHQUFHLENBQUMsQ0FBQTtRQUVyQixVQUFVO1FBQ1YsaUJBQWlCLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFBO1FBRTlCLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRTtZQUNoQixpQkFBaUIsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7U0FDaEM7UUFFRCxJQUFJLHFCQUFxQixHQUFHLENBQUMsQ0FBQTtRQUM3QixJQUFJLGdCQUFnQixHQUFHLENBQUMsQ0FBQTtRQUN4QixJQUFNLG1CQUFtQixHQUFHLG9CQUFvQixHQUFHLEdBQUcsQ0FBQTtRQUV0RCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDMUMsSUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQTtZQUUzQixJQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQTtZQUN0QyxJQUFJLFVBQVUsR0FBRyxtQkFBbUIsRUFBRTtnQkFDcEMscUJBQXFCLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxVQUFVLENBQUMsQ0FBQTtnQkFDM0QsZ0JBQWdCLEVBQUUsQ0FBQTthQUNuQjtTQUNGO1FBRUQsSUFBSSxnQkFBZ0IsR0FBRyxDQUFDLEVBQUU7WUFDeEIsZ0JBQWdCLEdBQUcscUJBQXFCLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxnQkFBZ0IsQ0FBQyxDQUFBO1NBQ2xGO1FBRUQsSUFBTSxVQUFVLEdBQUcsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFBO1FBRW5DLElBQUksZUFBZSxHQUFHLENBQUMsQ0FBQTtnQ0FDZCxDQUFDO1lBQ1IsSUFBTSxLQUFLLEdBQUcsT0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7WUFFM0IsSUFBTSxpQkFBaUIsR0FBRyxLQUFLLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQTtZQUM3QyxJQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLG1CQUFtQixFQUFFLGlCQUFpQixHQUFHLGdCQUFnQixDQUFDLENBQUE7WUFFdEYsSUFBSSxTQUFTLEdBQUcsQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDLEdBQUcsb0JBQW9CLENBQUE7WUFFL0QsSUFBSSxHQUFHLEdBQUcsUUFBUSxDQUFDLGVBQWUsQ0FBQyw0QkFBNEIsRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUN2RSxHQUFHLENBQUMsWUFBWSxDQUFDLFNBQVMsRUFBRSxXQUFXLENBQUMsQ0FBQTtZQUN4QyxHQUFHLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQTtZQUMvQixHQUFHLENBQUMsWUFBWSxDQUFDLGlCQUFpQixFQUFFLFlBQVksQ0FBQyxDQUFBO1lBRWpELElBQUksS0FBSyxHQUFHLFFBQVEsQ0FBQyxlQUFlLENBQUMsNEJBQTRCLEVBQUUsT0FBTyxDQUFDLENBQUE7WUFDM0UsS0FBSyxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUE7WUFDakMsS0FBSyxDQUFDLFNBQVMsR0FBRyx1QkFBcUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsR0FBRyxHQUFHLENBQUMsTUFBRyxDQUFBO1lBRTdFLElBQUksV0FBVyxHQUFHLFFBQVEsQ0FBQyxlQUFlLENBQUMsNEJBQTRCLEVBQUUsTUFBTSxDQUFDLENBQUE7WUFDaEYsV0FBVyxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUE7WUFDdEMsV0FBVyxDQUFDLFNBQVMsR0FBTSxLQUFLLENBQUMsS0FBSyxVQUFLLEtBQUssQ0FBQyxLQUFPLENBQUE7WUFFeEQsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLGVBQWUsQ0FBQyw0QkFBNEIsRUFBRSxRQUFRLENBQUMsQ0FBQTtZQUM3RSxNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQTtZQUMvQixNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQTtZQUMvQixNQUFNLENBQUMsWUFBWSxDQUFDLEdBQUcsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtZQUVuQyxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssSUFBSSxFQUFFO2dCQUNqQyxNQUFNLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxLQUFHLEtBQUssQ0FBQyxLQUFPLENBQUMsQ0FBQTthQUNoRDtpQkFBTTtnQkFDTCxNQUFNLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUE7YUFDMUM7WUFFRCxNQUFNLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxjQUFjLENBQUMsQ0FBQTtZQUMzQyxHQUFHLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSx1QkFBcUIsYUFBYSxVQUFPLENBQUMsQ0FBQTtZQUVwRSxHQUFHLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFBO1lBQ3RCLEdBQUcsQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUE7WUFDNUIsR0FBRyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQTtZQUN2QixPQUFLLE1BQU0sQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUE7WUFFNUIsSUFBSSxpQkFBaUIsR0FBRyxrQkFBa0IsR0FBRyxVQUFVLENBQUE7WUFDdkQsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFBO1lBRTdCLElBQUksT0FBTyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFBO1lBQzFCLFVBQVUsQ0FBQyxHQUFHLENBQUM7Z0JBQ2IsT0FBTyxFQUFFLE9BQU87Z0JBQ2hCLEdBQUcsRUFBRSxTQUFTO2dCQUNkLEtBQUssRUFBRTtvQkFDTCxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUE7Z0JBQzNCLENBQUM7Z0JBQ0QsTUFBTSxFQUFFO29CQUNOLE1BQU0sQ0FBQyxZQUFZLENBQUMsa0JBQWtCLEVBQUssT0FBTyxDQUFDLEdBQUcsU0FBSSxTQUFXLENBQUMsQ0FBQTtnQkFDeEUsQ0FBQztnQkFDRCxRQUFRLEVBQUUsaUJBQWlCO2dCQUMzQixNQUFNLEVBQUUsYUFBYTthQUN0QixDQUFDLENBQUE7WUFFRixTQUFTO1lBQ1QsSUFBSSxPQUFLLE9BQU8sSUFBSSxDQUFDLE9BQUssS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsSUFBSSxPQUFLLGlCQUFpQixFQUFFO2dCQUNyRSxJQUFJLE1BQU0sR0FBRyxJQUFJLFVBQVUsQ0FBQyxNQUFNLENBQUM7cUJBQ2hDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQTtnQkFFckIsSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLElBQUksRUFBRTtvQkFDakMsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUUsdUJBQXFCLEtBQUssQ0FBQyxLQUFPLENBQUMsQ0FBQTtpQkFDakU7cUJBQU07b0JBQ0wsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUE7aUJBQzdCO2dCQUVELElBQU0sT0FBTyxHQUFHLElBQUksVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFBO2dCQUN0QyxJQUFNLGNBQWMsR0FBRyxPQUFPLENBQUMsT0FBc0IsQ0FBQTtnQkFDckQsY0FBYyxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFBO2dCQUV0QyxJQUFJLFVBQVUsR0FBRyxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUM7cUJBQ2xDLFdBQVcsQ0FBQyxNQUFNLENBQUM7cUJBQ25CLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQTtnQkFFdkIsT0FBSyxPQUFPLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQTtnQkFFNUMsT0FBSyxjQUFjLENBQUMsVUFBVSxDQUFDLE9BQXNCLEVBQUUsZUFBZSxDQUFDLENBQUE7YUFDeEU7WUFDRCxlQUFlLElBQUksaUJBQWlCLENBQUE7WUFFcEMsYUFBYSxJQUFJLENBQUMsR0FBRyxHQUFHLFVBQVUsQ0FBQyxDQUFBO1lBRW5DLElBQUksQ0FBQyxLQUFLLE9BQUssS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQy9CLE9BQUssTUFBTSxDQUFDLFNBQVMsR0FBTSxLQUFLLENBQUMsS0FBSyxTQUFJLE9BQUssS0FBTyxDQUFBO2dCQUN0RCxPQUFLLFNBQVMsQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQTthQUN2Qzs7O1FBdkZILEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUU7b0JBQWpDLENBQUM7U0F3RlQ7SUFDSCxDQUFDO0lBRU8saUNBQWMsR0FBdEIsVUFBdUIsVUFBdUIsRUFBRSxlQUF1QjtRQUNyRSxVQUFVLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUE7UUFDOUIsS0FBSyxDQUFDO1lBQ0osT0FBTyxFQUFFLFVBQVU7WUFDbkIsUUFBUSxFQUFFLHlCQUF5QjtZQUNuQyxPQUFPLEVBQUUsQ0FBQztZQUNWLE1BQU0sRUFBRSxnQkFBZ0I7WUFDeEIsS0FBSyxFQUFFLGVBQWU7WUFDdEIsUUFBUSxFQUFFO2dCQUNSLFVBQVUsQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQTtZQUNqQyxDQUFDO1NBQ0YsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVEOzs7T0FHRztJQUNJLHlCQUFNLEdBQWIsVUFBYyxJQUFlO1FBQzNCLElBQUksSUFBSSxFQUFFO1lBQ1IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUE7U0FDbEI7UUFFRCxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUE7SUFDaEIsQ0FBQztJQUVEOztPQUVHO0lBQ0ksMEJBQU8sR0FBZDtRQUNHLElBQVksQ0FBQyxLQUFLLEdBQUcsU0FBUyxDQUFDO1FBQy9CLElBQVksQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDO1FBQ2hDLElBQVksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBQ25DLElBQVksQ0FBQyxLQUFLLEdBQUcsU0FBUyxDQUFBO1FBRS9CLGlCQUFpQixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM5QixJQUFZLENBQUMsTUFBTSxHQUFHLFNBQVMsQ0FBQTtRQUVoQyxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUU7WUFDaEIsaUJBQWlCLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQy9CLElBQVksQ0FBQyxPQUFPLEdBQUcsU0FBUyxDQUFBO1NBQ2xDO0lBQ0gsQ0FBQztJQUVEOzs7T0FHRztJQUNJLDBCQUFPLEdBQWQ7UUFDRSxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUE7SUFDaEIsQ0FBQztJQUNILGVBQUM7QUFBRCxDQTFOQSxBQTBOQyxDQTFOc0IsVUFBVSxHQTBOaEM7QUFFRCxNQUFNLFVBQVUsSUFBSTtJQUNsQixtQkFBbUIsQ0FBYyxZQUFZLEVBQUUsVUFBQyxDQUFDO1FBQy9DLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ2pCLENBQUMsQ0FBQyxDQUFBO0FBQ0osQ0FBQztBQUVELGVBQWUsUUFBUSxDQUFBIiwiZmlsZSI6Im1haW4vc3JjL2NoYXJ0cy9QaWVDaGFydC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBEb21FbGVtZW50IGZyb20gXCIuLi9Eb21FbGVtZW50XCJcbmltcG9ydCB7IHNlYXJjaEFuZEluaXRpYWxpemUgfSBmcm9tIFwiLi4vVXRpbHNcIlxuaW1wb3J0IHsgcmVtb3ZlQWxsQ2hpbGRyZW4sIHRyeUdldERhdGEsIGlzQ29sb3IsIENoYXJ0RGF0YSB9IGZyb20gXCIuL0NoYXJ0RnVuY3Rpb25zXCJcbmltcG9ydCBhbmltZSBmcm9tIFwiYW5pbWVqc1wiXG5cbmNvbnN0IFFVRVJZX0NIQVJUID0gXCIuanMtY2hhcnRcIlxuY29uc3QgUVVFUllfTEVHRU5EID0gXCIuanMtbGVnZW5kXCJcblxuY29uc3QgREFTSF9TRVBBUkFUT1JfV0lEVEggPSAzXG5jb25zdCBBTklNQVRJT05fRFVSQVRJT04gPSAxNTAwXG5jb25zdCBBTklNQVRJT05fRFVSQVRJT05fTEVHRU5EID0gNTAwXG5cbmNvbnN0IFFVRVJZX01FVEFfVElUTEUgPSBcIi5tZXRhIC50aXRsZVwiXG5jb25zdCBRVUVSWV9NRVRBX1NVQlRJVExFID0gXCIubWV0YSAuc3VidGl0bGVcIlxuXG4vKipcbiAqIFBpZSBDaGFydCBDb21wb25lbnQuXG4gKi9cbmNsYXNzIFBpZUNoYXJ0IGV4dGVuZHMgRG9tRWxlbWVudDxIVE1MRWxlbWVudD4ge1xuICBwcml2YXRlIF9kYXRhITogQ2hhcnREYXRhXG5cbiAgcHJpdmF0ZSBfY2hhcnQhOiBIVE1MRWxlbWVudFxuICBwcml2YXRlIF9sZWdlbmQhOiBIVE1MRWxlbWVudFxuICBwcml2YXRlIF90aXRsZSE6IEhUTUxFbGVtZW50XG4gIHByaXZhdGUgX3N1YnRpdGxlITogSFRNTEVsZW1lbnRcblxuICBwcml2YXRlIF91bml0ITogc3RyaW5nXG4gIHByaXZhdGUgX2Fsd2F5c1Nob3dMZWdlbmQhOiBib29sZWFuXG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW5kIGluaXRpYWxpemVzIHRoZSBQaWUgQ2hhcnQgY29tcG9uZW50LlxuICAgKiBAcGFyYW0ge0RvbUVsZW1lbnR9IC0gcm9vdCBlbGVtZW50IG9mIHRoZSBjaGFydC5cbiAgICogQHBhcmFtIHtBcnJheX0gLSBwaWUgY2hhcnQgZGF0YSBkZWZpbml0aW9ucy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBkYXRhPzogQ2hhcnREYXRhKSB7XG4gICAgc3VwZXIoZWxlbWVudClcbiAgICBpZiAoZGF0YSkge1xuICAgICAgdGhpcy5fZGF0YSA9IGRhdGFcbiAgICB9XG5cbiAgICB0aGlzLl9pbml0aWFsaXplKClcbiAgfVxuXG4gIHByb3RlY3RlZCBfaW5pdGlhbGl6ZSgpIHtcbiAgICB0aGlzLl9jaGFydCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFFVRVJZX0NIQVJUKSEgYXMgSFRNTEVsZW1lbnRcbiAgICB0aGlzLl9sZWdlbmQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihRVUVSWV9MRUdFTkQpISBhcyBIVE1MRWxlbWVudFxuICAgIHRoaXMuX3RpdGxlID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoUVVFUllfTUVUQV9USVRMRSkhIGFzIEhUTUxFbGVtZW50XG4gICAgdGhpcy5fc3VidGl0bGUgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihRVUVSWV9NRVRBX1NVQlRJVExFKSEgYXMgSFRNTEVsZW1lbnRcblxuICAgIHRoaXMuX3VuaXQgPSB0aGlzLmdldEF0dHJpYnV0ZShcImRhdGEtdW5pdFwiKSB8fCBcIlwiXG4gICAgdGhpcy5fYWx3YXlzU2hvd0xlZ2VuZCA9IHRoaXMuZWxlbWVudC5oYXNBdHRyaWJ1dGUoXCJkYXRhLWFsd2F5cy1zaG93LWxlZ2VuZFwiKVxuXG4gICAgaWYgKCF0aGlzLl9kYXRhKSB7XG4gICAgICB0aGlzLl9kYXRhID0gdHJ5R2V0RGF0YSh0aGlzLmVsZW1lbnQpXG4gICAgfVxuXG4gICAgdGhpcy5fcmVuZGVyKClcbiAgfVxuXG4gIHByb3RlY3RlZCBfcmVuZGVyKCkge1xuICAgIGNvbnN0IHRvdGFsID0gdGhpcy5fZGF0YS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLnZhbHVlLCAwKVxuICAgIGNvbnN0IHIgPSAxNlxuICAgIGNvbnN0IGRhc2hUb3RhbCA9ICgyICogciAqIE1hdGguUEkpXG5cbiAgICBsZXQgY3VycmVudFJvdGF0ZSA9IDlcblxuICAgIC8vIENsZWFudXBcbiAgICByZW1vdmVBbGxDaGlsZHJlbih0aGlzLl9jaGFydClcblxuICAgIGlmICh0aGlzLl9sZWdlbmQpIHtcbiAgICAgIHJlbW92ZUFsbENoaWxkcmVuKHRoaXMuX2xlZ2VuZClcbiAgICB9XG5cbiAgICBsZXQgcGVyY2VudGFnZUFkanVzdFRvdGFsID0gMFxuICAgIGxldCBwZXJjZW50YWdlQWRqdXN0ID0gMFxuICAgIGNvbnN0IHNlcGFyYXRvclBlcmNlbnRhZ2UgPSBEQVNIX1NFUEFSQVRPUl9XSURUSCAvIDEwMFxuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLl9kYXRhLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBlbnRyeSA9IHRoaXMuX2RhdGFbaV1cblxuICAgICAgY29uc3QgcGVyY2VudGFnZSA9IGVudHJ5LnZhbHVlIC8gdG90YWxcbiAgICAgIGlmIChwZXJjZW50YWdlIDwgc2VwYXJhdG9yUGVyY2VudGFnZSkge1xuICAgICAgICBwZXJjZW50YWdlQWRqdXN0VG90YWwgKz0gKHNlcGFyYXRvclBlcmNlbnRhZ2UgLSBwZXJjZW50YWdlKVxuICAgICAgICBwZXJjZW50YWdlQWRqdXN0KytcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocGVyY2VudGFnZUFkanVzdCA+IDApIHtcbiAgICAgIHBlcmNlbnRhZ2VBZGp1c3QgPSBwZXJjZW50YWdlQWRqdXN0VG90YWwgLyAodGhpcy5fZGF0YS5sZW5ndGggLSBwZXJjZW50YWdlQWRqdXN0KVxuICAgIH1cblxuICAgIGNvbnN0IGFuaW1hdGlvbnMgPSBhbmltZS50aW1lbGluZSgpXG5cbiAgICBsZXQgYW5pbWF0aW9uT2Zmc2V0ID0gMFxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgZW50cnkgPSB0aGlzLl9kYXRhW2ldXG5cbiAgICAgIGNvbnN0IGRpc3BsYXlQZXJjZW50YWdlID0gZW50cnkudmFsdWUgLyB0b3RhbFxuICAgICAgY29uc3QgcGVyY2VudGFnZSA9IE1hdGgubWF4KHNlcGFyYXRvclBlcmNlbnRhZ2UsIGRpc3BsYXlQZXJjZW50YWdlIC0gcGVyY2VudGFnZUFkanVzdClcblxuICAgICAgbGV0IGRhc2hXaWR0aCA9IChwZXJjZW50YWdlICogZGFzaFRvdGFsKSAtIERBU0hfU0VQQVJBVE9SX1dJRFRIXG5cbiAgICAgIGxldCBzdmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLCBcInN2Z1wiKVxuICAgICAgc3ZnLnNldEF0dHJpYnV0ZShcInZpZXdCb3hcIiwgXCIwIDAgMzQgMzRcIilcbiAgICAgIHN2Zy5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwiaW1nXCIpXG4gICAgICBzdmcuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbGxlZGJ5XCIsIFwidGl0bGUgZGVzY1wiKVxuXG4gICAgICBsZXQgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLCBcInRpdGxlXCIpXG4gICAgICB0aXRsZS5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBcInRpdGxlXCIpXG4gICAgICB0aXRsZS5pbm5lckhUTUwgPSBgUGllIGNoYXJ0IHNlZ21lbnQgJHtNYXRoLmZsb29yKGRpc3BsYXlQZXJjZW50YWdlICogMTAwKX0lYFxuXG4gICAgICBsZXQgZGVzY3JpcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLCBcImRlc2NcIilcbiAgICAgIGRlc2NyaXB0aW9uLnNldEF0dHJpYnV0ZShcImlkXCIsIFwiZGVzY1wiKVxuICAgICAgZGVzY3JpcHRpb24uaW5uZXJIVE1MID0gYCR7ZW50cnkudGl0bGV9OiAke2VudHJ5LnZhbHVlfWBcblxuICAgICAgbGV0IGNpcmNsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIFwiY2lyY2xlXCIpXG4gICAgICBjaXJjbGUuc2V0QXR0cmlidXRlKFwiY3hcIiwgXCIxN1wiKVxuICAgICAgY2lyY2xlLnNldEF0dHJpYnV0ZShcImN5XCIsIFwiMTdcIilcbiAgICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoXCJyXCIsIFN0cmluZyhyKSlcblxuICAgICAgaWYgKGlzQ29sb3IoZW50cnkuY29sb3IpID09PSB0cnVlKSB7XG4gICAgICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoXCJzdHJva2VcIiwgYCR7ZW50cnkuY29sb3J9YClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoXCJjbGFzc1wiLCBlbnRyeS5jb2xvcilcbiAgICAgIH1cblxuICAgICAgY2lyY2xlLnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJwcmVzZW50YXRpb25cIilcbiAgICAgIHN2Zy5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBgdHJhbnNmb3JtOiByb3RhdGUoJHtjdXJyZW50Um90YXRlfWRlZyk7YClcblxuICAgICAgc3ZnLmFwcGVuZENoaWxkKHRpdGxlKVxuICAgICAgc3ZnLmFwcGVuZENoaWxkKGRlc2NyaXB0aW9uKVxuICAgICAgc3ZnLmFwcGVuZENoaWxkKGNpcmNsZSlcbiAgICAgIHRoaXMuX2NoYXJ0LmFwcGVuZENoaWxkKHN2ZylcblxuICAgICAgbGV0IGFuaW1hdGlvbkR1cmF0aW9uID0gQU5JTUFUSU9OX0RVUkFUSU9OICogcGVyY2VudGFnZVxuICAgICAgY2lyY2xlLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIlxuXG4gICAgICBsZXQgY291bnRlciA9IHsgdmFyOiAwLjUgfVxuICAgICAgYW5pbWF0aW9ucy5hZGQoe1xuICAgICAgICB0YXJnZXRzOiBjb3VudGVyLFxuICAgICAgICB2YXI6IGRhc2hXaWR0aCxcbiAgICAgICAgYmVnaW46ICgpID0+IHtcbiAgICAgICAgICBjaXJjbGUuc3R5bGUuZGlzcGxheSA9IFwiXCJcbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlOiAoKSA9PiB7XG4gICAgICAgICAgY2lyY2xlLnNldEF0dHJpYnV0ZShcInN0cm9rZS1kYXNoYXJyYXlcIiwgYCR7Y291bnRlci52YXJ9ICR7ZGFzaFRvdGFsfWApXG4gICAgICAgIH0sXG4gICAgICAgIGR1cmF0aW9uOiBhbmltYXRpb25EdXJhdGlvbixcbiAgICAgICAgZWFzaW5nOiBcImVhc2VJblF1aW50XCJcbiAgICAgIH0pXG5cbiAgICAgIC8vIExlZ2VuZFxuICAgICAgaWYgKHRoaXMuX2xlZ2VuZCAmJiAodGhpcy5fZGF0YS5sZW5ndGggPiAxKSB8fCB0aGlzLl9hbHdheXNTaG93TGVnZW5kKSB7XG4gICAgICAgIGxldCBidWxsZXQgPSBuZXcgRG9tRWxlbWVudChcInNwYW5cIilcbiAgICAgICAgICAuYWRkQ2xhc3MoXCJidWxsZXRcIilcblxuICAgICAgICBpZiAoaXNDb2xvcihlbnRyeS5jb2xvcikgPT09IHRydWUpIHtcbiAgICAgICAgICBidWxsZXQuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgYGJhY2tncm91bmQtY29sb3I6ICR7ZW50cnkuY29sb3J9YClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBidWxsZXQuYWRkQ2xhc3MoZW50cnkuY29sb3IpXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjYXB0aW9uID0gbmV3IERvbUVsZW1lbnQoXCJzcGFuXCIpXG4gICAgICAgIGNvbnN0IGNhcHRpb25FbGVtZW50ID0gY2FwdGlvbi5lbGVtZW50IGFzIEhUTUxFbGVtZW50XG4gICAgICAgIGNhcHRpb25FbGVtZW50LmlubmVyVGV4dCA9IGVudHJ5LnRpdGxlXG5cbiAgICAgICAgbGV0IGxlZ2VuZEl0ZW0gPSBuZXcgRG9tRWxlbWVudChcImxpXCIpXG4gICAgICAgICAgLmFwcGVuZENoaWxkKGJ1bGxldClcbiAgICAgICAgICAuYXBwZW5kQ2hpbGQoY2FwdGlvbilcblxuICAgICAgICB0aGlzLl9sZWdlbmQuYXBwZW5kQ2hpbGQobGVnZW5kSXRlbS5lbGVtZW50KVxuXG4gICAgICAgIHRoaXMuX2FuaW1hdGVMZWdlbmQobGVnZW5kSXRlbS5lbGVtZW50IGFzIEhUTUxFbGVtZW50LCBhbmltYXRpb25PZmZzZXQpXG4gICAgICB9XG4gICAgICBhbmltYXRpb25PZmZzZXQgKz0gYW5pbWF0aW9uRHVyYXRpb25cblxuICAgICAgY3VycmVudFJvdGF0ZSArPSAoMzYwICogcGVyY2VudGFnZSlcblxuICAgICAgaWYgKGkgPT09IHRoaXMuX2RhdGEubGVuZ3RoIC0gMSkge1xuICAgICAgICB0aGlzLl90aXRsZS5pbm5lckhUTUwgPSBgJHtlbnRyeS52YWx1ZX0gJHt0aGlzLl91bml0fWBcbiAgICAgICAgdGhpcy5fc3VidGl0bGUuaW5uZXJIVE1MID0gZW50cnkudGl0bGVcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9hbmltYXRlTGVnZW5kKGxlZ2VuZEl0ZW06IEhUTUxFbGVtZW50LCBhbmltYXRpb25PZmZzZXQ6IG51bWJlcikge1xuICAgIGxlZ2VuZEl0ZW0uc3R5bGUub3BhY2l0eSA9IFwiMFwiXG4gICAgYW5pbWUoe1xuICAgICAgdGFyZ2V0czogbGVnZW5kSXRlbSxcbiAgICAgIGR1cmF0aW9uOiBBTklNQVRJT05fRFVSQVRJT05fTEVHRU5ELFxuICAgICAgb3BhY2l0eTogMSxcbiAgICAgIGVhc2luZzogXCJlYXNlSW5PdXRRdWludFwiLFxuICAgICAgZGVsYXk6IGFuaW1hdGlvbk9mZnNldCxcbiAgICAgIGNvbXBsZXRlOiAoKSA9PiB7XG4gICAgICAgIGxlZ2VuZEl0ZW0uc3R5bGUub3BhY2l0eSA9IG51bGxcbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgdGhlIHBpZSBjaGFydCB3aXRoIHRoZSBzcGVjaWZpZWQgZGF0YSBkZWZpbml0aW9ucy5cbiAgICogQHBhcmFtIHtBcnJheX0gLSBwaWUgY2hhcnQgZGF0YSBkZWZpbml0aW9ucy5cbiAgICovXG4gIHB1YmxpYyB1cGRhdGUoZGF0YTogQ2hhcnREYXRhKSB7XG4gICAgaWYgKGRhdGEpIHtcbiAgICAgIHRoaXMuX2RhdGEgPSBkYXRhXG4gICAgfVxuXG4gICAgdGhpcy5fcmVuZGVyKClcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmVzIGFsbCBldmVudCBoYW5kbGVycyBhbmQgY2xlYXJzIHJlZmVyZW5jZXMuXG4gICAqL1xuICBwdWJsaWMgZGVzdHJveSgpIHtcbiAgICAodGhpcyBhcyBhbnkpLl9kYXRhID0gdW5kZWZpbmVkO1xuICAgICh0aGlzIGFzIGFueSkuX3RpdGxlID0gdW5kZWZpbmVkO1xuICAgICh0aGlzIGFzIGFueSkuX3N1YnRpdGxlID0gdW5kZWZpbmVkO1xuICAgICh0aGlzIGFzIGFueSkuX3VuaXQgPSB1bmRlZmluZWRcblxuICAgIHJlbW92ZUFsbENoaWxkcmVuKHRoaXMuX2NoYXJ0KTtcbiAgICAodGhpcyBhcyBhbnkpLl9jaGFydCA9IHVuZGVmaW5lZFxuXG4gICAgaWYgKHRoaXMuX2xlZ2VuZCkge1xuICAgICAgcmVtb3ZlQWxsQ2hpbGRyZW4odGhpcy5fbGVnZW5kKTtcbiAgICAgICh0aGlzIGFzIGFueSkuX2xlZ2VuZCA9IHVuZGVmaW5lZFxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZCB1c2UgZGVzdHJveSgpIGluc3RlYWQuXG4gICAqIEB0b2RvIHJlbW92ZSBpbiB2ZXJzaW9uIDIuMC4wXG4gICAqL1xuICBwdWJsaWMgZGVzdG9yeSgpIHtcbiAgICB0aGlzLmRlc3Ryb3koKVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0KCkge1xuICBzZWFyY2hBbmRJbml0aWFsaXplPEhUTUxFbGVtZW50PihcIi5waWUtY2hhcnRcIiwgKGUpID0+IHtcbiAgICBuZXcgUGllQ2hhcnQoZSlcbiAgfSlcbn1cblxuZXhwb3J0IGRlZmF1bHQgUGllQ2hhcnRcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4vLi4ifQ==
