import * as tslib_1 from "tslib";
import anime from "animejs";
import { searchAndInitialize } from "../Utils";
import DomElement from "../DomElement";
import * as Dom from "../DomFunctions";
import SearchInput from "../search/SearchInput";
var CLASS_OPEN = "is-open";
var CLASS_ACTIVE = "is-active";
var QUERY_NAV_HAMBURGER = ".nav-hamburger";
var QUERY_NAV_HB_BODY = ".nav__primary";
var CLASS_NAV_LINK = "nav-link--header";
var QUERY_NAV_LINK_ACTIVE = ".nav-link--header.is-active";
var QUERY_NAV_MOBILE = ".nav__level1 .nav__mainnav .nav__primary";
var QUERY_NAV_LEVEL0 = ".nav__level0";
var QUERY_NAV_LEVEL0_CONTAINER = ".nav__level0 .nav__subnav";
var QUERY_SECTION_OPEN = ".nav-section.is-open";
var QUERY_NAV_LEVEL1 = ".nav__level1 .nav__mainnav";
var QUERY_NAV_LEVEL0_LINK = ".nav-link.nav-link--header";
var QUERY_NAV_LEVEL1_LINK = ".nav-link--header";
var QUERY_NAV_COLUMN = ".nav-col";
var QUERY_NAV_COLUMN_ACTIVE = ".nav-col.is-active";
var QUERY_NAV_BODY = ".nav-body";
var QUERY_NAV_FOOTER = ".nav-footer";
var QUERY_SEARCH_ICON = ".nav-search";
var QUERY_SEARCH_FIELD = ".search__input";
var CLASS_SEARCH_DESKTOP = "search--desktop";
var ANIMATION_START_DELAY = 200;
var ANIMATION_OFFSET = 50;
var ANIMATION_BODY_DURATION = 300;
var ANIMATION_FOOTER_DURATION = 100;
/**
 * The navigation component definition.
 */
var Navigation = /** @class */ (function (_super) {
    tslib_1.__extends(Navigation, _super);
    function Navigation(element) {
        var _this = _super.call(this, element) || this;
        _this.animation = anime.timeline();
        _this._navLevel0 = _this.element.querySelector(QUERY_NAV_LEVEL0) || document.createElement("div");
        _this._navLevel0Body = _this.element.querySelector(QUERY_NAV_LEVEL0_CONTAINER) || document.createElement("div");
        _this._navLevel1 = _this.element.querySelector(QUERY_NAV_LEVEL1) || document.createElement("div");
        _this._navMobile = _this.element.querySelector(QUERY_NAV_MOBILE) || document.createElement("div");
        if (!_this._navMobile.parentElement) {
            var dummyParent = document.createElement("div");
            dummyParent.appendChild(_this._navMobile);
        }
        _this._hamburgerElement = _this.element.querySelector(QUERY_NAV_HAMBURGER) || document.createElement("div");
        _this._searchComponents = [];
        _this._level0ClickHandler = _this._handleLevel0Click.bind(_this);
        _this._level1ClickHandler = _this._handleLevel1Click.bind(_this);
        _this._windowClickHandler = _this._handleWindowClick.bind(_this);
        _this._searchClickHandler = _this._handleSearchClick.bind(_this);
        _this._initialize();
        return _this;
    }
    Navigation.prototype._resetMainTimeline = function () {
        var e_1, _a;
        var elements = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            elements[_i] = arguments[_i];
        }
        this.animation.pause();
        try {
            for (var elements_1 = tslib_1.__values(elements), elements_1_1 = elements_1.next(); !elements_1_1.done; elements_1_1 = elements_1.next()) {
                var el = elements_1_1.value;
                anime.remove(el);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (elements_1_1 && !elements_1_1.done && (_a = elements_1.return)) _a.call(elements_1);
            }
            finally { if (e_1) throw e_1.error; }
        }
        this.animation = anime.timeline();
    };
    Navigation.prototype._isMobile = function () {
        return Dom.isHidden(this._hamburgerElement, true) === false;
    };
    Navigation.prototype._handleLevel0Click = function (event) {
        var isDesktop = !this._isMobile();
        if (isDesktop) {
            var navItems = new NavigationItems(this)
                .fromLevel0(event.target);
            if (!navItems.section) {
                return;
            }
            var previousNavLink = this._navLevel0.querySelector(QUERY_NAV_LINK_ACTIVE);
            var previousNavSection = this._navLevel0.querySelector(QUERY_SECTION_OPEN);
            this._toggleContainer(navItems.link, this._navLevel0Body, navItems.section, undefined, previousNavLink, this._navLevel0Body, previousNavSection, undefined, true);
        }
    };
    Navigation.prototype._handleLevel1Click = function (event) {
        var navItems = new NavigationItems(this)
            .fromLevel1(event.target);
        var prevItems = navItems.previousLevel1();
        this._toggleContainer(navItems.link, navItems.container, navItems.section, navItems.footer, prevItems.link, prevItems.container, prevItems.section, prevItems.footer, false);
        return false;
    };
    Navigation.prototype._toggleContainer = function (navLink, navContainer, navSection, navFooter, previousNavLink, previousNavContainer, previousNavSection, previousNavFooter, animateContainer) {
        if (animateContainer === void 0) { animateContainer = false; }
        var isDesktop = !this._isMobile();
        if (previousNavLink && previousNavLink !== navLink && navLink !== this._hamburgerElement) {
            Dom.removeClass(previousNavLink, CLASS_ACTIVE);
        }
        this._resetMainTimeline(navContainer, navSection, navFooter, previousNavContainer, previousNavSection, previousNavFooter);
        if (Dom.hasClass(navLink, CLASS_ACTIVE)) {
            Dom.removeClass(navLink, CLASS_ACTIVE);
            if (isDesktop) {
                this._onNavigationClosed();
                this._closeSection(navContainer, navSection, navFooter, true, animateContainer);
            }
            else if (navLink === this._hamburgerElement) {
                // Close mobile navigation
                this._onNavigationClosed();
                this._closeSection(navContainer, navSection, undefined, false, false);
            }
            else if (!isDesktop) {
                // Close the section
                this._closeSection(navContainer, navSection, navFooter, true, animateContainer);
            }
        }
        else {
            Dom.addClass(navLink, CLASS_ACTIVE);
            if (isDesktop) {
                Dom.addClass(this._navMobile, CLASS_OPEN);
                this._onNavigationOpened();
                if (previousNavContainer && previousNavSection) {
                    this._closeSection(previousNavContainer, previousNavSection, previousNavFooter, true, animateContainer);
                }
                this._openSection(navContainer, navSection, navFooter, true, animateContainer);
            }
            else if (navLink === this._hamburgerElement) {
                // Open mobile navigation
                this._onNavigationOpened();
                this._openSection(navContainer, navSection, undefined, false, false);
            }
            else if (!isDesktop) {
                // Open section
                if (previousNavContainer && previousNavSection) {
                    this._closeSection(previousNavContainer, previousNavSection, previousNavFooter, true, animateContainer);
                    this.animation = anime.timeline();
                }
                this._openSection(navContainer, navSection, navFooter, true, animateContainer);
            }
        }
    };
    Navigation.prototype._onNavigationOpened = function () {
        Dom.addClass(this._navMobile, CLASS_OPEN);
        Dom.addClass(this._navMobile.parentElement, CLASS_OPEN);
        Dom.addClass(this._hamburgerElement, CLASS_ACTIVE);
        window.addEventListener("click", this._windowClickHandler);
        window.addEventListener("touchend", this._windowClickHandler);
    };
    Navigation.prototype._onNavigationClosed = function () {
        Dom.removeClass(this._navMobile, CLASS_OPEN);
        Dom.removeClass(this._navMobile.parentElement, CLASS_OPEN);
        Dom.removeClass(this._hamburgerElement, CLASS_ACTIVE);
        window.removeEventListener("click", this._windowClickHandler);
        window.removeEventListener("touchend", this._windowClickHandler);
    };
    Navigation.prototype._handleWindowClick = function (event) {
        var target = event.target;
        while (target !== this.element && target.parentElement) {
            target = target.parentElement;
        }
        if (target !== this.element) {
            this.close();
            return false;
        }
        return true;
    };
    Navigation.prototype._openSection = function (navContainer, navSection, navFooter, animateColumns, animateContainer) {
        var e_2, _a, e_3, _b;
        if (animateColumns === void 0) { animateColumns = true; }
        if (animateContainer === void 0) { animateContainer = false; }
        if (!navSection || !navContainer) {
            return;
        }
        var activeItems = navSection.querySelectorAll(QUERY_NAV_COLUMN);
        if (animateContainer === true) {
            var container = navContainer;
            navContainer = navSection;
            navSection = container;
        }
        Dom.addClass(navContainer, CLASS_OPEN);
        navSection.style.display = "block";
        this.animation.add({
            targets: navSection,
            duration: ANIMATION_BODY_DURATION,
            easing: "cubicBezier(0.550, 0.085, 0.320, 1)",
            height: animateContainer ? navContainer.scrollHeight : navSection.scrollHeight,
            complete: function () {
                Dom.addClass(navSection, CLASS_OPEN);
                new DomElement(navSection).setAttribute("style", "");
            }
        });
        if (navFooter) {
            var navItems = navFooter.querySelectorAll(QUERY_NAV_COLUMN);
            try {
                for (var navItems_1 = tslib_1.__values(navItems), navItems_1_1 = navItems_1.next(); !navItems_1_1.done; navItems_1_1 = navItems_1.next()) {
                    var item = navItems_1_1.value;
                    Dom.addClass(item, CLASS_ACTIVE);
                }
            }
            catch (e_2_1) { e_2 = { error: e_2_1 }; }
            finally {
                try {
                    if (navItems_1_1 && !navItems_1_1.done && (_a = navItems_1.return)) _a.call(navItems_1);
                }
                finally { if (e_2) throw e_2.error; }
            }
            navFooter.style.display = "block";
            this.animation.add({
                targets: navFooter,
                duration: ANIMATION_FOOTER_DURATION,
                easing: "cubicBezier(0.550, 0.085, 0.320, 1)",
                height: navFooter.scrollHeight,
                offset: "-=" + ANIMATION_FOOTER_DURATION,
                complete: function () {
                    Dom.addClass(navFooter, CLASS_OPEN);
                    new DomElement(navFooter).setAttribute("style", "");
                }
            });
        }
        if (animateColumns === true) {
            var delay = ANIMATION_START_DELAY;
            var _loop_1 = function (item) {
                this_1.animation.add({
                    targets: item,
                    duration: 0,
                    offset: delay,
                    complete: function () {
                        Dom.addClass(item, CLASS_ACTIVE);
                    }
                });
                delay += ANIMATION_OFFSET;
            };
            var this_1 = this;
            try {
                for (var activeItems_1 = tslib_1.__values(activeItems), activeItems_1_1 = activeItems_1.next(); !activeItems_1_1.done; activeItems_1_1 = activeItems_1.next()) {
                    var item = activeItems_1_1.value;
                    _loop_1(item);
                }
            }
            catch (e_3_1) { e_3 = { error: e_3_1 }; }
            finally {
                try {
                    if (activeItems_1_1 && !activeItems_1_1.done && (_b = activeItems_1.return)) _b.call(activeItems_1);
                }
                finally { if (e_3) throw e_3.error; }
            }
        }
    };
    Navigation.prototype._closeSection = function (navContainer, navSection, navFooter, animateColumns, animateContainer) {
        var e_4, _a, e_5, _b;
        if (animateColumns === void 0) { animateColumns = true; }
        if (animateContainer === void 0) { animateContainer = false; }
        if (!navSection || !navContainer) {
            return;
        }
        var activeItems = navSection.querySelectorAll(QUERY_NAV_COLUMN_ACTIVE);
        if (animateContainer === true) {
            var container = navContainer;
            navContainer = navSection;
            navSection = container;
        }
        if (animateColumns === true) {
            try {
                for (var activeItems_2 = tslib_1.__values(activeItems), activeItems_2_1 = activeItems_2.next(); !activeItems_2_1.done; activeItems_2_1 = activeItems_2.next()) {
                    var active = activeItems_2_1.value;
                    Dom.removeClass(active, CLASS_ACTIVE);
                }
            }
            catch (e_4_1) { e_4 = { error: e_4_1 }; }
            finally {
                try {
                    if (activeItems_2_1 && !activeItems_2_1.done && (_a = activeItems_2.return)) _a.call(activeItems_2);
                }
                finally { if (e_4) throw e_4.error; }
            }
        }
        this.animation.add({
            targets: navSection,
            duration: ANIMATION_BODY_DURATION,
            easing: "cubicBezier(0.550, 0.085, 0.320, 1)",
            height: 0,
            offset: 0,
            complete: function () {
                Dom.removeClass(navContainer, CLASS_OPEN);
                Dom.removeClass(navSection, CLASS_OPEN);
                navSection.style.height = "";
            }
        });
        if (navFooter) {
            try {
                for (var _c = tslib_1.__values(navFooter.querySelectorAll(QUERY_NAV_COLUMN_ACTIVE)), _d = _c.next(); !_d.done; _d = _c.next()) {
                    var active = _d.value;
                    Dom.removeClass(active, CLASS_ACTIVE);
                }
            }
            catch (e_5_1) { e_5 = { error: e_5_1 }; }
            finally {
                try {
                    if (_d && !_d.done && (_b = _c.return)) _b.call(_c);
                }
                finally { if (e_5) throw e_5.error; }
            }
            this.animation.add({
                targets: navFooter,
                duration: ANIMATION_FOOTER_DURATION,
                easing: "cubicBezier(0.550, 0.085, 0.320, 1)",
                height: 0,
                offset: 0,
                complete: function () {
                    Dom.removeClass(navFooter, CLASS_OPEN);
                    navFooter.style.height = "";
                }
            });
        }
    };
    Navigation.prototype._handleSearchClick = function () {
        if (this._searchDesktop) {
            this._searchDesktop.open();
        }
    };
    /**
     * Initializes the navigation component.
     * @private
     */
    Navigation.prototype._initialize = function () {
        var e_6, _a, e_7, _b, e_8, _c;
        try {
            for (var _d = tslib_1.__values(this._navLevel0.querySelectorAll(QUERY_NAV_LEVEL0_LINK)), _e = _d.next(); !_e.done; _e = _d.next()) {
                var navLink = _e.value;
                navLink.addEventListener("click", this._level0ClickHandler);
            }
        }
        catch (e_6_1) { e_6 = { error: e_6_1 }; }
        finally {
            try {
                if (_e && !_e.done && (_a = _d.return)) _a.call(_d);
            }
            finally { if (e_6) throw e_6.error; }
        }
        try {
            for (var _f = tslib_1.__values(this._navLevel1.querySelectorAll(QUERY_NAV_LEVEL1_LINK)), _g = _f.next(); !_g.done; _g = _f.next()) {
                var navLink = _g.value;
                navLink.addEventListener("click", this._level1ClickHandler);
            }
        }
        catch (e_7_1) { e_7 = { error: e_7_1 }; }
        finally {
            try {
                if (_g && !_g.done && (_b = _f.return)) _b.call(_f);
            }
            finally { if (e_7) throw e_7.error; }
        }
        this._hamburgerElement.addEventListener("click", this._level1ClickHandler);
        // Desktop search icon
        var searchIcon = this.element.querySelector(QUERY_SEARCH_ICON);
        if (searchIcon) {
            searchIcon.addEventListener("click", this._searchClickHandler);
        }
        try {
            for (var _h = tslib_1.__values(this.element.querySelectorAll(QUERY_SEARCH_FIELD)), _j = _h.next(); !_j.done; _j = _h.next()) {
                var search = _j.value;
                var searchComponent = new SearchInput(search);
                if (Dom.hasClass(search, CLASS_SEARCH_DESKTOP) || Dom.hasClass(search.parentElement, CLASS_SEARCH_DESKTOP)) {
                    this._searchDesktop = searchComponent;
                }
                this._searchComponents.push(searchComponent);
            }
        }
        catch (e_8_1) { e_8 = { error: e_8_1 }; }
        finally {
            try {
                if (_j && !_j.done && (_c = _h.return)) _c.call(_h);
            }
            finally { if (e_8) throw e_8.error; }
        }
    };
    /**
     * Closes the navigation.
     */
    Navigation.prototype.close = function () {
        var isMoble = this._isMobile();
        var level1 = this._navLevel1.querySelector(QUERY_NAV_LINK_ACTIVE);
        var level0 = this._navLevel0.querySelector(QUERY_NAV_LINK_ACTIVE);
        if (!level1 && isMoble && Dom.hasClass(this._hamburgerElement, CLASS_ACTIVE)) {
            level1 = this._hamburgerElement;
        }
        var navItems;
        if (level1) {
            navItems = new NavigationItems(this).fromLevel1(level1);
        }
        else if (level0) {
            navItems = new NavigationItems(this).fromLevel0(level0);
        }
        if (navItems) {
            this._resetMainTimeline(navItems.container, navItems.section, navItems.footer);
            Dom.removeClass(navItems.link, CLASS_ACTIVE);
            this._onNavigationClosed();
            this._closeSection(navItems.container, navItems.section, navItems.footer, !isMoble, false);
        }
    };
    return Navigation;
}(DomElement));
var NavigationItems = /** @class */ (function () {
    function NavigationItems(nav) {
        this._navigation = nav;
    }
    Object.defineProperty(NavigationItems.prototype, "link", {
        get: function () {
            return this._link;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NavigationItems.prototype, "container", {
        get: function () {
            return this._container;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NavigationItems.prototype, "section", {
        get: function () {
            return this._section;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(NavigationItems.prototype, "footer", {
        get: function () {
            return this._footer;
        },
        enumerable: true,
        configurable: true
    });
    NavigationItems.prototype.fromLevel0 = function (navLink) {
        while (!Dom.hasClass(navLink, CLASS_NAV_LINK) && navLink.parentElement) {
            navLink = navLink.parentElement;
        }
        this._link = navLink;
        var toggleId = navLink.getAttribute("data-toggle");
        this._container = this._navigation._navLevel0Body;
        this._section = this._navigation._navLevel0.querySelector("#" + toggleId);
        return this;
    };
    NavigationItems.prototype.fromLevel1 = function (navLink) {
        while (navLink.parentElement) {
            if ((navLink === this._navigation._hamburgerElement) || Dom.hasClass(navLink, CLASS_NAV_LINK)) {
                break;
            }
            navLink = navLink.parentElement;
        }
        this._link = navLink;
        this._container = navLink.parentElement;
        this._section = this._container.querySelector(QUERY_NAV_BODY);
        this._footer = this._container.querySelector(QUERY_NAV_FOOTER);
        if (navLink === this._navigation._hamburgerElement) {
            this._container = this._navigation._navLevel1;
            this._section = this._container.querySelector(QUERY_NAV_HB_BODY);
        }
        return this;
    };
    NavigationItems.prototype.previousLevel1 = function () {
        var prev = new NavigationItems(this._navigation);
        prev._link = this._navigation._navLevel1.querySelector(QUERY_NAV_LINK_ACTIVE);
        prev._container = prev._link ? prev._link.parentElement : undefined;
        prev._section = prev._container ? prev._container.querySelector(QUERY_NAV_BODY) : undefined;
        prev._footer = prev._container ? prev._container.querySelector(QUERY_NAV_FOOTER) : undefined;
        return prev;
    };
    NavigationItems.prototype.isHamburger = function () {
        return this._link === this._navigation._hamburgerElement;
    };
    return NavigationItems;
}());
export function init() {
    searchAndInitialize(".nav", function (e) {
        new Navigation(e);
    });
}
export default Navigation;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4vc3JjL25hdmlnYXRpb24vTmF2aWdhdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxLQUFnQyxNQUFNLFNBQVMsQ0FBQTtBQUN0RCxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDOUMsT0FBTyxVQUFVLE1BQU0sZUFBZSxDQUFBO0FBQ3RDLE9BQU8sS0FBSyxHQUFHLE1BQU0saUJBQWlCLENBQUE7QUFDdEMsT0FBTyxXQUFXLE1BQU0sdUJBQXVCLENBQUE7QUFFL0MsSUFBTSxVQUFVLEdBQUcsU0FBUyxDQUFBO0FBQzVCLElBQU0sWUFBWSxHQUFHLFdBQVcsQ0FBQTtBQUVoQyxJQUFNLG1CQUFtQixHQUFHLGdCQUFnQixDQUFBO0FBQzVDLElBQU0saUJBQWlCLEdBQUcsZUFBZSxDQUFBO0FBRXpDLElBQU0sY0FBYyxHQUFHLGtCQUFrQixDQUFBO0FBQ3pDLElBQU0scUJBQXFCLEdBQUcsNkJBQTZCLENBQUE7QUFFM0QsSUFBTSxnQkFBZ0IsR0FBRywwQ0FBMEMsQ0FBQTtBQUNuRSxJQUFNLGdCQUFnQixHQUFHLGNBQWMsQ0FBQTtBQUN2QyxJQUFNLDBCQUEwQixHQUFHLDJCQUEyQixDQUFBO0FBQzlELElBQU0sa0JBQWtCLEdBQUcsc0JBQXNCLENBQUE7QUFFakQsSUFBTSxnQkFBZ0IsR0FBRyw0QkFBNEIsQ0FBQTtBQUVyRCxJQUFNLHFCQUFxQixHQUFHLDRCQUE0QixDQUFBO0FBQzFELElBQU0scUJBQXFCLEdBQUcsbUJBQW1CLENBQUE7QUFFakQsSUFBTSxnQkFBZ0IsR0FBRyxVQUFVLENBQUE7QUFDbkMsSUFBTSx1QkFBdUIsR0FBRyxvQkFBb0IsQ0FBQTtBQUVwRCxJQUFNLGNBQWMsR0FBRyxXQUFXLENBQUE7QUFDbEMsSUFBTSxnQkFBZ0IsR0FBRyxhQUFhLENBQUE7QUFFdEMsSUFBTSxpQkFBaUIsR0FBRyxhQUFhLENBQUE7QUFDdkMsSUFBTSxrQkFBa0IsR0FBRyxnQkFBZ0IsQ0FB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Q0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsYUFBYyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUE7UUFDcEUsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQWlCLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQTtRQUMzRyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDLGdCQUFnQixDQUFpQixDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUE7UUFFNUcsT0FBTyxJQUFJLENBQUE7SUFDYixDQUFDO0lBRU0scUNBQVcsR0FBbEI7UUFDRSxPQUFPLElBQUksQ0FBQyxLQUFLLEtBQUssSUFBSSxDQUFDLFdBQVcsQ0FBQyxpQkFBaUIsQ0FBQTtJQUMxRCxDQUFDO0lBQ0gsc0JBQUM7QUFBRCxDQTVFQSxBQTRFQyxJQUFBO0FBRUQsTUFBTSxVQUFVLElBQUk7SUFDbEIsbUJBQW1CLENBQUMsTUFBTSxFQUFFLFVBQUMsQ0FBQztRQUM1QixJQUFJLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUNuQixDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUM7QUFFRCxlQUFlLFVBQVUsQ0FBQSIsImZpbGUiOiJtYWluL3NyYy9uYXZpZ2F0aW9uL05hdmlnYXRpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5pbWUsIHsgQW5pbWVUaW1lbGluZUluc3RhbmNlIH0gZnJvbSBcImFuaW1lanNcIlxuaW1wb3J0IHsgc2VhcmNoQW5kSW5pdGlhbGl6ZSB9IGZyb20gXCIuLi9VdGlsc1wiXG5pbXBvcnQgRG9tRWxlbWVudCBmcm9tIFwiLi4vRG9tRWxlbWVudFwiXG5pbXBvcnQgKiBhcyBEb20gZnJvbSBcIi4uL0RvbUZ1bmN0aW9uc1wiXG5pbXBvcnQgU2VhcmNoSW5wdXQgZnJvbSBcIi4uL3NlYXJjaC9TZWFyY2hJbnB1dFwiXG5cbmNvbnN0IENMQVNTX09QRU4gPSBcImlzLW9wZW5cIlxuY29uc3QgQ0xBU1NfQUNUSVZFID0gXCJpcy1hY3RpdmVcIlxuXG5jb25zdCBRVUVSWV9OQVZfSEFNQlVSR0VSID0gXCIubmF2LWhhbWJ1cmdlclwiXG5jb25zdCBRVUVSWV9OQVZfSEJfQk9EWSA9IFwiLm5hdl9fcHJpbWFyeVwiXG5cbmNvbnN0IENMQVNTX05BVl9MSU5LID0gXCJuYXYtbGluay0taGVhZGVyXCJcbmNvbnN0IFFVRVJZX05BVl9MSU5LX0FDVElWRSA9IFwiLm5hdi1saW5rLS1oZWFkZXIuaXMtYWN0aXZlXCJcblxuY29uc3QgUVVFUllfTkFWX01PQklMRSA9IFwiLm5hdl9fbGV2ZWwxIC5uYXZfX21haW5uYXYgLm5hdl9fcHJpbWFyeVwiXG5jb25zdCBRVUVSWV9OQVZfTEVWRUwwID0gXCIubmF2X19sZXZlbDBcIlxuY29uc3QgUVVFUllfTkFWX0xFVkVMMF9DT05UQUlORVIgPSBcIi5uYXZfX2xldmVsMCAubmF2X19zdWJuYXZcIlxuY29uc3QgUVVFUllfU0VDVElPTl9PUEVOID0gXCIubmF2LXNlY3Rpb24uaXMtb3BlblwiXG5cbmNvbnN0IFFVRVJZX05BVl9MRVZFTDEgPSBcIi5uYXZfX2xldmVsMSAubmF2X19tYWlubmF2XCJcblxuY29uc3QgUVVFUllfTkFWX0xFVkVMMF9MSU5LID0gXCIubmF2LWxpbmsubmF2LWxpbmstLWhlYWRlclwiXG5jb25zdCBRVUVSWV9OQVZfTEVWRUwxX0xJTksgPSBcIi5uYXYtbGluay0taGVhZGVyXCJcblxuY29uc3QgUVVFUllfTkFWX0NPTFVNTiA9IFwiLm5hdi1jb2xcIlxuY29uc3QgUVVFUllfTkFWX0NPTFVNTl9BQ1RJVkUgPSBcIi5uYXYtY29sLmlzLWFjdGl2ZVwiXG5cbmNvbnN0IFFVRVJZX05BVl9CT0RZID0gXCIubmF2LWJvZHlcIlxuY29uc3QgUVVFUllfTkFWX0ZPT1RFUiA9IFwiLm5hdi1mb290ZXJcIlxuXG5jb25zdCBRVUVSWV9TRUFSQ0hfSUNPTiA9IFwiLm5hdi1zZWFyY2hcIlxuY29uc3QgUVVFUllfU0VBUkNIX0ZJRUxEID0gXCIuc2VhcmNoX19pbnB1dFwiXG5jb25zdCBDTEFTU19TRUFSQ0hfREVTS1RPUCA9IFwic2VhcmNoLS1kZXNrdG9wXCJcblxuY29uc3QgQU5JTUFUSU9OX1NUQVJUX0RFTEFZID0gMjAwXG5jb25zdCBBTklNQVRJT05fT0ZGU0VUID0gNTBcblxuY29uc3QgQU5JTUFUSU9OX0JPRFlfRFVSQVRJT04gPSAzMDBcbmNvbnN0IEFOSU1BVElPTl9GT09URVJfRFVSQVRJT04gPSAxMDBcblxuLyoqXG4gKiBUaGUgbmF2aWdhdGlvbiBjb21wb25lbnQgZGVmaW5pdGlvbi5cbiAqL1xuY2xhc3MgTmF2aWdhdGlvbiBleHRlbmRzIERvbUVsZW1lbnQge1xuICBwdWJsaWMgX25hdkxldmVsMDogSFRNTEVsZW1lbnRcbiAgcHVibGljIF9uYXZMZXZlbDBCb2R5OiBIVE1MRWxlbWVudFxuICBwdWJsaWMgX25hdkxldmVsMTogSFRNTEVsZW1lbnRcblxuICBwdWJsaWMgX2hhbWJ1cmdlckVsZW1lbnQ6IEhUTUxFbGVtZW50XG5cbiAgcHJpdmF0ZSBfbmF2TW9iaWxlOiBIVE1MRWxlbWVudFxuXG4gIHByaXZhdGUgX3NlYXJjaENvbXBvbmVudHM6IFNlYXJjaElucHV0W11cblxuICBwcml2YXRlIF9sZXZlbDBDbGlja0hhbmRsZXI6IChlOiBFdmVudCkgPT4gdm9pZFxuICBwcml2YXRlIF9sZXZlbDFDbGlja0hhbmRsZXI6IChlOiBFdmVudCkgPT4gdm9pZFxuICBwcml2YXRlIF93aW5kb3dDbGlja0hhbmRsZXI6IChlOiBFdmVudCkgPT4gdm9pZFxuICBwcml2YXRlIF9zZWFyY2hDbGlja0hhbmRsZXI6IChlOiBFdmVudCkgPT4gdm9pZFxuXG4gIHByaXZhdGUgYW5pbWF0aW9uOiBBbmltZVRpbWVsaW5lSW5zdGFuY2UgPSBhbmltZS50aW1lbGluZSgpXG4gIHByaXZhdGUgX3NlYXJjaERlc2t0b3A/OiBTZWFyY2hJbnB1dFxuXG4gIGNvbnN0cnVjdG9yKGVsZW1lbnQ6IEVsZW1lbnQpIHtcbiAgICBzdXBlcihlbGVtZW50KVxuXG4gICAgdGhpcy5fbmF2TGV2ZWwwID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoUVVFUllfTkFWX0xFVkVMMCkgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxuICAgIHRoaXMuX25hdkxldmVsMEJvZHkgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihRVUVSWV9OQVZfTEVWRUwwX0NPTlRBSU5FUikgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxuICAgIHRoaXMuX25hdkxldmVsMSA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFFVRVJZX05BVl9MRVZFTDEpIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIilcblxuICAgIHRoaXMuX25hdk1vYmlsZSA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFFVRVJZX05BVl9NT0JJTEUpIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIilcbiAgICBpZiAoIXRoaXMuX25hdk1vYmlsZS5wYXJlbnRFbGVtZW50KSB7XG4gICAgICBsZXQgZHVtbXlQYXJlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpXG4gICAgICBkdW1teVBhcmVudC5hcHBlbmRDaGlsZCh0aGlzLl9uYXZNb2JpbGUpXG4gICAgfVxuXG4gICAgdGhpcy5faGFtYnVyZ2VyRWxlbWVudCA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFFVRVJZX05BVl9IQU1CVVJHRVIpIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIilcbiAgICB0aGlzLl9zZWFyY2hDb21wb25lbnRzID0gW11cblxuICAgIHRoaXMuX2xldmVsMENsaWNrSGFuZGxlciA9IHRoaXMuX2hhbmRsZUxldmVsMENsaWNrLmJpbmQodGhpcylcbiAgICB0aGlzLl9sZXZlbDFDbGlja0hhbmRsZXIgPSB0aGlzLl9oYW5kbGVMZXZlbDFDbGljay5iaW5kKHRoaXMpXG4gICAgdGhpcy5fd2luZG93Q2xpY2tIYW5kbGVyID0gdGhpcy5faGFuZGxlV2luZG93Q2xpY2suYmluZCh0aGlzKVxuICAgIHRoaXMuX3NlYXJjaENsaWNrSGFuZGxlciA9IHRoaXMuX2hhbmRsZVNlYXJjaENsaWNrLmJpbmQodGhpcylcblxuICAgIHRoaXMuX2luaXRpYWxpemUoKVxuICB9XG5cbiAgcHJvdGVjdGVkIF9yZXNldE1haW5UaW1lbGluZSguLi5lbGVtZW50czogSFRNTEVsZW1lbnRbXSkge1xuICAgIHRoaXMuYW5pbWF0aW9uLnBhdXNlKClcbiAgICBmb3IgKGxldCBlbCBvZiBlbGVtZW50cykge1xuICAgICAgYW5pbWUucmVtb3ZlKGVsISlcbiAgICB9XG4gICAgdGhpcy5hbmltYXRpb24gPSBhbmltZS50aW1lbGluZSgpXG4gIH1cblxuICBwcm90ZWN0ZWQgX2lzTW9iaWxlKCkge1xuICAgIHJldHVybiBEb20uaXNIaWRkZW4odGhpcy5faGFtYnVyZ2VyRWxlbWVudCwgdHJ1ZSkgPT09IGZhbHNlXG4gIH1cblxuICBwcm90ZWN0ZWQgX2hhbmRsZUxldmVsMENsaWNrKGV2ZW50OiBFdmVudCkge1xuICAgIGNvbnN0IGlzRGVza3RvcCA9ICF0aGlzLl9pc01vYmlsZSgpXG5cbiAgICBpZiAoaXNEZXNrdG9wKSB7XG4gICAgICBsZXQgbmF2SXRlbXMgPSBuZXcgTmF2aWdhdGlvbkl0ZW1zKHRoaXMpXG4gICAgICAgIC5mcm9tTGV2ZWwwKGV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudClcblxuICAgICAgaWYgKCFuYXZJdGVtcy5zZWN0aW9uKSB7XG4gICAgICAgIHJldHVyblxuICAgICAgfVxuXG4gICAgICBsZXQgcHJldmlvdXNOYXZMaW5rID0gdGhpcy5fbmF2TGV2ZWwwLnF1ZXJ5U2VsZWN0b3IoUVVFUllfTkFWX0xJTktfQUNUSVZFKSEgYXMgSFRNTEVsZW1lbnRcbiAgICAgIGxldCBwcmV2aW91c05hdlNlY3Rpb24gPSB0aGlzLl9uYXZMZXZlbDAucXVlcnlTZWxlY3RvcihRVUVSWV9TRUNUSU9OX09QRU4pISBhcyBIVE1MRWxlbWVudFxuXG4gICAgICB0aGlzLl90b2dnbGVDb250YWluZXIoXG4gICAgICAgIG5hdkl0ZW1zLmxpbmssXG4gICAgICAgIHRoaXMuX25hdkxldmVsMEJvZHksXG4gICAgICAgIG5hdkl0ZW1zLnNlY3Rpb24sXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgcHJldmlvdXNOYXZMaW5rLFxuICAgICAgICB0aGlzLl9uYXZMZXZlbDBCb2R5LFxuICAgICAgICBwcmV2aW91c05hdlNlY3Rpb24sXG4gICAgICAgIHVuZGVmaW5lZCxcbiAgICAgICAgdHJ1ZVxuICAgICAgKVxuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBfaGFuZGxlTGV2ZWwxQ2xpY2soZXZlbnQ6IEV2ZW50KSB7XG4gICAgbGV0IG5hdkl0ZW1zID0gbmV3IE5hdmlnYXRpb25JdGVtcyh0aGlzKVxuICAgICAgLmZyb21MZXZlbDEoZXZlbnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50KVxuXG4gICAgbGV0IHByZXZJdGVtcyA9IG5hdkl0ZW1zLnByZXZpb3VzTGV2ZWwxKClcblxuICAgIHRoaXMuX3RvZ2dsZUNvbnRhaW5lcihcbiAgICAgIG5hdkl0ZW1zLmxpbmssXG4gICAgICBuYXZJdGVtcy5jb250YWluZXIsXG4gICAgICBuYXZJdGVtcy5zZWN0aW9uLFxuICAgICAgbmF2SXRlbXMuZm9vdGVyLFxuICAgICAgcHJldkl0ZW1zLmxpbmssXG4gICAgICBwcmV2SXRlbXMuY29udGFpbmVyLFxuICAgICAgcHJldkl0ZW1zLnNlY3Rpb24sXG4gICAgICBwcmV2SXRlbXMuZm9vdGVyLFxuICAgICAgZmFsc2VcbiAgICApXG5cbiAgICByZXR1cm4gZmFsc2VcbiAgfVxuXG4gIHByb3RlY3RlZCBfdG9nZ2xlQ29udGFpbmVyKFxuICAgIG5hdkxpbms6IEhUTUxFbGVtZW50LFxuICAgIG5hdkNvbnRhaW5lcj86IEhUTUxFbGVtZW50LFxuICAgIG5hdlNlY3Rpb24/OiBIVE1MRWxlbWVudCxcbiAgICBuYXZGb290ZXI/OiBIVE1MRWxlbWVudCxcbiAgICBwcmV2aW91c05hdkxpbms/OiBIVE1MRWxlbWVudCxcbiAgICBwcmV2aW91c05hdkNvbnRhaW5lcj86IEhUTUxFbGVtZW50LFxuICAgIHByZXZpb3VzTmF2U2VjdGlvbj86IEhUTUxFbGVtZW50LFxuICAgIHByZXZpb3VzTmF2Rm9vdGVyPzogSFRNTEVsZW1lbnQsXG4gICAgYW5pbWF0ZUNvbnRhaW5lciA9IGZhbHNlXG4gICkge1xuICAgIGNvbnN0IGlzRGVza3RvcCA9ICF0aGlzLl9pc01vYmlsZSgpXG5cbiAgICBpZiAocHJldmlvdXNOYXZMaW5rICYmIHByZXZpb3VzTmF2TGluayAhPT0gbmF2TGluayAmJiBuYXZMaW5rICE9PSB0aGlzLl9oYW1idXJnZXJFbGVtZW50KSB7XG4gICAgICBEb20ucmVtb3ZlQ2xhc3MocHJldmlvdXNOYXZMaW5rLCBDTEFTU19BQ1RJVkUpXG4gICAgfVxuXG4gICAgdGhpcy5fcmVzZXRNYWluVGltZWxpbmUobmF2Q29udGFpbmVyISwgbmF2U2VjdGlvbiEsIG5hdkZvb3RlciEsIHByZXZpb3VzTmF2Q29udGFpbmVyISwgcHJldmlvdXNOYXZTZWN0aW9uISwgcHJldmlvdXNOYXZGb290ZXIhKVxuXG4gICAgaWYgKERvbS5oYXNDbGFzcyhuYXZMaW5rLCBDTEFTU19BQ1RJVkUpKSB7XG4gICAgICBEb20ucmVtb3ZlQ2xhc3MobmF2TGluaywgQ0xBU1NfQUNUSVZFKVxuXG4gICAgICBpZiAoaXNEZXNrdG9wKSB7XG4gICAgICAgIHRoaXMuX29uTmF2aWdhdGlvbkNsb3NlZCgpXG5cbiAgICAgICAgdGhpcy5fY2xvc2VTZWN0aW9uKG5hdkNvbnRhaW5lciwgbmF2U2VjdGlvbiwgbmF2Rm9vdGVyLCB0cnVlLCBhbmltYXRlQ29udGFpbmVyKVxuICAgICAgfSBlbHNlIGlmIChuYXZMaW5rID09PSB0aGlzLl9oYW1idXJnZXJFbGVtZW50KSB7XG4gICAgICAgIC8vIENsb3NlIG1vYmlsZSBuYXZpZ2F0aW9uXG4gICAgICAgIHRoaXMuX29uTmF2aWdhdGlvbkNsb3NlZCgpXG5cbiAgICAgICAgdGhpcy5fY2xvc2VTZWN0aW9uKG5hdkNvbnRhaW5lciwgbmF2U2VjdGlvbiwgdW5kZWZpbmVkLCBmYWxzZSwgZmFsc2UpXG4gICAgICB9IGVsc2UgaWYgKCFpc0Rlc2t0b3ApIHtcbiAgICAgICAgLy8gQ2xvc2UgdGhlIHNlY3Rpb25cbiAgICAgICAgdGhpcy5fY2xvc2VTZWN0aW9uKG5hdkNvbnRhaW5lciwgbmF2U2VjdGlvbiwgbmF2Rm9vdGVyLCB0cnVlLCBhbmltYXRlQ29udGFpbmVyKVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBEb20uYWRkQ2xhc3MobmF2TGluaywgQ0xBU1NfQUNUSVZFKVxuXG4gICAgICBpZiAoaXNEZXNrdG9wKSB7XG4gICAgICAgIERvbS5hZGRDbGFzcyh0aGlzLl9uYXZNb2JpbGUsIENMQVNTX09QRU4pXG4gICAgICAgIHRoaXMuX29uTmF2aWdhdGlvbk9wZW5lZCgpXG5cbiAgICAgICAgaWYgKHByZXZpb3VzTmF2Q29udGFpbmVyICYmIHByZXZpb3VzTmF2U2VjdGlvbikge1xuICAgICAgICAgIHRoaXMuX2Nsb3NlU2VjdGlvbihwcmV2aW91c05hdkNvbnRhaW5lciwgcHJldmlvdXNOYXZTZWN0aW9uLCBwcmV2aW91c05hdkZvb3RlciwgdHJ1ZSwgYW5pbWF0ZUNvbnRhaW5lcilcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9vcGVuU2VjdGlvbihuYXZDb250YWluZXIsIG5hdlNlY3Rpb24sIG5hdkZvb3RlciwgdHJ1ZSwgYW5pbWF0ZUNvbnRhaW5lcilcbiAgICAgIH0gZWxzZSBpZiAobmF2TGluayA9PT0gdGhpcy5faGFtYnVyZ2VyRWxlbWVudCkge1xuICAgICAgICAvLyBPcGVuIG1vYmlsZSBuYXZpZ2F0aW9uXG4gICAgICAgIHRoaXMuX29uTmF2aWdhdGlvbk9wZW5lZCgpXG5cbiAgICAgICAgdGhpcy5fb3BlblNlY3Rpb24obmF2Q29udGFpbmVyLCBuYXZTZWN0aW9uLCB1bmRlZmluZWQsIGZhbHNlLCBmYWxzZSlcbiAgICAgIH0gZWxzZSBpZiAoIWlzRGVza3RvcCkge1xuICAgICAgICAvLyBPcGVuIHNlY3Rpb25cbiAgICAgICAgaWYgKHByZXZpb3VzTmF2Q29udGFpbmVyICYmIHByZXZpb3VzTmF2U2VjdGlvbikge1xuICAgICAgICAgIHRoaXMuX2Nsb3NlU2VjdGlvbihwcmV2aW91c05hdkNvbnRhaW5lciwgcHJldmlvdXNOYXZTZWN0aW9uLCBwcmV2aW91c05hdkZvb3RlciwgdHJ1ZSwgYW5pbWF0ZUNvbnRhaW5lcilcbiAgICAgICAgICB0aGlzLmFuaW1hdGlvbiA9IGFuaW1lLnRpbWVsaW5lKClcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9vcGVuU2VjdGlvbihuYXZDb250YWluZXIsIG5hdlNlY3Rpb24sIG5hdkZvb3RlciwgdHJ1ZSwgYW5pbWF0ZUNvbnRhaW5lcilcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgX29uTmF2aWdhdGlvbk9wZW5lZCgpIHtcbiAgICBEb20uYWRkQ2xhc3ModGhpcy5fbmF2TW9iaWxlLCBDTEFTU19PUEVOKVxuICAgIERvbS5hZGRDbGFzcyh0aGlzLl9uYXZNb2JpbGUucGFyZW50RWxlbWVudCEsIENMQVNTX09QRU4pXG4gICAgRG9tLmFkZENsYXNzKHRoaXMuX2hhbWJ1cmdlckVsZW1lbnQsIENMQVNTX0FDVElWRSlcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5fd2luZG93Q2xpY2tIYW5kbGVyKVxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgdGhpcy5fd2luZG93Q2xpY2tIYW5kbGVyKVxuICB9XG5cbiAgcHJvdGVjdGVkIF9vbk5hdmlnYXRpb25DbG9zZWQoKSB7XG4gICAgRG9tLnJlbW92ZUNsYXNzKHRoaXMuX25hdk1vYmlsZSwgQ0xBU1NfT1BFTilcbiAgICBEb20ucmVtb3ZlQ2xhc3ModGhpcy5fbmF2TW9iaWxlLnBhcmVudEVsZW1lbnQhLCBDTEFTU19PUEVOKVxuICAgIERvbS5yZW1vdmVDbGFzcyh0aGlzLl9oYW1idXJnZXJFbGVtZW50LCBDTEFTU19BQ1RJVkUpXG5cbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX3dpbmRvd0NsaWNrSGFuZGxlcilcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRvdWNoZW5kXCIsIHRoaXMuX3dpbmRvd0NsaWNrSGFuZGxlcilcbiAgfVxuXG4gIHByb3RlY3RlZCBfaGFuZGxlV2luZG93Q2xpY2soZXZlbnQ6IEV2ZW50KSB7XG4gICAgbGV0IHRhcmdldCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudFxuXG4gICAgd2hpbGUgKHRhcmdldCAhPT0gdGhpcy5lbGVtZW50ICYmIHRhcmdldC5wYXJlbnRFbGVtZW50KSB7XG4gICAgICB0YXJnZXQgPSB0YXJnZXQucGFyZW50RWxlbWVudFxuICAgIH1cblxuICAgIGlmICh0YXJnZXQgIT09IHRoaXMuZWxlbWVudCkge1xuICAgICAgdGhpcy5jbG9zZSgpXG4gICAgICByZXR1cm4gZmFsc2VcbiAgICB9XG5cbiAgICByZXR1cm4gdHJ1ZVxuICB9XG5cbiAgcHJvdGVjdGVkIF9vcGVuU2VjdGlvbihcbiAgICBuYXZDb250YWluZXI/OiBIVE1MRWxlbWVudCxcbiAgICBuYXZTZWN0aW9uPzogSFRNTEVsZW1lbnQsXG4gICAgbmF2Rm9vdGVyPzogSFRNTEVsZW1lbnQsXG4gICAgYW5pbWF0ZUNvbHVtbnMgPSB0cnVlLFxuICAgIGFuaW1hdGVDb250YWluZXIgPSBmYWxzZVxuICApIHtcbiAgICBpZiAoIW5hdlNlY3Rpb24gfHwgIW5hdkNvbnRhaW5lcikge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgbGV0IGFjdGl2ZUl0ZW1zID0gbmF2U2VjdGlvbi5xdWVyeVNlbGVjdG9yQWxsKFFVRVJZX05BVl9DT0xVTU4pXG5cbiAgICBpZiAoYW5pbWF0ZUNvbnRhaW5lciA9PT0gdHJ1ZSkge1xuICAgICAgbGV0IGNvbnRhaW5lciA9IG5hdkNvbnRhaW5lclxuICAgICAgbmF2Q29udGFpbmVyID0gbmF2U2VjdGlvblxuICAgICAgbmF2U2VjdGlvbiA9IGNvbnRhaW5lclxuICAgIH1cblxuICAgIERvbS5hZGRDbGFzcyhuYXZDb250YWluZXIhLCBDTEFTU19PUEVOKVxuXG4gICAgbmF2U2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiXG5cbiAgICB0aGlzLmFuaW1hdGlvbi5hZGQoe1xuICAgICAgdGFyZ2V0czogbmF2U2VjdGlvbixcbiAgICAgIGR1cmF0aW9uOiBBTklNQVRJT05fQk9EWV9EVVJBVElPTixcbiAgICAgIGVhc2luZzogXCJjdWJpY0JlemllcigwLjU1MCwgMC4wODUsIDAuMzIwLCAxKVwiLFxuICAgICAgaGVpZ2h0OiBhbmltYXRlQ29udGFpbmVyID8gbmF2Q29udGFpbmVyLnNjcm9sbEhlaWdodCA6IG5hdlNlY3Rpb24uc2Nyb2xsSGVpZ2h0LFxuICAgICAgY29tcGxldGU6ICgpID0+IHtcbiAgICAgICAgRG9tLmFkZENsYXNzKG5hdlNlY3Rpb24hLCBDTEFTU19PUEVOKVxuICAgICAgICBuZXcgRG9tRWxlbWVudChuYXZTZWN0aW9uISkuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJcIilcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgaWYgKG5hdkZvb3Rlcikge1xuICAgICAgY29uc3QgbmF2SXRlbXMgPSBuYXZGb290ZXIucXVlcnlTZWxlY3RvckFsbChRVUVSWV9OQVZfQ09MVU1OKVxuICAgICAgZm9yIChsZXQgaXRlbSBvZiBuYXZJdGVtcykge1xuICAgICAgICBEb20uYWRkQ2xhc3MoaXRlbSwgQ0xBU1NfQUNUSVZFKVxuICAgICAgfVxuXG4gICAgICBuYXZGb290ZXIuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIlxuXG4gICAgICB0aGlzLmFuaW1hdGlvbi5hZGQoe1xuICAgICAgICB0YXJnZXRzOiBuYXZGb290ZXIsXG4gICAgICAgIGR1cmF0aW9uOiBBTklNQVRJT05fRk9PVEVSX0RVUkFUSU9OLFxuICAgICAgICBlYXNpbmc6IFwiY3ViaWNCZXppZXIoMC41NTAsIDAuMDg1LCAwLjMyMCwgMSlcIixcbiAgICAgICAgaGVpZ2h0OiBuYXZGb290ZXIuc2Nyb2xsSGVpZ2h0LFxuICAgICAgICBvZmZzZXQ6IGAtPSR7QU5JTUFUSU9OX0ZPT1RFUl9EVVJBVElPTn1gLFxuICAgICAgICBjb21wbGV0ZTogKCkgPT4ge1xuICAgICAgICAgIERvbS5hZGRDbGFzcyhuYXZGb290ZXIhLCBDTEFTU19PUEVOKVxuICAgICAgICAgIG5ldyBEb21FbGVtZW50KG5hdkZvb3RlciEpLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiXCIpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuXG4gICAgaWYgKGFuaW1hdGVDb2x1bW5zID09PSB0cnVlKSB7XG4gICAgICBsZXQgZGVsYXkgPSBBTklNQVRJT05fU1RBUlRfREVMQVlcblxuICAgICAgZm9yIChsZXQgaXRlbSBvZiBhY3RpdmVJdGVtcykge1xuICAgICAgICB0aGlzLmFuaW1hdGlvbi5hZGQoe1xuICAgICAgICAgIHRhcmdldHM6IGl0ZW0sXG4gICAgICAgICAgZHVyYXRpb246IDAsXG4gICAgICAgICAgb2Zmc2V0OiBkZWxheSxcbiAgICAgICAgICBjb21wbGV0ZTogKCkgPT4ge1xuICAgICAgICAgICAgRG9tLmFkZENsYXNzKGl0ZW0sIENMQVNTX0FDVElWRSlcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgIGRlbGF5ICs9IEFOSU1BVElPTl9PRkZTRVRcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgX2Nsb3NlU2VjdGlvbihcbiAgICBuYXZDb250YWluZXI/OiBIVE1MRWxlbWVudCxcbiAgICBuYXZTZWN0aW9uPzogSFRNTEVsZW1lbnQsXG4gICAgbmF2Rm9vdGVyPzogSFRNTEVsZW1lbnQsXG4gICAgYW5pbWF0ZUNvbHVtbnMgPSB0cnVlLFxuICAgIGFuaW1hdGVDb250YWluZXIgPSBmYWxzZVxuICApIHtcbiAgICBpZiAoIW5hdlNlY3Rpb24gfHwgIW5hdkNvbnRhaW5lcikge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgbGV0IGFjdGl2ZUl0ZW1zID0gbmF2U2VjdGlvbi5xdWVyeVNlbGVjdG9yQWxsKFFVRVJZX05BVl9DT0xVTU5fQUNUSVZFKVxuXG4gICAgaWYgKGFuaW1hdGVDb250YWluZXIgPT09IHRydWUpIHtcbiAgICAgIGxldCBjb250YWluZXIgPSBuYXZDb250YWluZXJcbiAgICAgIG5hdkNvbnRhaW5lciA9IG5hdlNlY3Rpb25cbiAgICAgIG5hdlNlY3Rpb24gPSBjb250YWluZXJcbiAgICB9XG5cbiAgICBpZiAoYW5pbWF0ZUNvbHVtbnMgPT09IHRydWUpIHtcbiAgICAgIGZvciAobGV0IGFjdGl2ZSBvZiBhY3RpdmVJdGVtcykge1xuICAgICAgICBEb20ucmVtb3ZlQ2xhc3MoYWN0aXZlLCBDTEFTU19BQ1RJVkUpXG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5hbmltYXRpb24uYWRkKHtcbiAgICAgIHRhcmdldHM6IG5hdlNlY3Rpb24sXG4gICAgICBkdXJhdGlvbjogQU5JTUFUSU9OX0JPRFlfRFVSQVRJT04sXG4gICAgICBlYXNpbmc6IFwiY3ViaWNCZXppZXIoMC41NTAsIDAuMDg1LCAwLjMyMCwgMSlcIixcbiAgICAgIGhlaWdodDogMCxcbiAgICAgIG9mZnNldDogMCxcbiAgICAgIGNvbXBsZXRlOiAoKSA9PiB7XG4gICAgICAgIERvbS5yZW1vdmVDbGFzcyhuYXZDb250YWluZXIhLCBDTEFTU19PUEVOKVxuICAgICAgICBEb20ucmVtb3ZlQ2xhc3MobmF2U2VjdGlvbiEsIENMQVNTX09QRU4pXG4gICAgICAgIG5hdlNlY3Rpb24hLnN0eWxlLmhlaWdodCA9IFwiXCJcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgaWYgKG5hdkZvb3Rlcikge1xuICAgICAgZm9yIChsZXQgYWN0aXZlIG9mIG5hdkZvb3Rlci5xdWVyeVNlbGVjdG9yQWxsKFFVRVJZX05BVl9DT0xVTU5fQUNUSVZFKSkge1xuICAgICAgICBEb20ucmVtb3ZlQ2xhc3MoYWN0aXZlLCBDTEFTU19BQ1RJVkUpXG4gICAgICB9XG5cbiAgICAgIHRoaXMuYW5pbWF0aW9uLmFkZCh7XG4gICAgICAgIHRhcmdldHM6IG5hdkZvb3RlcixcbiAgICAgICAgZHVyYXRpb246IEFOSU1BVElPTl9GT09URVJfRFVSQVRJT04sXG4gICAgICAgIGVhc2luZzogXCJjdWJpY0JlemllcigwLjU1MCwgMC4wODUsIDAuMzIwLCAxKVwiLFxuICAgICAgICBoZWlnaHQ6IDAsXG4gICAgICAgIG9mZnNldDogMCxcbiAgICAgICAgY29tcGxldGU6ICgpID0+IHtcbiAgICAgICAgICBEb20ucmVtb3ZlQ2xhc3MobmF2Rm9vdGVyISwgQ0xBU1NfT1BFTilcbiAgICAgICAgICBuYXZGb290ZXIhLnN0eWxlLmhlaWdodCA9IFwiXCJcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgX2hhbmRsZVNlYXJjaENsaWNrKCkge1xuICAgIGlmICh0aGlzLl9zZWFyY2hEZXNrdG9wKSB7XG4gICAgICB0aGlzLl9zZWFyY2hEZXNrdG9wLm9wZW4oKVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplcyB0aGUgbmF2aWdhdGlvbiBjb21wb25lbnQuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcm90ZWN0ZWQgX2luaXRpYWxpemUoKSB7XG4gICAgZm9yIChsZXQgbmF2TGluayBvZiB0aGlzLl9uYXZMZXZlbDAucXVlcnlTZWxlY3RvckFsbChRVUVSWV9OQVZfTEVWRUwwX0xJTkspKSB7XG4gICAgICBuYXZMaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9sZXZlbDBDbGlja0hhbmRsZXIpXG4gICAgfVxuXG4gICAgZm9yIChsZXQgbmF2TGluayBvZiB0aGlzLl9uYXZMZXZlbDEucXVlcnlTZWxlY3RvckFsbChRVUVSWV9OQVZfTEVWRUwxX0xJTkspKSB7XG4gICAgICBuYXZMaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9sZXZlbDFDbGlja0hhbmRsZXIpXG4gICAgfVxuXG4gICAgdGhpcy5faGFtYnVyZ2VyRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5fbGV2ZWwxQ2xpY2tIYW5kbGVyKVxuXG4gICAgLy8gRGVza3RvcCBzZWFyY2ggaWNvblxuICAgIGxldCBzZWFyY2hJY29uID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoUVVFUllfU0VBUkNIX0lDT04pXG4gICAgaWYgKHNlYXJjaEljb24pIHtcbiAgICAgIHNlYXJjaEljb24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX3NlYXJjaENsaWNrSGFuZGxlcilcbiAgICB9XG5cbiAgICBmb3IgKGxldCBzZWFyY2ggb2YgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoUVVFUllfU0VBUkNIX0ZJRUxEKSkge1xuICAgICAgbGV0IHNlYXJjaENvbXBvbmVudCA9IG5ldyBTZWFyY2hJbnB1dChzZWFyY2ggYXMgSFRNTEVsZW1lbnQpXG5cbiAgICAgIGlmIChEb20uaGFzQ2xhc3Moc2VhcmNoLCBDTEFTU19TRUFSQ0hfREVTS1RPUCkgfHwgRG9tLmhhc0NsYXNzKHNlYXJjaC5wYXJlbnRFbGVtZW50ISwgQ0xBU1NfU0VBUkNIX0RFU0tUT1ApKSB7XG4gICAgICAgIHRoaXMuX3NlYXJjaERlc2t0b3AgPSBzZWFyY2hDb21wb25lbnRcbiAgICAgIH1cblxuICAgICAgdGhpcy5fc2VhcmNoQ29tcG9uZW50cy5wdXNoKHNlYXJjaENvbXBvbmVudClcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2xvc2VzIHRoZSBuYXZpZ2F0aW9uLlxuICAgKi9cbiAgcHVibGljIGNsb3NlKCkge1xuICAgIGxldCBpc01vYmxlID0gdGhpcy5faXNNb2JpbGUoKVxuXG4gICAgbGV0IGxldmVsMSA9IHRoaXMuX25hdkxldmVsMS5xdWVyeVNlbGVjdG9yKFFVRVJZX05BVl9MSU5LX0FDVElWRSkgYXMgSFRNTEVsZW1lbnRcbiAgICBsZXQgbGV2ZWwwID0gdGhpcy5fbmF2TGV2ZWwwLnF1ZXJ5U2VsZWN0b3IoUVVFUllfTkFWX0xJTktfQUNUSVZFKSBhcyBIVE1MRWxlbWVudFxuXG4gICAgaWYgKCFsZXZlbDEgJiYgaXNNb2JsZSAmJiBEb20uaGFzQ2xhc3ModGhpcy5faGFtYnVyZ2VyRWxlbWVudCwgQ0xBU1NfQUNUSVZFKSkge1xuICAgICAgbGV2ZWwxID0gdGhpcy5faGFtYnVyZ2VyRWxlbWVudFxuICAgIH1cblxuICAgIGxldCBuYXZJdGVtc1xuXG4gICAgaWYgKGxldmVsMSkge1xuICAgICAgbmF2SXRlbXMgPSBuZXcgTmF2aWdhdGlvbkl0ZW1zKHRoaXMpLmZyb21MZXZlbDEobGV2ZWwxKVxuICAgIH0gZWxzZSBpZiAobGV2ZWwwKSB7XG4gICAgICBuYXZJdGVtcyA9IG5ldyBOYXZpZ2F0aW9uSXRlbXModGhpcykuZnJvbUxldmVsMChsZXZlbDApXG4gICAgfVxuXG4gICAgaWYgKG5hdkl0ZW1zKSB7XG4gICAgICB0aGlzLl9yZXNldE1haW5UaW1lbGluZShuYXZJdGVtcy5jb250YWluZXIhLCBuYXZJdGVtcy5zZWN0aW9uISwgbmF2SXRlbXMuZm9vdGVyISlcbiAgICAgIERvbS5yZW1vdmVDbGFzcyhuYXZJdGVtcy5saW5rLCBDTEFTU19BQ1RJVkUpXG4gICAgICB0aGlzLl9vbk5hdmlnYXRpb25DbG9zZWQoKVxuICAgICAgdGhpcy5fY2xvc2VTZWN0aW9uKG5hdkl0ZW1zLmNvbnRhaW5lciEsIG5hdkl0ZW1zLnNlY3Rpb24hLCBuYXZJdGVtcy5mb290ZXIsICFpc01vYmxlLCBmYWxzZSlcbiAgICB9XG5cbiAgfVxufVxuXG5jbGFzcyBOYXZpZ2F0aW9uSXRlbXMge1xuICBwcml2YXRlIF9uYXZpZ2F0aW9uOiBOYXZpZ2F0aW9uXG4gIHByaXZhdGUgX2xpbmshOiBIVE1MRWxlbWVudFxuICBwcml2YXRlIF9jb250YWluZXI/OiBIVE1MRWxlbWVudFxuICBwcml2YXRlIF9zZWN0aW9uPzogSFRNTEVsZW1lbnRcbiAgcHJpdmF0ZSBfZm9vdGVyPzogSFRNTEVsZW1lbnRcbiAgY29uc3RydWN0b3IobmF2OiBOYXZpZ2F0aW9uKSB7XG4gICAgdGhpcy5fbmF2aWdhdGlvbiA9IG5hdlxuICB9XG5cbiAgZ2V0IGxpbmsoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2xpbmtcbiAgfVxuXG4gIGdldCBjb250YWluZXIoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2NvbnRhaW5lclxuICB9XG5cbiAgZ2V0IHNlY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3NlY3Rpb25cbiAgfVxuXG4gIGdldCBmb290ZXIoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2Zvb3RlclxuICB9XG5cbiAgcHVibGljIGZyb21MZXZlbDAobmF2TGluazogSFRNTEVsZW1lbnQpIHtcbiAgICB3aGlsZSAoIURvbS5oYXNDbGFzcyhuYXZMaW5rLCBDTEFTU19OQVZfTElOSykgJiYgbmF2TGluay5wYXJlbnRFbGVtZW50KSB7XG4gICAgICBuYXZMaW5rID0gbmF2TGluay5wYXJlbnRFbGVtZW50XG4gICAgfVxuXG4gICAgdGhpcy5fbGluayA9IG5hdkxpbmtcblxuICAgIGxldCB0b2dnbGVJZCA9IG5hdkxpbmsuZ2V0QXR0cmlidXRlKFwiZGF0YS10b2dnbGVcIilcbiAgICB0aGlzLl9jb250YWluZXIgPSB0aGlzLl9uYXZpZ2F0aW9uLl9uYXZMZXZlbDBCb2R5XG4gICAgdGhpcy5fc2VjdGlvbiA9IHRoaXMuX25hdmlnYXRpb24uX25hdkxldmVsMC5xdWVyeVNlbGVjdG9yKGAjJHt0b2dnbGVJZH1gKSEgYXMgSFRNTEVsZW1lbnRcblxuICAgIHJldHVybiB0aGlzXG4gIH1cblxuICBwdWJsaWMgZnJvbUxldmVsMShuYXZMaW5rOiBIVE1MRWxlbWVudCkge1xuICAgIHdoaWxlIChuYXZMaW5rLnBhcmVudEVsZW1lbnQpIHtcbiAgICAgIGlmICgobmF2TGluayA9PT0gdGhpcy5fbmF2aWdhdGlvbi5faGFtYnVyZ2VyRWxlbWVudCkgfHwgRG9tLmhhc0NsYXNzKG5hdkxpbmssIENMQVNTX05BVl9MSU5LKSkge1xuICAgICAgICBicmVha1xuICAgICAgfVxuXG4gICAgICBuYXZMaW5rID0gbmF2TGluay5wYXJlbnRFbGVtZW50XG4gICAgfVxuXG4gICAgdGhpcy5fbGluayA9IG5hdkxpbmtcbiAgICB0aGlzLl9jb250YWluZXIgPSBuYXZMaW5rLnBhcmVudEVsZW1lbnQhIGFzIEhUTUxFbGVtZW50XG4gICAgdGhpcy5fc2VjdGlvbiA9IHRoaXMuX2NvbnRhaW5lciEucXVlcnlTZWxlY3RvcihRVUVSWV9OQVZfQk9EWSkhIGFzIEhUTUxFbGVtZW50XG4gICAgdGhpcy5fZm9vdGVyID0gdGhpcy5fY29udGFpbmVyIS5xdWVyeVNlbGVjdG9yKFFVRVJZX05BVl9GT09URVIpISBhcyBIVE1MRWxlbWVudFxuXG4gICAgaWYgKG5hdkxpbmsgPT09IHRoaXMuX25hdmlnYXRpb24uX2hhbWJ1cmdlckVsZW1lbnQpIHtcbiAgICAgIHRoaXMuX2NvbnRhaW5lciA9IHRoaXMuX25hdmlnYXRpb24uX25hdkxldmVsMVxuICAgICAgdGhpcy5fc2VjdGlvbiA9IHRoaXMuX2NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFFVRVJZX05BVl9IQl9CT0RZKSEgYXMgSFRNTEVsZW1lbnRcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpc1xuICB9XG5cbiAgcHVibGljIHByZXZpb3VzTGV2ZWwxKCkge1xuICAgIGxldCBwcmV2ID0gbmV3IE5hdmlnYXRpb25JdGVtcyh0aGlzLl9uYXZpZ2F0aW9uKVxuXG4gICAgcHJldi5fbGluayA9IHRoaXMuX25hdmlnYXRpb24uX25hdkxldmVsMS5xdWVyeVNlbGVjdG9yKFFVRVJZX05BVl9MSU5LX0FDVElWRSkhIGFzIEhUTUxFbGVtZW50XG4gICAgcHJldi5fY29udGFpbmVyID0gcHJldi5fbGluayA/IHByZXYuX2xpbmsucGFyZW50RWxlbWVudCEgOiB1bmRlZmluZWRcbiAgICBwcmV2Ll9zZWN0aW9uID0gcHJldi5fY29udGFpbmVyID8gcHJldi5fY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoUVVFUllfTkFWX0JPRFkpISBhcyBIVE1MRWxlbWVudCA6IHVuZGVmaW5lZFxuICAgIHByZXYuX2Zvb3RlciA9IHByZXYuX2NvbnRhaW5lciA/IHByZXYuX2NvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFFVRVJZX05BVl9GT09URVIpISBhcyBIVE1MRWxlbWVudCA6IHVuZGVmaW5lZFxuXG4gICAgcmV0dXJuIHByZXZcbiAgfVxuXG4gIHB1YmxpYyBpc0hhbWJ1cmdlcigpIHtcbiAgICByZXR1cm4gdGhpcy5fbGluayA9PT0gdGhpcy5fbmF2aWdhdGlvbi5faGFtYnVyZ2VyRWxlbWVudFxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0KCkge1xuICBzZWFyY2hBbmRJbml0aWFsaXplKFwiLm5hdlwiLCAoZSkgPT4ge1xuICAgIG5ldyBOYXZpZ2F0aW9uKGUpXG4gIH0pXG59XG5cbmV4cG9ydCBkZWZhdWx0IE5hdmlnYXRpb25cbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4vLi4ifQ==
