import * as tslib_1 from "tslib";
import anime from "animejs";
import { searchAndInitialize, clamp } from "../Utils";
import DomElement from "../DomElement";
var CLASS_BAR = ".progress-light__bar";
var CLASS_PROGRESS = ".bar__progress";
var CLASS_PROGRESS_COMPLETED = "bar__progress--complete";
var CLASS_TICK = "bar__tick";
var CLASS_PAGE_CURRENT = ".detail__currentpage";
var CLASS_PAGE_TOTAL = ".detail__totalpage";
var CLASS_DISABLED = "arrow--disabled";
var CLASS_BUTTON_LEFT = ".arrow--left";
var CLASS_BUTTON_RIGHT = ".arrow--right";
/**
 * Light progress bar component
 */
var ProgressLight = /** @class */ (function (_super) {
    tslib_1.__extends(ProgressLight, _super);
    /**
     * Creates and initializes the ProgressLight component.
     * @param {DomElement} - The root element of the ProgressLight component.
     */
    function ProgressLight(element) {
        var _this = _super.call(this, element) || this;
        _this._initialize();
        return _this;
    }
    /**
     * Initializes the loader bar component.
     * @private
     */
    ProgressLight.prototype._initialize = function () {
        this._buttonClickHandler = this._handleButtonClick.bind(this);
        this._animationCompletedHandler = this._handleAnimationCompleted.bind(this);
        this._barElement = this.find(CLASS_BAR);
        this._progressElement = this.find(CLASS_PROGRESS);
        this._pageCurrentElement = this.find(CLASS_PAGE_CURRENT);
        this._pageTotalElement = this.find(CLASS_PAGE_TOTAL);
        this._buttonLeft = this.find(CLASS_BUTTON_LEFT);
        this._buttonRight = this.find(CLASS_BUTTON_RIGHT);
        this._minValue = 1;
        this._total = Math.max(parseInt(this.getAttribute("total") || "100", 10), this._minValue);
        this._value = clamp(parseInt(this.getAttribute("value") || "1", 10), this._minValue, this._total);
        this._layout();
        this._addTicks();
        this._update(false);
        this.enable();
    };
    ProgressLight.prototype._addTicks = function () {
        for (var i = 1; i < this._total; i++) {
            var position = this._itemWidth * i;
            var tickElement = new DomElement("div")
                .addClass(CLASS_TICK)
                .setAttribute("style", "left: " + position + "%");
            this._barElement.prependChild(tickElement);
        }
    };
    ProgressLight.prototype._update = function (animate) {
        var _this = this;
        if (animate === void 0) { animate = true; }
        this._pageCurrentElement.setHtml(this._value.toString());
        this._pageTotalElement.setHtml(this._total.toString());
        var position = this._value * this._itemWidth;
        // Add additional width to the last element to make sure
        // the rounded border on the left is filled as well
        if (this._value === this._total) {
            position += 5;
        }
        if (this._value >= this._total) {
            this._buttonRight.addClass(CLASS_DISABLED);
        }
        else {
            this._buttonRight.removeClass(CLASS_DISABLED);
        }
        if (this._value <= this._minValue) {
            this._buttonLeft.addClass(CLASS_DISABLED);
        }
        else {
            this._buttonLeft.removeClass(CLASS_DISABLED);
        }
        var el = this._progressElement.element;
        if (animate) {
            anime({
                targets: this._progressElement.element,
                duration: 200,
                easing: "easeInOutQuint",
                width: this._barElement.element.clientWidth * position / 100,
                complete: function () {
                    el.style.width = position + "%";
                    _this._animationCompletedHandler({});
                }
            });
        }
        else {
            el.style.width = position + "%";
            this._animationCompletedHandler({});
        }
    };
    ProgressLight.prototype._layout = function () {
        this._itemWidth = Math.floor(100 / this._total);
    };
    ProgressLight.prototype._handleButtonClick = function (event) {
        if (event.target === this._buttonLeft.element) {
            this.value = this._value - 1;
        }
        else if (event.target === this._buttonRight.element) {
            this.value = this._value + 1;
        }
    };
    ProgressLight.prototype._handleAnimationCompleted = function () {
        if (this._value === this._total) {
            this._progressElement.addClass(CLASS_PROGRESS_COMPLETED);
        }
        else {
            this._progressElement.removeClass(CLASS_PROGRESS_COMPLETED);
        }
    };
    Object.defineProperty(ProgressLight.prototype, "value", {
        /**
         * Gets the current progress value in the range of 1..total.
         */
        get: function () {
            return this._value;
        },
        /**
         * Sets the current progress.
         * @param {number} - The progress in the range of 1..total.
         */
        set: function (val) {
            this._value = clamp(val, this._minValue, this._total);
            this._update(true);
            this.dispatchEvent("changed");
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ProgressLight.prototype, "total", {
        /**
         * Gets the total progress value.
         */
        get: function () {
            return this._total;
        },
        /**
         * Sets the total progress value and updates the UI accordingly.
         * @param {number} - The total progress positive integer value.
         */
        set: function (value) {
            var e_1, _a;
            if (this._total === value) {
                return;
            }
            this._total = Math.max(value, this._minValue);
            this._value = clamp(this._value, this._minValue, this._total);
            try {
                // Clear the ticks
                for (var _b = tslib_1.__values(this.element.querySelectorAll("." + CLASS_TICK)), _c = _b.next(); !_c.done; _c = _b.next()) {
                    var tick = _c.value;
                    this._barElement.element.removeChild(tick);
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                }
                finally { if (e_1) throw e_1.error; }
            }
            this._layout();
            this._addTicks();
            this._update(false);
            this.dispatchEvent("totalchanged");
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Enables the component.
     */
    ProgressLight.prototype.enable = function () {
        this._buttonLeft.element.addEventListener("click", this._buttonClickHandler);
        this._buttonRight.element.addEventListener("click", this._buttonClickHandler);
    };
    /**
     * Disables the component.
     */
    ProgressLight.prototype.disable = function () {
        this._buttonLeft.element.removeEventListener("click", this._buttonClickHandler);
        this._buttonRight.element.removeEventListener("click", this._buttonClickHandler);
    };
    return ProgressLight;
}(DomElement));
export function init() {
    searchAndInitialize(".progress-light", function (e) {
        new ProgressLight(e);
    });
}
export default ProgressLight;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4vc3JjL3Byb2dyZXNzL1Byb2dyZXNzTGlnaHQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sS0FBSyxNQUFNLFNBQVMsQ0FBQTtBQUMzQixPQUFPLEVBQUUsbUJBQW1CLEVBQUUsS0FBSyxFQUFFLE1BQU0sVUFBVSxDQUFBO0FBQ3JELE9BQU8sVUFBVSxNQUFNLGVBQWUsQ0FBQTtBQUV0QyxJQUFNLFNBQVMsR0FBRyxzQkFBc0IsQ0FBQTtBQUN4QyxJQUFNLGNBQWMsR0FBRyxnQkFBZ0IsQ0FBQTtBQUN2QyxJQUFNLHdCQUF3QixHQUFHLHlCQUF5QixDQUFBO0FBQzFELElBQU0sVUFBVSxHQUFHLFdBQVcsQ0FBQTtBQUM5QixJQUFNLGtCQUFrQixHQUFHLHNCQUFzQixDQUFBO0FBQ2pELElBQU0sZ0JBQWdCLEdBQUcsb0JBQW9CLENBQUE7QUFFN0MsSUFBTSxjQUFjLEdBQUcsaUJBQWlCLENBQUE7QUFDeEMsSUFBTSxpQkFBaUIsR0FBRyxjQUFjLENBQUE7QUFDeEMsSUFBTSxrQkFBa0IsR0FBRyxlQUFlLENBQUE7QUFFMUM7O0dBRUc7QUFDSDtJQUE0Qix5Q0FBVTtJQWlCcEM7OztPQUdHO0lBQ0gsdUJBQVksT0FBZ0I7UUFBNUIsWUFDRSxrQkFBTSxPQUFPLENBQUMsU0FFZjtRQURDLEtBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQTs7SUFDcEIsQ0FBQztJQUVEOzs7T0FHRztJQUNPLG1DQUFXLEdBQXJCO1FBRUUsSUFBSSxDQUFDLG1CQUFtQixHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDN0QsSUFBSSxDQUFDLDBCQUEwQixHQUFHLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7UUFFM0UsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBRSxDQUFBO1FBQ3hDLElBQUksQ0FBQyxnQkFBZ0IsR0FB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Q0FBQyxDQUFBO0FBQ0osQ0FBQztBQUVELGVBQWUsYUFBYSxDQUFBIiwiZmlsZSI6Im1haW4vc3JjL3Byb2dyZXNzL1Byb2dyZXNzTGlnaHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgYW5pbWUgZnJvbSBcImFuaW1lanNcIlxuaW1wb3J0IHsgc2VhcmNoQW5kSW5pdGlhbGl6ZSwgY2xhbXAgfSBmcm9tIFwiLi4vVXRpbHNcIlxuaW1wb3J0IERvbUVsZW1lbnQgZnJvbSBcIi4uL0RvbUVsZW1lbnRcIlxuXG5jb25zdCBDTEFTU19CQVIgPSBcIi5wcm9ncmVzcy1saWdodF9fYmFyXCJcbmNvbnN0IENMQVNTX1BST0dSRVNTID0gXCIuYmFyX19wcm9ncmVzc1wiXG5jb25zdCBDTEFTU19QUk9HUkVTU19DT01QTEVURUQgPSBcImJhcl9fcHJvZ3Jlc3MtLWNvbXBsZXRlXCJcbmNvbnN0IENMQVNTX1RJQ0sgPSBcImJhcl9fdGlja1wiXG5jb25zdCBDTEFTU19QQUdFX0NVUlJFTlQgPSBcIi5kZXRhaWxfX2N1cnJlbnRwYWdlXCJcbmNvbnN0IENMQVNTX1BBR0VfVE9UQUwgPSBcIi5kZXRhaWxfX3RvdGFscGFnZVwiXG5cbmNvbnN0IENMQVNTX0RJU0FCTEVEID0gXCJhcnJvdy0tZGlzYWJsZWRcIlxuY29uc3QgQ0xBU1NfQlVUVE9OX0xFRlQgPSBcIi5hcnJvdy0tbGVmdFwiXG5jb25zdCBDTEFTU19CVVRUT05fUklHSFQgPSBcIi5hcnJvdy0tcmlnaHRcIlxuXG4vKipcbiAqIExpZ2h0IHByb2dyZXNzIGJhciBjb21wb25lbnRcbiAqL1xuY2xhc3MgUHJvZ3Jlc3NMaWdodCBleHRlbmRzIERvbUVsZW1lbnQge1xuICBwcml2YXRlIF9idXR0b25DbGlja0hhbmRsZXIhOiAoZXZlbnQ6IEV2ZW50KSA9PiB2b2lkXG4gIHByaXZhdGUgX2FuaW1hdGlvbkNvbXBsZXRlZEhhbmRsZXIhOiAoZXZlbnQ6IEV2ZW50KSA9PiB2b2lkXG5cbiAgcHJpdmF0ZSBfYmFyRWxlbWVudCE6IERvbUVsZW1lbnQ8RWxlbWVudD5cbiAgcHJpdmF0ZSBfcHJvZ3Jlc3NFbGVtZW50ITogRG9tRWxlbWVudDxFbGVtZW50PlxuICBwcml2YXRlIF9wYWdlQ3VycmVudEVsZW1lbnQhOiBEb21FbGVtZW50PEVsZW1lbnQ+XG4gIHByaXZhdGUgX3BhZ2VUb3RhbEVsZW1lbnQhOiBEb21FbGVtZW50PEVsZW1lbnQ+XG4gIHByaXZhdGUgX2J1dHRvbkxlZnQhOiBEb21FbGVtZW50PEVsZW1lbnQ+XG4gIHByaXZhdGUgX2J1dHRvblJpZ2h0ITogRG9tRWxlbWVudDxFbGVtZW50PlxuXG4gIHByaXZhdGUgX21pblZhbHVlITogbnVtYmVyXG4gIHByaXZhdGUgX3RvdGFsITogbnVtYmVyXG4gIHByaXZhdGUgX3ZhbHVlITogbnVtYmVyXG5cbiAgcHJpdmF0ZSBfaXRlbVdpZHRoPzogbnVtYmVyXG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW5kIGluaXRpYWxpemVzIHRoZSBQcm9ncmVzc0xpZ2h0IGNvbXBvbmVudC5cbiAgICogQHBhcmFtIHtEb21FbGVtZW50fSAtIFRoZSByb290IGVsZW1lbnQgb2YgdGhlIFByb2dyZXNzTGlnaHQgY29tcG9uZW50LlxuICAgKi9cbiAgY29uc3RydWN0b3IoZWxlbWVudDogRWxlbWVudCkge1xuICAgIHN1cGVyKGVsZW1lbnQpXG4gICAgdGhpcy5faW5pdGlhbGl6ZSgpXG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgdGhlIGxvYWRlciBiYXIgY29tcG9uZW50LlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgcHJvdGVjdGVkIF9pbml0aWFsaXplKCkge1xuXG4gICAgdGhpcy5fYnV0dG9uQ2xpY2tIYW5kbGVyID0gdGhpcy5faGFuZGxlQnV0dG9uQ2xpY2suYmluZCh0aGlzKVxuICAgIHRoaXMuX2FuaW1hdGlvbkNvbXBsZXRlZEhhbmRsZXIgPSB0aGlzLl9oYW5kbGVBbmltYXRpb25Db21wbGV0ZWQuYmluZCh0aGlzKVxuXG4gICAgdGhpcy5fYmFyRWxlbWVudCA9IHRoaXMuZmluZChDTEFTU19CQVIpIVxuICAgIHRoaXMuX3Byb2dyZXNzRWxlbWVudCA9IHRoaXMuZmluZChDTEFTU19QUk9HUkVTUykhXG4gICAgdGhpcy5fcGFnZUN1cnJlbnRFbGVtZW50ID0gdGhpcy5maW5kKENMQVNTX1BBR0VfQ1VSUkVOVCkhXG4gICAgdGhpcy5fcGFnZVRvdGFsRWxlbWVudCA9IHRoaXMuZmluZChDTEFTU19QQUdFX1RPVEFMKSFcbiAgICB0aGlzLl9idXR0b25MZWZ0ID0gdGhpcy5maW5kKENMQVNTX0JVVFRPTl9MRUZUKSFcbiAgICB0aGlzLl9idXR0b25SaWdodCA9IHRoaXMuZmluZChDTEFTU19CVVRUT05fUklHSFQpIVxuXG4gICAgdGhpcy5fbWluVmFsdWUgPSAxXG4gICAgdGhpcy5fdG90YWwgPSBNYXRoLm1heChwYXJzZUludCh0aGlzLmdldEF0dHJpYnV0ZShcInRvdGFsXCIpIHx8IFwiMTAwXCIsIDEwKSwgdGhpcy5fbWluVmFsdWUpXG4gICAgdGhpcy5fdmFsdWUgPSBjbGFtcChwYXJzZUludCh0aGlzLmdldEF0dHJpYnV0ZShcInZhbHVlXCIpIHx8IFwiMVwiLCAxMCksIHRoaXMuX21pblZhbHVlLCB0aGlzLl90b3RhbClcblxuICAgIHRoaXMuX2xheW91dCgpXG5cbiAgICB0aGlzLl9hZGRUaWNrcygpXG4gICAgdGhpcy5fdXBkYXRlKGZhbHNlKVxuXG4gICAgdGhpcy5lbmFibGUoKVxuICB9XG5cbiAgcHJvdGVjdGVkIF9hZGRUaWNrcygpIHtcbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IHRoaXMuX3RvdGFsOyBpKyspIHtcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5faXRlbVdpZHRoISAqIGlcblxuICAgICAgbGV0IHRpY2tFbGVtZW50ID0gbmV3IERvbUVsZW1lbnQoXCJkaXZcIilcbiAgICAgICAgLmFkZENsYXNzKENMQVNTX1RJQ0spXG4gICAgICAgIC5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBgbGVmdDogJHtwb3NpdGlvbn0lYClcblxuICAgICAgdGhpcy5fYmFyRWxlbWVudC5wcmVwZW5kQ2hpbGQodGlja0VsZW1lbnQpXG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIF91cGRhdGUoYW5pbWF0ZSA9IHRydWUpIHtcbiAgICB0aGlzLl9wYWdlQ3VycmVudEVsZW1lbnQuc2V0SHRtbCh0aGlzLl92YWx1ZS50b1N0cmluZygpKVxuICAgIHRoaXMuX3BhZ2VUb3RhbEVsZW1lbnQuc2V0SHRtbCh0aGlzLl90b3RhbC50b1N0cmluZygpKVxuXG4gICAgbGV0IHBvc2l0aW9uID0gdGhpcy5fdmFsdWUgKiB0aGlzLl9pdGVtV2lkdGghXG5cbiAgICAvLyBBZGQgYWRkaXRpb25hbCB3aWR0aCB0byB0aGUgbGFzdCBlbGVtZW50IHRvIG1ha2Ugc3VyZVxuICAgIC8vIHRoZSByb3VuZGVkIGJvcmRlciBvbiB0aGUgbGVmdCBpcyBmaWxsZWQgYXMgd2VsbFxuICAgIGlmICh0aGlzLl92YWx1ZSA9PT0gdGhpcy5fdG90YWwpIHtcbiAgICAgIHBvc2l0aW9uICs9IDVcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fdmFsdWUgPj0gdGhpcy5fdG90YWwpIHtcbiAgICAgIHRoaXMuX2J1dHRvblJpZ2h0LmFkZENsYXNzKENMQVNTX0RJU0FCTEVEKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9idXR0b25SaWdodC5yZW1vdmVDbGFzcyhDTEFTU19ESVNBQkxFRClcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fdmFsdWUgPD0gdGhpcy5fbWluVmFsdWUpIHtcbiAgICAgIHRoaXMuX2J1dHRvbkxlZnQuYWRkQ2xhc3MoQ0xBU1NfRElTQUJMRUQpXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2J1dHRvbkxlZnQucmVtb3ZlQ2xhc3MoQ0xBU1NfRElTQUJMRUQpXG4gICAgfVxuXG4gICAgY29uc3QgZWwgPSB0aGlzLl9wcm9ncmVzc0VsZW1lbnQuZWxlbWVudCBhcyBIVE1MRWxlbWVudFxuICAgIGlmIChhbmltYXRlKSB7XG4gICAgICBhbmltZSh7XG4gICAgICAgIHRhcmdldHM6IHRoaXMuX3Byb2dyZXNzRWxlbWVudC5lbGVtZW50LFxuICAgICAgICBkdXJhdGlvbjogMjAwLFxuICAgICAgICBlYXNpbmc6IFwiZWFzZUluT3V0UXVpbnRcIixcbiAgICAgICAgd2lkdGg6IHRoaXMuX2JhckVsZW1lbnQuZWxlbWVudC5jbGllbnRXaWR0aCAqIHBvc2l0aW9uIC8gMTAwLFxuICAgICAgICBjb21wbGV0ZTogKCkgPT4ge1xuICAgICAgICAgIGVsLnN0eWxlLndpZHRoID0gYCR7cG9zaXRpb259JWBcbiAgICAgICAgICB0aGlzLl9hbmltYXRpb25Db21wbGV0ZWRIYW5kbGVyKDxFdmVudD57fSlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9IGVsc2Uge1xuICAgICAgZWwuc3R5bGUud2lkdGggPSBgJHtwb3NpdGlvbn0lYFxuICAgICAgdGhpcy5fYW5pbWF0aW9uQ29tcGxldGVkSGFuZGxlcig8RXZlbnQ+e30pXG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIF9sYXlvdXQoKSB7XG4gICAgdGhpcy5faXRlbVdpZHRoID0gTWF0aC5mbG9vcigxMDAgLyB0aGlzLl90b3RhbClcbiAgfVxuXG4gIHByb3RlY3RlZCBfaGFuZGxlQnV0dG9uQ2xpY2soZXZlbnQ6IEV2ZW50KSB7XG4gICAgaWYgKGV2ZW50LnRhcmdldCA9PT0gdGhpcy5fYnV0dG9uTGVmdC5lbGVtZW50KSB7XG4gICAgICB0aGlzLnZhbHVlID0gdGhpcy5fdmFsdWUgLSAxXG4gICAgfSBlbHNlIGlmIChldmVudC50YXJnZXQgPT09IHRoaXMuX2J1dHRvblJpZ2h0LmVsZW1lbnQpIHtcbiAgICAgIHRoaXMudmFsdWUgPSB0aGlzLl92YWx1ZSArIDFcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgX2hhbmRsZUFuaW1hdGlvbkNvbXBsZXRlZCgpIHtcbiAgICBpZiAodGhpcy5fdmFsdWUgPT09IHRoaXMuX3RvdGFsKSB7XG4gICAgICB0aGlzLl9wcm9ncmVzc0VsZW1lbnQuYWRkQ2xhc3MoQ0xBU1NfUFJPR1JFU1NfQ09NUExFVEVEKVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9wcm9ncmVzc0VsZW1lbnQucmVtb3ZlQ2xhc3MoQ0xBU1NfUFJPR1JFU1NfQ09NUExFVEVEKVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBjdXJyZW50IHByb2dyZXNzIHZhbHVlIGluIHRoZSByYW5nZSBvZiAxLi50b3RhbC5cbiAgICovXG4gIGdldCB2YWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fdmFsdWVcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBjdXJyZW50IHByb2dyZXNzLlxuICAgKiBAcGFyYW0ge251bWJlcn0gLSBUaGUgcHJvZ3Jlc3MgaW4gdGhlIHJhbmdlIG9mIDEuLnRvdGFsLlxuICAgKi9cbiAgc2V0IHZhbHVlKHZhbCkge1xuICAgIHRoaXMuX3ZhbHVlID0gY2xhbXAodmFsLCB0aGlzLl9taW5WYWx1ZSwgdGhpcy5fdG90YWwpXG4gICAgdGhpcy5fdXBkYXRlKHRydWUpXG5cbiAgICB0aGlzLmRpc3BhdGNoRXZlbnQoXCJjaGFuZ2VkXCIpXG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgdG90YWwgcHJvZ3Jlc3MgdmFsdWUuXG4gICAqL1xuICBnZXQgdG90YWwoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3RvdGFsXG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgdG90YWwgcHJvZ3Jlc3MgdmFsdWUgYW5kIHVwZGF0ZXMgdGhlIFVJIGFjY29yZGluZ2x5LlxuICAgKiBAcGFyYW0ge251bWJlcn0gLSBUaGUgdG90YWwgcHJvZ3Jlc3MgcG9zaXRpdmUgaW50ZWdlciB2YWx1ZS5cbiAgICovXG4gIHNldCB0b3RhbCh2YWx1ZSkge1xuICAgIGlmICh0aGlzLl90b3RhbCA9PT0gdmFsdWUpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHRoaXMuX3RvdGFsID0gTWF0aC5tYXgodmFsdWUsIHRoaXMuX21pblZhbHVlKVxuICAgIHRoaXMuX3ZhbHVlID0gY2xhbXAodGhpcy5fdmFsdWUsIHRoaXMuX21pblZhbHVlLCB0aGlzLl90b3RhbClcblxuICAgIC8vIENsZWFyIHRoZSB0aWNrc1xuICAgIGZvciAobGV0IHRpY2sgb2YgdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYC4ke0NMQVNTX1RJQ0t9YCkpIHtcbiAgICAgIHRoaXMuX2JhckVsZW1lbnQuZWxlbWVudC5yZW1vdmVDaGlsZCh0aWNrKVxuICAgIH1cblxuICAgIHRoaXMuX2xheW91dCgpXG4gICAgdGhpcy5fYWRkVGlja3MoKVxuXG4gICAgdGhpcy5fdXBkYXRlKGZhbHNlKVxuXG4gICAgdGhpcy5kaXNwYXRjaEV2ZW50KFwidG90YWxjaGFuZ2VkXCIpXG4gIH1cblxuICAvKipcbiAgICogRW5hYmxlcyB0aGUgY29tcG9uZW50LlxuICAgKi9cbiAgcHVibGljIGVuYWJsZSgpIHtcbiAgICB0aGlzLl9idXR0b25MZWZ0LmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2J1dHRvbkNsaWNrSGFuZGxlcilcbiAgICB0aGlzLl9idXR0b25SaWdodC5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl9idXR0b25DbGlja0hhbmRsZXIpXG4gIH1cblxuICAvKipcbiAgICogRGlzYWJsZXMgdGhlIGNvbXBvbmVudC5cbiAgICovXG4gIHB1YmxpYyBkaXNhYmxlKCkge1xuICAgIHRoaXMuX2J1dHRvbkxlZnQuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5fYnV0dG9uQ2xpY2tIYW5kbGVyKVxuICAgIHRoaXMuX2J1dHRvblJpZ2h0LmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2J1dHRvbkNsaWNrSGFuZGxlcilcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaW5pdCgpIHtcbiAgc2VhcmNoQW5kSW5pdGlhbGl6ZShcIi5wcm9ncmVzcy1saWdodFwiLCAoZSkgPT4ge1xuICAgIG5ldyBQcm9ncmVzc0xpZ2h0KGUpXG4gIH0pXG59XG5cbmV4cG9ydCBkZWZhdWx0IFByb2dyZXNzTGlnaHRcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4vLi4ifQ==
