import * as tslib_1 from "tslib";
import anime from "animejs";
import { searchAndInitialize, clamp, preventDefault } from "../Utils";
import * as Inputs from "../Inputs";
import DomElement from "../DomElement";
var MARGIN_TICK = 32;
var CLASS_HTML5 = "html5";
var RANGE_LIGHT = "range--light";
var CLASS_CONTAINER = "range-container";
var CLASS_SLIDER = "range-slider";
var CLASS_ACTIVE = "range--active";
var CLASS_TRACK = "range-track";
var CLASS_TRACK_PROGRESS = "range-track__progress";
var CLASS_TICK = "range-tick";
var CLASS_TICK_LABEL = "range-tick__label";
var CLASS_TICK_ACTIVE = "range-tick--active";
var CLASS_THUMB = "range-thumb";
var CLASS_THUMB_VALUE = "range-thumb__value";
var CLASS_DISABLED = "range--disabled";
var CLASS_DRAGGING = "range--dragging";
/**
 * The range slider component definition.
 */
var Range = /** @class */ (function (_super) {
    tslib_1.__extends(Range, _super);
    function Range(element) {
        var _this = _super.call(this, element) || this;
        // Setup event context
        _this._downHandler = _this._handleDown.bind(_this);
        _this._moveHandler = _this._handleMove.bind(_this);
        _this._endHandler = _this._handleEnd.bind(_this);
        _this._keydownHandler = _this._handleKeydown.bind(_this);
        _this._focusHandler = _this._handleFocus.bind(_this);
        _this._blurHandler = _this._handleBlur.bind(_this);
        _this._resizeHandler = _this.layout.bind(_this);
        _this._initialize();
        if (_this.element.disabled) {
            _this.disable();
        }
        else {
            _this.enable();
        }
        return _this;
    }
    /**
     * Initializes the range slider component.
     *
     * This method inspects the select definition and its options and
     * generates new stylable DOM elements around the original range input-element
     * definitions.
     * @private
     */
    Range.prototype._initialize = function () {
        if (this.hasClass(CLASS_HTML5)) {
            // This element uses HTML5 styling, do not touch it...
            return;
        }
        this._wrapperElement = new DomElement(this.element.parentElement);
        this._rangeContainer = new DomElement("div")
            .addClass(CLASS_CONTAINER);
        this._rangeTrack = new DomElement("div")
            .addClass(CLASS_TRACK);
        // check if range--light slider then add progress
        if (this._wrapperElement.hasClass(RANGE_LIGHT)) {
            this._rangeProgress = new DomElement("div")
                .addClass(CLASS_TRACK_PROGRESS);
            this._rangeTrack.appendChild(this._rangeProgress);
        }
        this._rangeThumb = new DomElement("div")
            .addClass(CLASS_THUMB);
        this._ticksWrapper = new DomElement("div")
            .addClass(CLASS_SLIDER);
        this._rangeContainer.appendChild(this._rangeTrack);
        this._rangeContainer.appendChild(this._ticksWrapper);
        this._rangeContainer.appendChild(this._rangeThumb);
        // add container to wrapper
        this._wrapperElement.appendChild(this._rangeContainer);
        // get min & max definitions
        this._minValue = parseFloat(this.element.min) || 0;
        this._maxValue = parseFloat(this.element.max) || 1;
        // get the label/output format string
        this._formatter = window[this.getAttribute("formatter")];
        // get the output label and move it below the container
        if (this.element.id) {
            this._outputLabel = this._wrapperElement.find("output[for='" + this.element.id + "']");
            if (this._outputLabel) {
                this._wrapperElement.appendChild(this._outputLabel);
            }
        }
        if (!this.element.step) {
            // fix issues with float sliders if the step is undefined
            this.element.step = "any";
        }
        var options = this._getOptionsList();
        if (options && options.length) {
            this._addTicks(options);
        }
        if (this._rangeContainer.element.querySelectorAll("." + CLASS_TICK_LABEL).length <= 1) {
            this._thumbValue = new DomElement("div")
                .addClass(CLASS_THUMB_VALUE);
            this._rangeThumb.appendChild(this._thumbValue);
        }
        this._trackValueTotal = this._maxValue - this._minValue;
        this.layout();
        this._updateTickState();
        // Apply the tab index
        var tabIndex = this.element.getAttribute("tabindex");
        if (tabIndex) {
            this._rangeContainer.setAttribute("tabindex", tabIndex);
        }
        window.addEventListener("resize", this._resizeHandler);
        window.addEventListener("orientationchange", this._resizeHandler);
    };
    Range.prototype._getOptionsList = function () {
        var e_1, _a;
        var options = [];
        var listId = this.getAttribute("list");
        if (listId) {
            var dataList = document.querySelector("#" + listId);
            if (dataList) {
                try {
                    for (var _b = tslib_1.__values(dataList.querySelectorAll("option")), _c = _b.next(); !_c.done; _c = _b.next()) {
                        var entry = _c.value;
                        var value = parseFloat(entry.innerText);
                        var label = entry.getAttribute("label") || parseFloat(value.toFixed(2));
                        options.push({
                            value: value,
                            label: label
                        });
                    }
                }
                catch (e_1_1) { e_1 = { error: e_1_1 }; }
                finally {
                    try {
                        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                    }
                    finally { if (e_1) throw e_1.error; }
                }
            }
        }
        // Sort the list to enable snapping
        options = options.sort(function (a, b) { return a.value - b.value; });
        if (options.length > 1) {
            this._minValue = Number.MAX_VALUE;
            this._maxValue = Number.MIN_VALUE;
            for (var i = 0; i < options.length; i++) {
                this._minValue = Math.min(this._minValue, options[i].value);
                this._maxValue = Math.max(this._maxValue, options[i].value);
            }
        }
        return options;
    };
    Range.prototype._addTicks = function (dataItems) {
        var e_2, _a;
        try {
            for (var dataItems_1 = tslib_1.__values(dataItems), dataItems_1_1 = dataItems_1.next(); !dataItems_1_1.done; dataItems_1_1 = dataItems_1.next()) {
                var entry = dataItems_1_1.value;
                var tickElement = new DomElement("div")
                    .setAttribute("data-value", String(entry.value))
                    .addClass(CLASS_TICK);
                var tickLabel = new DomElement("span")
                    .addClass(CLASS_TICK_LABEL)
                    .setHtml(String(entry.label));
                tickElement.appendChild(tickLabel);
                this._ticksWrapper.appendChild(tickElement);
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (dataItems_1_1 && !dataItems_1_1.done && (_a = dataItems_1.return)) _a.call(dataItems_1);
            }
            finally { if (e_2) throw e_2.error; }
        }
    };
    Range.prototype._isEventOnLabel = function (event) {
        return event.target.classList.contains(CLASS_TICK_LABEL);
    };
    Range.prototype._handleDown = function (event) {
        this._wrapperElement.addClass(CLASS_DRAGGING);
        this._rangeContainer.element.addEventListener("mouseup", this._endHandler);
        document.addEventListener("mousemove", this._moveHandler);
        document.addEventListener("mouseup", this._endHandler);
        this._rangeContainer.element.addEventListener("touchmove", this._moveHandler);
        document.addEventListener("touchend", this._endHandler);
        // Ignore clicks directly on the thumb
        if (event.target !== this._rangeThumb.element && !this._isEventOnLabel(event)) {
            var pos = this._getRelativePosition(event);
            this._setPosition(pos, true, false, false);
        }
    };
    Range.prototype._handleMove = function (event) {
        preventDefault(event);
        this._unfocus();
        if (!this._isEventOnLabel(event)) {
            var pos = this._getRelativePosition(event);
            this._setPosition(pos, true, false, false);
        }
    };
    Range.prototype._handleEnd = function (event) {
        this._wrapperElement.removeClass(CLASS_DRAGGING);
        this._rangeContainer.element.removeEventListener("mouseup", this._endHandler);
        document.removeEventListener("mouseup", this._endHandler);
        document.removeEventListener("mousemove", this._moveHandler);
        this._rangeContainer.element.removeEventListener("touchmove", this._moveHandler);
        document.removeEventListener("touchend", this._endHandler);
        var pos = this._getRelativePosition(event);
        this._setPosition(pos, true, true, true);
        this._handleBlur();
    };
    Range.prototype._handleKeydown = function (event) {
        var keycode = event.which || event.keyCode;
        if (keycode === Inputs.KEY_ESCAPE) {
            // handle Escape key (ESC)
            this._rangeContainer.element.blur();
            return;
        }
        var isUp = keycode === Inputs.KEY_ARROW_UP || keycode === Inputs.KEY_ARROW_RIGHT
            || keycode === Inputs.KEY_PAGE_UP;
        var isDown = keycode === Inputs.KEY_ARROW_DOWN || keycode === Inputs.KEY_ARROW_LEFT
            || keycode === Inputs.KEY_PAGE_DOWN;
        if (isUp || isDown) {
            event.preventDefault();
            var direction = isDown ? -1 : 1;
            // make a larger step if its the vertical arrow or page keys
            if (keycode === Inputs.KEY_ARROW_UP || keycode === Inputs.KEY_ARROW_DOWN ||
                keycode === Inputs.KEY_PAGE_UP || keycode === Inputs.KEY_PAGE_DOWN) {
                direction *= 10;
            }
            var val = this.value;
            if (this._ticksWrapper.element.childNodes.length > 1) {
                val = this._getNextValue(val, direction);
            }
            else {
                var step = this.element.step;
                if (!step || step === "any") {
                    step = "0.1";
                }
                var newVal = val + (parseFloat(step) * direction);
                val = newVal;
            }
            this._setValue(val, true, true);
            return;
        }
    };
    Range.prototype._handleFocus = function () {
        this._rangeContainer.addClass(CLASS_ACTIVE);
    };
    Range.prototype._handleBlur = function () {
        this._rangeContainer.removeClass(CLASS_ACTIVE);
    };
    Range.prototype._unfocus = function () {
        if (document.selection) {
            document.selection.empty();
        }
        else {
            window.getSelection().removeAllRanges();
        }
    };
    Range.prototype._getRelativePosition = function (event) {
        var pageX;
        if ("pageX" in event) {
            pageX = event.pageX;
        }
        else {
            pageX = (event.touches[0] || event.changedTouches[0]).pageX;
        }
        return pageX - this._trackLeftPosition + this._grabPosition;
    };
    /**
     * Validates and updates the position and sets the corresponding value on the slider.
     * @param {position} the new position to set.
     * @param {updateValue} true if the value should be updated as well; otherwise false.
     * @param {snap} true if snapping should be used; otherwise false.
     * @param {animate} true if the UI update should be animated; otherwise false.
     * @private
     */
    Range.prototype._setPosition = function (position, updateValue, snap, animate) {
        if (updateValue === void 0) { updateValue = true; }
        if (snap === void 0) { snap = false; }
        if (animate === void 0) { animate = true; }
        if (position === undefined || position === null || Number.isNaN(position)) {
            throw new Error("Position is not a number");
        }
        // Clamp to min and max range
        var newPos = clamp(position, this._trackPositionMin, this._trackPositionMax);
        if (updateValue) {
            var value = (this._trackValueTotal / this._trackWidth) * newPos + this._minValue;
            if (this._ticksWrapper.element.childNodes.length > 1 && snap) {
                var snapPos = this._getSnapPosition(newPos);
                newPos = snapPos.position;
                value = snapPos.value;
            }
            else if (this.element.step && this.element.step !== "any") {
                var step = parseFloat(this.element.step);
                value = Math.round(value / step) * step;
            }
            this._setValue(value, false, false);
        }
        if (animate && updateValue) {
            this._updateTickState();
        }
        if (animate) {
            anime({
                targets: this._rangeThumb.element,
                duration: 200,
                left: newPos,
                easing: "easeInOutQuint"
            });
            if (this._rangeProgress) {
                anime({
                    targets: this._rangeProgress.element,
                    duration: 200,
                    width: newPos,
                    easing: "easeInOutQuint"
                });
            }
        }
        else {
            this._rangeThumb.element.style.left = newPos + "px";
            if (this._rangeProgress) {
                this._rangeProgress.element.style.width = newPos + "px";
            }
        }
    };
    /**
     * Gets the snap value corresponding to the given value.
     * @param {value} the target value.
     * @returns an object containing the snap position and the corresponding value.
     * @private
     */
    Range.prototype._getSnapValue = function (value) {
        var ticks = this._ticksWrapper.element.children;
        var currentPosition = 0;
        for (var i = 0; i < ticks.length; i++) {
            var currentElement = new DomElement(ticks[i]);
            var currentValue = parseFloat(currentElement.getAttribute("data-value"));
            var currentWidth = currentElement.element.clientWidth;
            var nextElement = void 0;
            var nextValue = Number.MAX_VALUE;
            if (i < ticks.length - 1) {
                nextElement = new DomElement(ticks[i + 1]);
                nextValue = parseFloat(nextElement.getAttribute("data-value"));
            }
            // left most element
            if (i === 0 && value <= currentValue) {
                return {
                    value: currentValue,
                    position: MARGIN_TICK - this._grabPosition
                };
            }
            // right most element
            if (!nextElement && value >= currentValue) {
                return {
                    value: currentValue,
                    position: currentPosition + (currentWidth - MARGIN_TICK) - this._grabPosition - 1
                };
            }
            if (value >= currentValue && value < nextValue) {
                return {
                    value: currentValue,
                    position: currentPosition + (0.5 * currentWidth) - this._grabPosition
                };
            }
            currentPosition += currentWidth;
        }
        throw new Error("Could not determine snap value");
    };
    /**
     * Gets the snap position corresponding to the given position.
     * @param {position} the target position.
     * @returns an object containing the snap position and the corresponding value.
     * @private
     */
    Range.prototype._getSnapPosition = function (position) {
        if (position === undefined || position === null || Number.isNaN(position)) {
            throw new Error("position is not a number");
        }
        var ticks = this._ticksWrapper.element.children;
        var currentPosition = 0;
        for (var i = 0; i < ticks.length; i++) {
            var currentElement = new DomElement(ticks[i]);
            var currentValue = parseFloat(currentElement.getAttribute("data-value"));
            var currentWidth = currentElement.element.clientWidth;
            var nextElement = void 0;
            if (i < ticks.length - 1) {
                nextElement = new DomElement(ticks[i + 1]);
            }
            // left most element
            if (i === 0 && position <= currentPosition + currentWidth) {
                return {
                    value: currentValue,
                    position: MARGIN_TICK - this._grabPosition
                };
            }
            // right most element
            if (!nextElement && position >= currentPosition) {
                return {
                    value: currentValue,
                    position: currentPosition + (currentWidth - MARGIN_TICK) - this._grabPosition - 1
                };
            }
            if (position >= currentPosition && position < (currentPosition + currentWidth)) {
                return {
                    value: currentValue,
                    position: currentPosition + (0.5 * currentWidth) - this._grabPosition
                };
            }
            currentPosition += currentWidth;
        }
        throw new Error("Could not determine snap position");
    };
    /**
     * Gets the next value in the given direction with regards to snapping.
     * @param {value} The current value.
     * @param {direction} The direction (positive or negative integer).
     * @returns The next value.
     * @private
     */
    Range.prototype._getNextValue = function (value, direction) {
        var ticks = this._ticksWrapper.element.children;
        for (var i = 0; i < ticks.length; i++) {
            var currentElement = new DomElement(ticks[i]);
            var currentVal = parseFloat(currentElement.getAttribute("data-value"));
            if (value === currentVal) {
                var index = clamp(i + direction, 0, ticks.length - 1);
                value = parseFloat(ticks[index].getAttribute("data-value"));
            }
        }
        return value;
    };
    Range.prototype._updateTickState = function () {
        if (this._ticksWrapper.element.childNodes.length > 1) {
            var activeTick = this._ticksWrapper.find("." + CLASS_TICK_ACTIVE);
            if (activeTick) {
                activeTick.removeClass(CLASS_TICK_ACTIVE);
            }
            var newActiveTick = this._ticksWrapper.find("." + CLASS_TICK + "[data-value='" + this.value + "']");
            if (newActiveTick) {
                newActiveTick.addClass(CLASS_TICK_ACTIVE);
            }
        }
    };
    Range.prototype._adjustTickLabelPosition = function (tickItem, left) {
        var label = new DomElement(tickItem.querySelector("." + CLASS_TICK_LABEL));
        var dummyElement = new DomElement("span")
            .addClass(CLASS_TICK_LABEL)
            .setAttribute("style", "visibility: hidden; display: inline-block;")
            .setHtml(label.innerText);
        this._rangeContainer.appendChild(dummyElement);
        var width = dummyElement.element.clientWidth / 2;
        this._rangeContainer.removeChild(dummyElement);
        var floatPosition = left ? "left" : "right";
        if (width < MARGIN_TICK) {
            // center small items on the tick
            label.setAttribute("style", floatPosition + ": " + (MARGIN_TICK - Math.floor(width)) + "px; text-align: " + floatPosition + ";");
        }
    };
    Range.prototype._formatOutput = function (value, short) {
        if (this._formatter) {
            return this._formatter(value, short);
        }
        var str = parseFloat(value.toFixed(2));
        return str.toString();
    };
    /**
     * Validates and updates the range value.
     * @param {value} the new value to set.
     * @param {update} true if the UI should be updated; otherwise false.
     * @param {animate} true if the UI update should be animated; otherwise false.
     * @private
     */
    Range.prototype._setValue = function (value, update, animate) {
        if (update === void 0) { update = true; }
        if (animate === void 0) { animate = false; }
        var val = clamp(value, this._minValue, this._maxValue);
        var position;
        if (this._ticksWrapper.element.childNodes.length > 1) {
            var snapValue = this._getSnapValue(val);
            position = snapValue.position;
            val = snapValue.value;
        }
        else {
            position = (this._trackWidth / this._trackValueTotal) * (value - this._minValue);
        }
        // If the calculation failed, fall back to the first tick position and disable the component
        if (!position) {
            position = this._getSnapPosition(val).position;
            this.disable();
        }
        this.element.value = String(val);
        if (this._thumbValue) {
            this._thumbValue.setHtml(this._formatOutput(val, true));
        }
        if (this._outputLabel) {
            this._outputLabel.setHtml(this._formatOutput(val, false));
        }
        if (update) {
            this._setPosition(position, false, false, animate);
            this._updateTickState();
        }
        this.dispatchEvent("input");
    };
    Object.defineProperty(Range.prototype, "value", {
        /**
         * Gets the current value.
         */
        get: function () {
            return parseFloat(this.element.value);
        },
        /**
         * Sets the value of the range slider.
         */
        set: function (value) {
            this._setValue(value, true, true);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Force the component to re-layout itself.
     */
    Range.prototype.layout = function () {
        this._grabPosition = Math.round(this._rangeThumb.element.offsetWidth / 2);
        var tickItems = this._rangeContainer.element.querySelectorAll("." + CLASS_TICK);
        var ticksOffset = tickItems && tickItems.length > 0 ? (2 * MARGIN_TICK) : MARGIN_TICK;
        this._trackWidth = this._rangeTrack.element.offsetWidth - ticksOffset;
        this._trackPositionMin = 0;
        this._trackPositionMax = this._rangeTrack.element.clientWidth - this._rangeThumb.element.offsetWidth + 1;
        this._trackLeftPosition = this._rangeTrack.element.getBoundingClientRect().left + MARGIN_TICK;
        var itemCount = tickItems.length - 1;
        this._itemWidth = this._trackWidth / itemCount;
        var outerItemsWidth = (this._itemWidth * 0.5) + MARGIN_TICK;
        for (var i = 0; i <= itemCount; i++) {
            var width = this._itemWidth;
            if (i === 0 || i === itemCount) {
                width = outerItemsWidth;
            }
            var item = new DomElement(tickItems[i]);
            item.setAttribute("style", "width: " + Math.floor(width) + "px;");
        }
        // adjust first and last label positions
        if (tickItems.length > 1) {
            this._adjustTickLabelPosition(tickItems[0], true);
            this._adjustTickLabelPosition(tickItems[tickItems.length - 1], false);
        }
        // update the value
        this._setValue(parseFloat(this.element.value), true, false);
    };
    /**
     * Destroys the components and frees all references.
     */
    Range.prototype.destroy = function () {
        window.removeEventListener("resize", this._resizeHandler);
        window.removeEventListener("orientationchange", this._resizeHandler);
        this._downHandler = null;
        this._moveHandler = null;
        this._endHandler = null;
        this._focusHandler = null;
        this._blurHandler = null;
        this.element = null;
        this._rangeContainer = null;
        this._wrapperElement = null;
    };
    /**
     * @deprecated use destroy() instead.
     * @todo remove in version 2.0.0
     */
    Range.prototype.destoy = function () {
        this.destroy();
    };
    /**
     * Sets the component to the enabled state.
     */
    Range.prototype.enable = function () {
        this.element.removeAttribute("disabled");
        this._wrapperElement.removeClass(CLASS_DISABLED);
        this._rangeContainer.element.addEventListener("mousedown", this._downHandler);
        this._rangeContainer.element.addEventListener("touchstart", this._downHandler);
        this._rangeContainer.element.addEventListener("keydown", this._keydownHandler);
        this._rangeContainer.element.addEventListener("focus", this._focusHandler);
        this._rangeContainer.element.addEventListener("blur", this._blurHandler);
    };
    /**
     * Sets the component to the disabled state.
     */
    Range.prototype.disable = function () {
        this.element.setAttribute("disabled", "");
        this._wrapperElement.addClass(CLASS_DISABLED);
        this._rangeContainer.element.removeEventListener("mousedown", this._downHandler);
        this._rangeContainer.element.removeEventListener("mouseup", this._endHandler);
        this._rangeContainer.element.removeEventListener("mousemove", this._moveHandler);
        this._rangeContainer.element.removeEventListener("touchstart", this._downHandler);
        this._rangeContainer.element.removeEventListener("focus", this._focusHandler);
        this._rangeContainer.element.removeEventListener("blur", this._blurHandler);
    };
    return Range;
}(DomElement));
export function init() {
    searchAndInitialize("input[type='range']", function (e) {
        new Range(e);
    });
}
export default Range;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUksQ0FBQyxhQUFhLENBQUMsQ0FBQTtRQUM3RSxJQUFJLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFBO0lBQzdFLENBQUM7SUFDSCxZQUFDO0FBQUQsQ0Fyc0JBLEFBcXNCQyxDQXJzQm1CLFVBQVUsR0Fxc0I3QjtBQUVELE1BQU0sVUFBVSxJQUFJO0lBQ2xCLG1CQUFtQixDQUFtQixxQkFBcUIsRUFBRSxVQUFDLENBQUM7UUFDN0QsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDZCxDQUFDLENBQUMsQ0FBQTtBQUNKLENBQUM7QUFFRCxlQUFlLEtBQUssQ0FBQSIsImZpbGUiOiJtYWluL3NyYy9mb3JtL1JhbmdlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFuaW1lIGZyb20gXCJhbmltZWpzXCJcblxuaW1wb3J0IHsgc2VhcmNoQW5kSW5pdGlhbGl6ZSwgY2xhbXAsIHByZXZlbnREZWZhdWx0IH0gZnJvbSBcIi4uL1V0aWxzXCJcbmltcG9ydCAqIGFzIElucHV0cyBmcm9tIFwiLi4vSW5wdXRzXCJcbmltcG9ydCBEb21FbGVtZW50IGZyb20gXCIuLi9Eb21FbGVtZW50XCJcblxuY29uc3QgTUFSR0lOX1RJQ0sgPSAzMlxuY29uc3QgQ0xBU1NfSFRNTDUgPSBcImh0bWw1XCJcbmNvbnN0IFJBTkdFX0xJR0hUID0gXCJyYW5nZS0tbGlnaHRcIlxuXG5jb25zdCBDTEFTU19DT05UQUlORVIgPSBcInJhbmdlLWNvbnRhaW5lclwiXG5jb25zdCBDTEFTU19TTElERVIgPSBcInJhbmdlLXNsaWRlclwiXG5jb25zdCBDTEFTU19BQ1RJVkUgPSBcInJhbmdlLS1hY3RpdmVcIlxuXG5jb25zdCBDTEFTU19UUkFDSyA9IFwicmFuZ2UtdHJhY2tcIlxuY29uc3QgQ0xBU1NfVFJBQ0tfUFJPR1JFU1MgPSBcInJhbmdlLXRyYWNrX19wcm9ncmVzc1wiXG5cbmNvbnN0IENMQVNTX1RJQ0sgPSBcInJhbmdlLXRpY2tcIlxuY29uc3QgQ0xBU1NfVElDS19MQUJFTCA9IFwicmFuZ2UtdGlja19fbGFiZWxcIlxuY29uc3QgQ0xBU1NfVElDS19BQ1RJVkUgPSBcInJhbmdlLXRpY2stLWFjdGl2ZVwiXG5cbmNvbnN0IENMQVNTX1RIVU1CID0gXCJyYW5nZS10aHVtYlwiXG5jb25zdCBDTEFTU19USFVNQl9WQUxVRSA9IFwicmFuZ2UtdGh1bWJfX3ZhbHVlXCJcbmNvbnN0IENMQVNTX0RJU0FCTEVEID0gXCJyYW5nZS0tZGlzYWJsZWRcIlxuXG5jb25zdCBDTEFTU19EUkFHR0lORyA9IFwicmFuZ2UtLWRyYWdnaW5nXCJcblxuZXhwb3J0IGludGVyZmFjZSBGb3JtYXR0ZXIge1xuICAodmFsdWU6IG51bWJlciwgc2hvcnQ6IGJvb2xlYW4pOiBzdHJpbmdcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPcHRpb24ge1xuICB2YWx1ZTogbnVtYmVyXG4gIGxhYmVsOiBzdHJpbmcgfCBudW1iZXJcbn1cblxuLyoqXG4gKiBUaGUgcmFuZ2Ugc2xpZGVyIGNvbXBvbmVudCBkZWZpbml0aW9uLlxuICovXG5jbGFzcyBSYW5nZSBleHRlbmRzIERvbUVsZW1lbnQ8SFRNTElucHV0RWxlbWVudD4ge1xuICBwcml2YXRlIF9kb3duSGFuZGxlcjogKGU6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50KSA9PiB2b2lkXG4gIHByaXZhdGUgX21vdmVIYW5kbGVyOiAoZTogTW91c2VFdmVudCB8IFRvdWNoRXZlbnQpID0+IHZvaWRcbiAgcHJpdmF0ZSBfZW5kSGFuZGxlcjogKGU6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50KSA9PiB2b2lkXG4gIHByaXZhdGUgX2tleWRvd25IYW5kbGVyOiAoZTogS2V5Ym9hcmRFdmVudCkgPT4gdm9pZFxuICBwcml2YXRlIF9mb2N1c0hhbmRsZXI6IChlOiBFdmVudCkgPT4gdm9pZFxuICBwcml2YXRlIF9ibHVySGFuZGxlcjogKGU6IEV2ZW50KSA9PiB2b2lkXG4gIHByaXZhdGUgX3Jlc2l6ZUhhbmRsZXI6IChlOiBFdmVudCkgPT4gdm9pZFxuXG4gIHByaXZhdGUgX3dyYXBwZXJFbGVtZW50ITogRG9tRWxlbWVudDxIVE1MRWxlbWVudD5cbiAgcHJpdmF0ZSBfcmFuZ2VDb250YWluZXIhOiBEb21FbGVtZW50PEhUTUxEaXZFbGVtZW50PlxuICBwcml2YXRlIF9yYW5nZVRyYWNrITogRG9tRWxlbWVudDxIVE1MRGl2RWxlbWVudD5cbiAgcHJpdmF0ZSBfcmFuZ2VQcm9ncmVzcyE6IERvbUVsZW1lbnQ8SFRNTERpdkVsZW1lbnQ+XG4gIHByaXZhdGUgX3RpY2tzV3JhcHBlciE6IERvbUVsZW1lbnQ8SFRNTERpdkVsZW1lbnQ+XG4gIHByaXZhdGUgX3JhbmdlVGh1bWIhOiBEb21FbGVtZW50PEhUTUxEaXZFbGVtZW50PlxuICBwcml2YXRlIF90aHVtYlZhbHVlITogRG9tRWxlbWVudDxIVE1MRGl2RWxlbWVudD5cbiAgcHJpdmF0ZSBfb3V0cHV0TGFiZWw/OiBEb21FbGVtZW50PEVsZW1lbnQ+XG5cbiAgcHJpdmF0ZSBfbWluVmFsdWUhOiBudW1iZXJcbiAgcHJpdmF0ZSBfbWF4VmFsdWUhOiBudW1iZXJcbiAgcHJpdmF0ZSBfdHJhY2tWYWx1ZVRvdGFsITogbnVtYmVyXG5cbiAgcHJpdmF0ZSBfZ3JhYlBvc2l0aW9uITogbnVtYmVyXG4gIHByaXZhdGUgX3RyYWNrV2lkdGghOiBudW1iZXJcbiAgcHJpdmF0ZSBfdHJhY2tQb3NpdGlvbk1pbiE6IG51bWJlclxuICBwcml2YXRlIF90cmFja1Bvc2l0aW9uTWF4ITogbnVtYmVyXG4gIHByaXZhdGUgX3RyYWNrTGVmdFBvc2l0aW9uITogbnVtYmVyXG4gIHByaXZhdGUgX2l0ZW1XaWR0aCE6IG51bWJlclxuXG4gIHByaXZhdGUgX2Zvcm1hdHRlciE6IEZvcm1hdHRlclxuXG4gIGNvbnN0cnVjdG9yKGVsZW1lbnQ6IEhUTUxJbnB1dEVsZW1lbnQpIHtcbiAgICBzdXBlcihlbGVtZW50KVxuXG4gICAgLy8gU2V0dXAgZXZlbnQgY29udGV4dFxuICAgIHRoaXMuX2Rvd25IYW5kbGVyID0gdGhpcy5faGFuZGxlRG93bi5iaW5kKHRoaXMpXG4gICAgdGhpcy5fbW92ZUhhbmRsZXIgPSB0aGlzLl9oYW5kbGVNb3ZlLmJpbmQodGhpcylcbiAgICB0aGlzLl9lbmRIYW5kbGVyID0gdGhpcy5faGFuZGxlRW5kLmJpbmQodGhpcylcbiAgICB0aGlzLl9rZXlkb3duSGFuZGxlciA9IHRoaXMuX2hhbmRsZUtleWRvd24uYmluZCh0aGlzKVxuXG4gICAgdGhpcy5fZm9jdXNIYW5kbGVyID0gdGhpcy5faGFuZGxlRm9jdXMuYmluZCh0aGlzKVxuICAgIHRoaXMuX2JsdXJIYW5kbGVyID0gdGhpcy5faGFuZGxlQmx1ci5iaW5kKHRoaXMpXG4gICAgdGhpcy5fcmVzaXplSGFuZGxlciA9IHRoaXMubGF5b3V0LmJpbmQodGhpcylcblxuICAgIHRoaXMuX2luaXRpYWxpemUoKVxuXG4gICAgaWYgKHRoaXMuZWxlbWVudC5kaXNhYmxlZCkge1xuICAgICAgdGhpcy5kaXNhYmxlKClcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5lbmFibGUoKVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplcyB0aGUgcmFuZ2Ugc2xpZGVyIGNvbXBvbmVudC5cbiAgICpcbiAgICogVGhpcyBtZXRob2QgaW5zcGVjdHMgdGhlIHNlbGVjdCBkZWZpbml0aW9uIGFuZCBpdHMgb3B0aW9ucyBhbmRcbiAgICogZ2VuZXJhdGVzIG5ldyBzdHlsYWJsZSBET00gZWxlbWVudHMgYXJvdW5kIHRoZSBvcmlnaW5hbCByYW5nZSBpbnB1dC1lbGVtZW50XG4gICAqIGRlZmluaXRpb25zLlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgcHJvdGVjdGVkIF9pbml0aWFsaXplKCkge1xuXG4gICAgaWYgKHRoaXMuaGFzQ2xhc3MoQ0xBU1NfSFRNTDUpKSB7XG4gICAgICAvLyBUaGlzIGVsZW1lbnQgdXNlcyBIVE1MNSBzdHlsaW5nLCBkbyBub3QgdG91Y2ggaXQuLi5cbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHRoaXMuX3dyYXBwZXJFbGVtZW50ID0gbmV3IERvbUVsZW1lbnQodGhpcy5lbGVtZW50LnBhcmVudEVsZW1lbnQhKVxuXG4gICAgdGhpcy5fcmFuZ2VDb250YWluZXIgPSBuZXcgRG9tRWxlbWVudDxIVE1MRGl2RWxlbWVudD4oXCJkaXZcIilcbiAgICAgIC5hZGRDbGFzcyhDTEFTU19DT05UQUlORVIpXG5cbiAgICB0aGlzLl9yYW5nZVRyYWNrID0gbmV3IERvbUVsZW1lbnQ8SFRNTERpdkVsZW1lbnQ+KFwiZGl2XCIpXG4gICAgICAuYWRkQ2xhc3MoQ0xBU1NfVFJBQ0spXG5cbiAgICAvLyBjaGVjayBpZiByYW5nZS0tbGlnaHQgc2xpZGVyIHRoZW4gYWRkIHByb2dyZXNzXG4gICAgaWYgKHRoaXMuX3dyYXBwZXJFbGVtZW50Lmhhc0NsYXNzKFJBTkdFX0xJR0hUKSkge1xuICAgICAgdGhpcy5fcmFuZ2VQcm9ncmVzcyA9IG5ldyBEb21FbGVtZW50PEhUTUxEaXZFbGVtZW50PihcImRpdlwiKVxuICAgICAgICAuYWRkQ2xhc3MoQ0xBU1NfVFJBQ0tfUFJPR1JFU1MpXG5cbiAgICAgIHRoaXMuX3JhbmdlVHJhY2suYXBwZW5kQ2hpbGQodGhpcy5fcmFuZ2VQcm9ncmVzcylcbiAgICB9XG5cbiAgICB0aGlzLl9yYW5nZVRodW1iID0gbmV3IERvbUVsZW1lbnQ8SFRNTERpdkVsZW1lbnQ+KFwiZGl2XCIpXG4gICAgICAuYWRkQ2xhc3MoQ0xBU1NfVEhVTUIpXG5cbiAgICB0aGlzLl90aWNrc1dyYXBwZXIgPSBuZXcgRG9tRWxlbWVudDxIVE1MRGl2RWxlbWVudD4oXCJkaXZcIilcbiAgICAgIC5hZGRDbGFzcyhDTEFTU19TTElERVIpXG5cbiAgICB0aGlzLl9yYW5nZUNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLl9yYW5nZVRyYWNrKVxuICAgIHRoaXMuX3JhbmdlQ29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuX3RpY2tzV3JhcHBlcilcbiAgICB0aGlzLl9yYW5nZUNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLl9yYW5nZVRodW1iKVxuXG4gICAgLy8gYWRkIGNvbnRhaW5lciB0byB3cmFwcGVyXG4gICAgdGhpcy5fd3JhcHBlckVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5fcmFuZ2VDb250YWluZXIpXG5cbiAgICAvLyBnZXQgbWluICYgbWF4IGRlZmluaXRpb25zXG4gICAgdGhpcy5fbWluVmFsdWUgPSBwYXJzZUZsb2F0KHRoaXMuZWxlbWVudC5taW4pIHx8IDBcbiAgICB0aGlzLl9tYXhWYWx1ZSA9IHBhcnNlRmxvYXQodGhpcy5lbGVtZW50Lm1heCkgfHwgMVxuXG4gICAgLy8gZ2V0IHRoZSBsYWJlbC9vdXRwdXQgZm9ybWF0IHN0cmluZ1xuICAgIHRoaXMuX2Zvcm1hdHRlciA9ICh3aW5kb3cgYXMgYW55KVt0aGlzLmdldEF0dHJpYnV0ZShcImZvcm1hdHRlclwiKSFdXG5cbiAgICAvLyBnZXQgdGhlIG91dHB1dCBsYWJlbCBhbmQgbW92ZSBpdCBiZWxvdyB0aGUgY29udGFpbmVyXG4gICAgaWYgKHRoaXMuZWxlbWVudC5pZCkge1xuICAgICAgdGhpcy5fb3V0cHV0TGFiZWwgPSB0aGlzLl93cmFwcGVyRWxlbWVudC5maW5kKGBvdXRwdXRbZm9yPScke3RoaXMuZWxlbWVudC5pZH0nXWApXG4gICAgICBpZiAodGhpcy5fb3V0cHV0TGFiZWwpIHtcbiAgICAgICAgdGhpcy5fd3JhcHBlckVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5fb3V0cHV0TGFiZWwpXG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLmVsZW1lbnQuc3RlcCkge1xuICAgICAgLy8gZml4IGlzc3VlcyB3aXRoIGZsb2F0IHNsaWRlcnMgaWYgdGhlIHN0ZXAgaXMgdW5kZWZpbmVkXG4gICAgICB0aGlzLmVsZW1lbnQuc3RlcCA9IFwiYW55XCJcbiAgICB9XG5cbiAgICBjb25zdCBvcHRpb25zID0gdGhpcy5fZ2V0T3B0aW9uc0xpc3QoKVxuICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMubGVuZ3RoKSB7XG4gICAgICB0aGlzLl9hZGRUaWNrcyhvcHRpb25zKVxuICAgIH1cblxuICAgIGlmICh0aGlzLl9yYW5nZUNvbnRhaW5lci5lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYC4ke0NMQVNTX1RJQ0tfTEFCRUx9YCkubGVuZ3RoIDw9IDEpIHtcbiAgICAgIHRoaXMuX3RodW1iVmFsdWUgPSBuZXcgRG9tRWxlbWVudDxIVE1MRGl2RWxlbWVudD4oXCJkaXZcIilcbiAgICAgICAgLmFkZENsYXNzKENMQVNTX1RIVU1CX1ZBTFVFKVxuXG4gICAgICB0aGlzLl9yYW5nZVRodW1iLmFwcGVuZENoaWxkKHRoaXMuX3RodW1iVmFsdWUpXG4gICAgfVxuXG4gICAgdGhpcy5fdHJhY2tWYWx1ZVRvdGFsID0gdGhpcy5fbWF4VmFsdWUgLSB0aGlzLl9taW5WYWx1ZVxuICAgIHRoaXMubGF5b3V0KClcblxuICAgIHRoaXMuX3VwZGF0ZVRpY2tTdGF0ZSgpXG5cbiAgICAvLyBBcHBseSB0aGUgdGFiIGluZGV4XG4gICAgY29uc3QgdGFiSW5kZXggPSB0aGlzLmVsZW1lbnQuZ2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIilcbiAgICBpZiAodGFiSW5kZXgpIHtcbiAgICAgIHRoaXMuX3JhbmdlQ29udGFpbmVyLnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsIHRhYkluZGV4KVxuICAgIH1cblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIHRoaXMuX3Jlc2l6ZUhhbmRsZXIpXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJvcmllbnRhdGlvbmNoYW5nZVwiLCB0aGlzLl9yZXNpemVIYW5kbGVyKVxuICB9XG5cbiAgcHJvdGVjdGVkIF9nZXRPcHRpb25zTGlzdCgpIHtcbiAgICBsZXQgb3B0aW9uczogT3B0aW9uW10gPSBbXVxuXG4gICAgbGV0IGxpc3RJZCA9IHRoaXMuZ2V0QXR0cmlidXRlKFwibGlzdFwiKVxuICAgIGlmIChsaXN0SWQpIHtcbiAgICAgIGxldCBkYXRhTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2xpc3RJZH1gKVxuICAgICAgaWYgKGRhdGFMaXN0KSB7XG4gICAgICAgIGZvciAobGV0IGVudHJ5IG9mIGRhdGFMaXN0LnF1ZXJ5U2VsZWN0b3JBbGwoXCJvcHRpb25cIikpIHtcbiAgICAgICAgICBsZXQgdmFsdWUgPSBwYXJzZUZsb2F0KGVudHJ5LmlubmVyVGV4dClcbiAgICAgICAgICBsZXQgbGFiZWwgPSBlbnRyeS5nZXRBdHRyaWJ1dGUoXCJsYWJlbFwiKSB8fCBwYXJzZUZsb2F0KHZhbHVlLnRvRml4ZWQoMikpXG5cbiAgICAgICAgICBvcHRpb25zLnB1c2goe1xuICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICBsYWJlbFxuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTb3J0IHRoZSBsaXN0IHRvIGVuYWJsZSBzbmFwcGluZ1xuICAgIG9wdGlvbnMgPSBvcHRpb25zLnNvcnQoKGEsIGIpID0+IGEudmFsdWUgLSBiLnZhbHVlKVxuXG4gICAgaWYgKG9wdGlvbnMubGVuZ3RoID4gMSkge1xuICAgICAgdGhpcy5fbWluVmFsdWUgPSBOdW1iZXIuTUFYX1ZBTFVFXG4gICAgICB0aGlzLl9tYXhWYWx1ZSA9IE51bWJlci5NSU5fVkFMVUVcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBvcHRpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHRoaXMuX21pblZhbHVlID0gTWF0aC5taW4odGhpcy5fbWluVmFsdWUsIG9wdGlvbnNbaV0udmFsdWUpXG4gICAgICAgIHRoaXMuX21heFZhbHVlID0gTWF0aC5tYXgodGhpcy5fbWF4VmFsdWUsIG9wdGlvbnNbaV0udmFsdWUpXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG9wdGlvbnNcbiAgfVxuXG4gIHByb3RlY3RlZCBfYWRkVGlja3MoZGF0YUl0ZW1zOiBPcHRpb25bXSkge1xuICAgIGZvciAobGV0IGVudHJ5IG9mIGRhdGFJdGVtcykge1xuICAgICAgbGV0IHRpY2tFbGVtZW50ID0gbmV3IERvbUVsZW1lbnQoXCJkaXZcIilcbiAgICAgICAgLnNldEF0dHJpYnV0ZShcImRhdGEtdmFsdWVcIiwgU3RyaW5nKGVudHJ5LnZhbHVlKSlcbiAgICAgICAgLmFkZENsYXNzKENMQVNTX1RJQ0spXG5cbiAgICAgIGxldCB0aWNrTGFiZWwgPSBuZXcgRG9tRWxlbWVudChcInNwYW5cIilcbiAgICAgICAgLmFkZENsYXNzKENMQVNTX1RJQ0tfTEFCRUwpXG4gICAgICAgIC5zZXRIdG1sKFN0cmluZyhlbnRyeS5sYWJlbCkpXG5cbiAgICAgIHRpY2tFbGVtZW50LmFwcGVuZENoaWxkKHRpY2tMYWJlbClcbiAgICAgIHRoaXMuX3RpY2tzV3JhcHBlci5hcHBlbmRDaGlsZCh0aWNrRWxlbWVudClcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgX2lzRXZlbnRPbkxhYmVsKGV2ZW50OiBFdmVudCkge1xuICAgIHJldHVybiAoZXZlbnQudGFyZ2V0IGFzIEVsZW1lbnQpLmNsYXNzTGlzdC5jb250YWlucyhDTEFTU19USUNLX0xBQkVMKVxuICB9XG5cbiAgcHJvdGVjdGVkIF9oYW5kbGVEb3duKGV2ZW50OiBNb3VzZUV2ZW50IHwgVG91Y2hFdmVudCkge1xuICAgIHRoaXMuX3dyYXBwZXJFbGVtZW50LmFkZENsYXNzKENMQVNTX0RSQUdHSU5HKVxuXG4gICAgdGhpcy5fcmFuZ2VDb250YWluZXIuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwibW91c2V1cFwiLCB0aGlzLl9lbmRIYW5kbGVyKVxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgdGhpcy5fbW92ZUhhbmRsZXIpXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy5fZW5kSGFuZGxlcilcblxuICAgIHRoaXMuX3JhbmdlQ29udGFpbmVyLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInRvdWNobW92ZVwiLCB0aGlzLl9tb3ZlSGFuZGxlcilcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgdGhpcy5fZW5kSGFuZGxlcilcblxuICAgIC8vIElnbm9yZSBjbGlja3MgZGlyZWN0bHkgb24gdGhlIHRodW1iXG4gICAgaWYgKGV2ZW50LnRhcmdldCAhPT0gdGhpcy5fcmFuZ2VUaHVtYi5lbGVtZW50ICYmICF0aGlzLl9pc0V2ZW50T25MYWJlbChldmVudCkpIHtcbiAgICAgIGxldCBwb3MgPSB0aGlzLl9nZXRSZWxhdGl2ZVBvc2l0aW9uKGV2ZW50KVxuICAgICAgdGhpcy5fc2V0UG9zaXRpb24ocG9zLCB0cnVlLCBmYWxzZSwgZmFsc2UpXG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIF9oYW5kbGVNb3ZlKGV2ZW50OiBNb3VzZUV2ZW50IHwgVG91Y2hFdmVudCkge1xuICAgIHByZXZlbnREZWZhdWx0KGV2ZW50KVxuICAgIHRoaXMuX3VuZm9jdXMoKVxuXG4gICAgaWYgKCF0aGlzLl9pc0V2ZW50T25MYWJlbChldmVudCkpIHtcbiAgICAgIGxldCBwb3MgPSB0aGlzLl9nZXRSZWxhdGl2ZVBvc2l0aW9uKGV2ZW50KVxuICAgICAgdGhpcy5fc2V0UG9zaXRpb24ocG9zLCB0cnVlLCBmYWxzZSwgZmFsc2UpXG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIF9oYW5kbGVFbmQoZXZlbnQ6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50KSB7XG4gICAgdGhpcy5fd3JhcHBlckVsZW1lbnQucmVtb3ZlQ2xhc3MoQ0xBU1NfRFJBR0dJTkcpXG5cbiAgICB0aGlzLl9yYW5nZUNvbnRhaW5lci5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIHRoaXMuX2VuZEhhbmRsZXIpXG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy5fZW5kSGFuZGxlcilcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vtb3ZlXCIsIHRoaXMuX21vdmVIYW5kbGVyKVxuXG4gICAgdGhpcy5fcmFuZ2VDb250YWluZXIuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2htb3ZlXCIsIHRoaXMuX21vdmVIYW5kbGVyKVxuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCB0aGlzLl9lbmRIYW5kbGVyKVxuXG4gICAgbGV0IHBvcyA9IHRoaXMuX2dldFJlbGF0aXZlUG9zaXRpb24oZXZlbnQpXG4gICAgdGhpcy5fc2V0UG9zaXRpb24ocG9zLCB0cnVlLCB0cnVlLCB0cnVlKVxuICAgIHRoaXMuX2hhbmRsZUJsdXIoKVxuICB9XG5cbiAgcHJvdGVjdGVkIF9oYW5kbGVLZXlkb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgbGV0IGtleWNvZGUgPSBldmVudC53aGljaCB8fCBldmVudC5rZXlDb2RlXG5cbiAgICBpZiAoa2V5Y29kZSA9PT0gSW5wdXRzLktFWV9FU0NBUEUpIHtcbiAgICAgIC8vIGhhbmRsZSBFc2NhcGUga2V5IChFU0MpXG4gICAgICB0aGlzLl9yYW5nZUNvbnRhaW5lci5lbGVtZW50LmJsdXIoKVxuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3QgaXNVcCA9IGtleWNvZGUgPT09IElucHV0cy5LRVlfQVJST1dfVVAgfHwga2V5Y29kZSA9PT0gSW5wdXRzLktFWV9BUlJPV19SSUdIVFxuICAgICAgfHwga2V5Y29kZSA9PT0gSW5wdXRzLktFWV9QQUdFX1VQXG5cbiAgICBjb25zdCBpc0Rvd24gPSBrZXljb2RlID09PSBJbnB1dHMuS0VZX0FSUk9XX0RPV04gfHwga2V5Y29kZSA9PT0gSW5wdXRzLktFWV9BUlJPV19MRUZUXG4gICAgICB8fCBrZXljb2RlID09PSBJbnB1dHMuS0VZX1BBR0VfRE9XTlxuXG4gICAgaWYgKGlzVXAgfHwgaXNEb3duKSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG5cbiAgICAgIGxldCBkaXJlY3Rpb24gPSBpc0Rvd24gPyAtMSA6IDFcblxuICAgICAgLy8gbWFrZSBhIGxhcmdlciBzdGVwIGlmIGl0cyB0aGUgdmVydGljYWwgYXJyb3cgb3IgcGFnZSBrZXlzXG4gICAgICBpZiAoa2V5Y29kZSA9PT0gSW5wdXRzLktFWV9BUlJPV19VUCB8fCBrZXljb2RlID09PSBJbnB1dHMuS0VZX0FSUk9XX0RPV04gfHxcbiAgICAgICAga2V5Y29kZSA9PT0gSW5wdXRzLktFWV9QQUdFX1VQIHx8IGtleWNvZGUgPT09IElucHV0cy5LRVlfUEFHRV9ET1dOKSB7XG4gICAgICAgIGRpcmVjdGlvbiAqPSAxMFxuICAgICAgfVxuXG4gICAgICBsZXQgdmFsID0gdGhpcy52YWx1ZVxuICAgICAgaWYgKHRoaXMuX3RpY2tzV3JhcHBlci5lbGVtZW50LmNoaWxkTm9kZXMubGVuZ3RoID4gMSkge1xuICAgICAgICB2YWwgPSB0aGlzLl9nZXROZXh0VmFsdWUodmFsLCBkaXJlY3Rpb24pXG4gICAgICB9IGVsc2Uge1xuXG4gICAgICAgIGxldCBzdGVwOiBzdHJpbmcgfCBudW1iZXIgPSB0aGlzLmVsZW1lbnQuc3RlcFxuICAgICAgICBpZiAoIXN0ZXAgfHwgc3RlcCA9PT0gXCJhbnlcIikge1xuICAgICAgICAgIHN0ZXAgPSBcIjAuMVwiXG4gICAgICAgIH1cbiAgICAgICAgbGV0IG5ld1ZhbCA9IHZhbCArIChwYXJzZUZsb2F0KHN0ZXApICogZGlyZWN0aW9uKVxuICAgICAgICB2YWwgPSBuZXdWYWxcbiAgICAgIH1cblxuICAgICAgdGhpcy5fc2V0VmFsdWUodmFsLCB0cnVlLCB0cnVlKVxuICAgICAgcmV0dXJuXG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIF9oYW5kbGVGb2N1cygpIHtcbiAgICB0aGlzLl9yYW5nZUNvbnRhaW5lci5hZGRDbGFzcyhDTEFTU19BQ1RJVkUpXG4gIH1cblxuICBwcm90ZWN0ZWQgX2hhbmRsZUJsdXIoKSB7XG4gICAgdGhpcy5fcmFuZ2VDb250YWluZXIucmVtb3ZlQ2xhc3MoQ0xBU1NfQUNUSVZFKVxuICB9XG5cbiAgcHJvdGVjdGVkIF91bmZvY3VzKCkge1xuICAgIGlmICgoZG9jdW1lbnQgYXMgYW55KS5zZWxlY3Rpb24pIHtcbiAgICAgIChkb2N1bWVudCBhcyBhbnkpLnNlbGVjdGlvbi5lbXB0eSgpXG4gICAgfSBlbHNlIHtcbiAgICAgIHdpbmRvdy5nZXRTZWxlY3Rpb24oKSEucmVtb3ZlQWxsUmFuZ2VzKClcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgX2dldFJlbGF0aXZlUG9zaXRpb24oZXZlbnQ6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50KSB7XG4gICAgbGV0IHBhZ2VYXG4gICAgaWYgKFwicGFnZVhcIiBpbiBldmVudCkge1xuICAgICAgcGFnZVggPSBldmVudC5wYWdlWFxuICAgIH0gZWxzZSB7XG4gICAgICBwYWdlWCA9IChldmVudC50b3VjaGVzWzBdIHx8IGV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdKS5wYWdlWFxuICAgIH1cblxuICAgIHJldHVybiBwYWdlWCAtIHRoaXMuX3RyYWNrTGVmdFBvc2l0aW9uICsgdGhpcy5fZ3JhYlBvc2l0aW9uXG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGVzIGFuZCB1cGRhdGVzIHRoZSBwb3NpdGlvbiBhbmQgc2V0cyB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZSBvbiB0aGUgc2xpZGVyLlxuICAgKiBAcGFyYW0ge3Bvc2l0aW9ufSB0aGUgbmV3IHBvc2l0aW9uIHRvIHNldC5cbiAgICogQHBhcmFtIHt1cGRhdGVWYWx1ZX0gdHJ1ZSBpZiB0aGUgdmFsdWUgc2hvdWxkIGJlIHVwZGF0ZWQgYXMgd2VsbDsgb3RoZXJ3aXNlIGZhbHNlLlxuICAgKiBAcGFyYW0ge3NuYXB9IHRydWUgaWYgc25hcHBpbmcgc2hvdWxkIGJlIHVzZWQ7IG90aGVyd2lzZSBmYWxzZS5cbiAgICogQHBhcmFtIHthbmltYXRlfSB0cnVlIGlmIHRoZSBVSSB1cGRhdGUgc2hvdWxkIGJlIGFuaW1hdGVkOyBvdGhlcndpc2UgZmFsc2UuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcm90ZWN0ZWQgX3NldFBvc2l0aW9uKFxuICAgIHBvc2l0aW9uOiBudW1iZXIsXG4gICAgdXBkYXRlVmFsdWUgPSB0cnVlLFxuICAgIHNuYXAgPSBmYWxzZSxcbiAgICBhbmltYXRlID0gdHJ1ZVxuICApIHtcbiAgICBpZiAocG9zaXRpb24gPT09IHVuZGVmaW5lZCB8fCBwb3NpdGlvbiA9PT0gbnVsbCB8fCBOdW1iZXIuaXNOYU4ocG9zaXRpb24pKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQb3NpdGlvbiBpcyBub3QgYSBudW1iZXJcIilcbiAgICB9XG5cbiAgICAvLyBDbGFtcCB0byBtaW4gYW5kIG1heCByYW5nZVxuICAgIGxldCBuZXdQb3MgPSBjbGFtcChwb3NpdGlvbiwgdGhpcy5fdHJhY2tQb3NpdGlvbk1pbiwgdGhpcy5fdHJhY2tQb3NpdGlvbk1heClcbiAgICBpZiAodXBkYXRlVmFsdWUpIHtcbiAgICAgIGxldCB2YWx1ZSA9ICh0aGlzLl90cmFja1ZhbHVlVG90YWwgLyB0aGlzLl90cmFja1dpZHRoKSAqIG5ld1BvcyArIHRoaXMuX21pblZhbHVlXG5cbiAgICAgIGlmICh0aGlzLl90aWNrc1dyYXBwZXIuZWxlbWVudC5jaGlsZE5vZGVzLmxlbmd0aCA+IDEgJiYgc25hcCkge1xuICAgICAgICBsZXQgc25hcFBvcyA9IHRoaXMuX2dldFNuYXBQb3NpdGlvbihuZXdQb3MpXG4gICAgICAgIG5ld1BvcyA9IHNuYXBQb3MucG9zaXRpb25cbiAgICAgICAgdmFsdWUgPSBzbmFwUG9zLnZhbHVlXG4gICAgICB9IGVsc2UgaWYgKHRoaXMuZWxlbWVudC5zdGVwICYmIHRoaXMuZWxlbWVudC5zdGVwICE9PSBcImFueVwiKSB7XG4gICAgICAgIGNvbnN0IHN0ZXAgPSBwYXJzZUZsb2F0KHRoaXMuZWxlbWVudC5zdGVwKVxuICAgICAgICB2YWx1ZSA9IE1hdGgucm91bmQodmFsdWUgLyBzdGVwKSAqIHN0ZXBcbiAgICAgIH1cblxuICAgICAgdGhpcy5fc2V0VmFsdWUodmFsdWUsIGZhbHNlLCBmYWxzZSlcbiAgICB9XG5cbiAgICBpZiAoYW5pbWF0ZSAmJiB1cGRhdGVWYWx1ZSkge1xuICAgICAgdGhpcy5fdXBkYXRlVGlja1N0YXRlKClcbiAgICB9XG5cbiAgICBpZiAoYW5pbWF0ZSkge1xuICAgICAgYW5pbWUoe1xuICAgICAgICB0YXJnZXRzOiB0aGlzLl9yYW5nZVRodW1iLmVsZW1lbnQsXG4gICAgICAgIGR1cmF0aW9uOiAyMDAsXG4gICAgICAgIGxlZnQ6IG5ld1BvcyxcbiAgICAgICAgZWFzaW5nOiBcImVhc2VJbk91dFF1aW50XCJcbiAgICAgIH0pXG5cbiAgICAgIGlmICh0aGlzLl9yYW5nZVByb2dyZXNzKSB7XG4gICAgICAgIGFuaW1lKHtcbiAgICAgICAgICB0YXJnZXRzOiB0aGlzLl9yYW5nZVByb2dyZXNzLmVsZW1lbnQsXG4gICAgICAgICAgZHVyYXRpb246IDIwMCxcbiAgICAgICAgICB3aWR0aDogbmV3UG9zLFxuICAgICAgICAgIGVhc2luZzogXCJlYXNlSW5PdXRRdWludFwiXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3JhbmdlVGh1bWIuZWxlbWVudC5zdHlsZS5sZWZ0ID0gbmV3UG9zICsgXCJweFwiXG5cbiAgICAgIGlmICh0aGlzLl9yYW5nZVByb2dyZXNzKSB7XG4gICAgICAgIHRoaXMuX3JhbmdlUHJvZ3Jlc3MuZWxlbWVudC5zdHlsZS53aWR0aCA9IG5ld1BvcyArIFwicHhcIlxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBzbmFwIHZhbHVlIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIHZhbHVlLlxuICAgKiBAcGFyYW0ge3ZhbHVlfSB0aGUgdGFyZ2V0IHZhbHVlLlxuICAgKiBAcmV0dXJucyBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgc25hcCBwb3NpdGlvbiBhbmQgdGhlIGNvcnJlc3BvbmRpbmcgdmFsdWUuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcm90ZWN0ZWQgX2dldFNuYXBWYWx1ZSh2YWx1ZTogbnVtYmVyKSB7XG4gICAgY29uc3QgdGlja3MgPSB0aGlzLl90aWNrc1dyYXBwZXIuZWxlbWVudC5jaGlsZHJlblxuICAgIGxldCBjdXJyZW50UG9zaXRpb24gPSAwXG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRpY2tzLmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgIGxldCBjdXJyZW50RWxlbWVudCA9IG5ldyBEb21FbGVtZW50KHRpY2tzW2ldKVxuICAgICAgbGV0IGN1cnJlbnRWYWx1ZSA9IHBhcnNlRmxvYXQoY3VycmVudEVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiZGF0YS12YWx1ZVwiKSEpXG4gICAgICBsZXQgY3VycmVudFdpZHRoID0gY3VycmVudEVsZW1lbnQuZWxlbWVudC5jbGllbnRXaWR0aFxuXG4gICAgICBsZXQgbmV4dEVsZW1lbnRcbiAgICAgIGxldCBuZXh0VmFsdWUgPSBOdW1iZXIuTUFYX1ZBTFVFXG5cbiAgICAgIGlmIChpIDwgdGlja3MubGVuZ3RoIC0gMSkge1xuICAgICAgICBuZXh0RWxlbWVudCA9IG5ldyBEb21FbGVtZW50KHRpY2tzW2kgKyAxXSlcbiAgICAgICAgbmV4dFZhbHVlID0gcGFyc2VGbG9hdChuZXh0RWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJkYXRhLXZhbHVlXCIpISlcbiAgICAgIH1cblxuICAgICAgLy8gbGVmdCBtb3N0IGVsZW1lbnRcbiAgICAgIGlmIChpID09PSAwICYmIHZhbHVlIDw9IGN1cnJlbnRWYWx1ZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbHVlOiBjdXJyZW50VmFsdWUsXG4gICAgICAgICAgcG9zaXRpb246IE1BUkdJTl9USUNLIC0gdGhpcy5fZ3JhYlBvc2l0aW9uXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gcmlnaHQgbW9zdCBlbGVtZW50XG4gICAgICBpZiAoIW5leHRFbGVtZW50ICYmIHZhbHVlID49IGN1cnJlbnRWYWx1ZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbHVlOiBjdXJyZW50VmFsdWUsXG4gICAgICAgICAgcG9zaXRpb246IGN1cnJlbnRQb3NpdGlvbiArIChjdXJyZW50V2lkdGggLSBNQVJHSU5fVElDSykgLSB0aGlzLl9ncmFiUG9zaXRpb24gLSAxXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHZhbHVlID49IGN1cnJlbnRWYWx1ZSAmJiB2YWx1ZSA8IG5leHRWYWx1ZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbHVlOiBjdXJyZW50VmFsdWUsXG4gICAgICAgICAgcG9zaXRpb246IGN1cnJlbnRQb3NpdGlvbiArICgwLjUgKiBjdXJyZW50V2lkdGgpIC0gdGhpcy5fZ3JhYlBvc2l0aW9uXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY3VycmVudFBvc2l0aW9uICs9IGN1cnJlbnRXaWR0aFxuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcihcIkNvdWxkIG5vdCBkZXRlcm1pbmUgc25hcCB2YWx1ZVwiKVxuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHNuYXAgcG9zaXRpb24gY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gcG9zaXRpb24uXG4gICAqIEBwYXJhbSB7cG9zaXRpb259IHRoZSB0YXJnZXQgcG9zaXRpb24uXG4gICAqIEByZXR1cm5zIGFuIG9iamVjdCBjb250YWluaW5nIHRoZSBzbmFwIHBvc2l0aW9uIGFuZCB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZS5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByb3RlY3RlZCBfZ2V0U25hcFBvc2l0aW9uKHBvc2l0aW9uPzogbnVtYmVyIHwgbnVsbCkge1xuICAgIGlmIChwb3NpdGlvbiA9PT0gdW5kZWZpbmVkIHx8IHBvc2l0aW9uID09PSBudWxsIHx8IE51bWJlci5pc05hTihwb3NpdGlvbikpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcInBvc2l0aW9uIGlzIG5vdCBhIG51bWJlclwiKVxuICAgIH1cblxuICAgIGNvbnN0IHRpY2tzID0gdGhpcy5fdGlja3NXcmFwcGVyLmVsZW1lbnQuY2hpbGRyZW5cbiAgICBsZXQgY3VycmVudFBvc2l0aW9uID0gMFxuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aWNrcy5sZW5ndGg7IGkrKykge1xuXG4gICAgICBsZXQgY3VycmVudEVsZW1lbnQgPSBuZXcgRG9tRWxlbWVudCh0aWNrc1tpXSlcbiAgICAgIGxldCBjdXJyZW50VmFsdWUgPSBwYXJzZUZsb2F0KGN1cnJlbnRFbGVtZW50LmdldEF0dHJpYnV0ZShcImRhdGEtdmFsdWVcIikhKVxuICAgICAgbGV0IGN1cnJlbnRXaWR0aCA9IGN1cnJlbnRFbGVtZW50LmVsZW1lbnQuY2xpZW50V2lkdGhcblxuICAgICAgbGV0IG5leHRFbGVtZW50XG5cbiAgICAgIGlmIChpIDwgdGlja3MubGVuZ3RoIC0gMSkge1xuICAgICAgICBuZXh0RWxlbWVudCA9IG5ldyBEb21FbGVtZW50KHRpY2tzW2kgKyAxXSlcbiAgICAgIH1cblxuICAgICAgLy8gbGVmdCBtb3N0IGVsZW1lbnRcbiAgICAgIGlmIChpID09PSAwICYmIHBvc2l0aW9uIDw9IGN1cnJlbnRQb3NpdGlvbiArIGN1cnJlbnRXaWR0aCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbHVlOiBjdXJyZW50VmFsdWUsXG4gICAgICAgICAgcG9zaXRpb246IE1BUkdJTl9USUNLIC0gdGhpcy5fZ3JhYlBvc2l0aW9uXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gcmlnaHQgbW9zdCBlbGVtZW50XG4gICAgICBpZiAoIW5leHRFbGVtZW50ICYmIHBvc2l0aW9uID49IGN1cnJlbnRQb3NpdGlvbikge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHZhbHVlOiBjdXJyZW50VmFsdWUsXG4gICAgICAgICAgcG9zaXRpb246IGN1cnJlbnRQb3NpdGlvbiArIChjdXJyZW50V2lkdGggLSBNQVJHSU5fVElDSykgLSB0aGlzLl9ncmFiUG9zaXRpb24gLSAxXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHBvc2l0aW9uID49IGN1cnJlbnRQb3NpdGlvbiAmJiBwb3NpdGlvbiA8IChjdXJyZW50UG9zaXRpb24gKyBjdXJyZW50V2lkdGgpKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsdWU6IGN1cnJlbnRWYWx1ZSxcbiAgICAgICAgICBwb3NpdGlvbjogY3VycmVudFBvc2l0aW9uICsgKDAuNSAqIGN1cnJlbnRXaWR0aCkgLSB0aGlzLl9ncmFiUG9zaXRpb25cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjdXJyZW50UG9zaXRpb24gKz0gY3VycmVudFdpZHRoXG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ291bGQgbm90IGRldGVybWluZSBzbmFwIHBvc2l0aW9uXCIpXG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgbmV4dCB2YWx1ZSBpbiB0aGUgZ2l2ZW4gZGlyZWN0aW9uIHdpdGggcmVnYXJkcyB0byBzbmFwcGluZy5cbiAgICogQHBhcmFtIHt2YWx1ZX0gVGhlIGN1cnJlbnQgdmFsdWUuXG4gICAqIEBwYXJhbSB7ZGlyZWN0aW9ufSBUaGUgZGlyZWN0aW9uIChwb3NpdGl2ZSBvciBuZWdhdGl2ZSBpbnRlZ2VyKS5cbiAgICogQHJldHVybnMgVGhlIG5leHQgdmFsdWUuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcm90ZWN0ZWQgX2dldE5leHRWYWx1ZSh2YWx1ZTogbnVtYmVyLCBkaXJlY3Rpb246IG51bWJlcikge1xuICAgIGNvbnN0IHRpY2tzID0gdGhpcy5fdGlja3NXcmFwcGVyLmVsZW1lbnQuY2hpbGRyZW5cblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGlja3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGN1cnJlbnRFbGVtZW50ID0gbmV3IERvbUVsZW1lbnQodGlja3NbaV0pXG4gICAgICBsZXQgY3VycmVudFZhbCA9IHBhcnNlRmxvYXQoY3VycmVudEVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiZGF0YS12YWx1ZVwiKSEpXG5cbiAgICAgIGlmICh2YWx1ZSA9PT0gY3VycmVudFZhbCkge1xuICAgICAgICBsZXQgaW5kZXggPSBjbGFtcChpICsgZGlyZWN0aW9uLCAwLCB0aWNrcy5sZW5ndGggLSAxKVxuICAgICAgICB2YWx1ZSA9IHBhcnNlRmxvYXQodGlja3NbaW5kZXhdLmdldEF0dHJpYnV0ZShcImRhdGEtdmFsdWVcIikhKVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZVxuICB9XG5cbiAgcHJvdGVjdGVkIF91cGRhdGVUaWNrU3RhdGUoKSB7XG4gICAgaWYgKHRoaXMuX3RpY2tzV3JhcHBlci5lbGVtZW50LmNoaWxkTm9kZXMubGVuZ3RoID4gMSkge1xuICAgICAgbGV0IGFjdGl2ZVRpY2sgPSB0aGlzLl90aWNrc1dyYXBwZXIuZmluZChgLiR7Q0xBU1NfVElDS19BQ1RJVkV9YClcbiAgICAgIGlmIChhY3RpdmVUaWNrKSB7XG4gICAgICAgIGFjdGl2ZVRpY2sucmVtb3ZlQ2xhc3MoQ0xBU1NfVElDS19BQ1RJVkUpXG4gICAgICB9XG4gICAgICBsZXQgbmV3QWN0aXZlVGljayA9IHRoaXMuX3RpY2tzV3JhcHBlci5maW5kKGAuJHtDTEFTU19USUNLfVtkYXRhLXZhbHVlPScke3RoaXMudmFsdWV9J11gKVxuICAgICAgaWYgKG5ld0FjdGl2ZVRpY2spIHtcbiAgICAgICAgbmV3QWN0aXZlVGljay5hZGRDbGFzcyhDTEFTU19USUNLX0FDVElWRSlcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgX2FkanVzdFRpY2tMYWJlbFBvc2l0aW9uKFxuICAgIHRpY2tJdGVtOiBFbGVtZW50LFxuICAgIGxlZnQ6IGJvb2xlYW5cbiAgKSB7XG4gICAgY29uc3QgbGFiZWwgPSBuZXcgRG9tRWxlbWVudCh0aWNrSXRlbS5xdWVyeVNlbGVjdG9yKGAuJHtDTEFTU19USUNLX0xBQkVMfWApISlcblxuICAgIGxldCBkdW1teUVsZW1lbnQgPSBuZXcgRG9tRWxlbWVudChcInNwYW5cIilcbiAgICAgIC5hZGRDbGFzcyhDTEFTU19USUNLX0xBQkVMKVxuICAgICAgLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwidmlzaWJpbGl0eTogaGlkZGVuOyBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7XCIpXG4gICAgICAuc2V0SHRtbChsYWJlbC5pbm5lclRleHQpXG5cbiAgICB0aGlzLl9yYW5nZUNvbnRhaW5lci5hcHBlbmRDaGlsZChkdW1teUVsZW1lbnQpXG5cbiAgICBsZXQgd2lkdGggPSBkdW1teUVsZW1lbnQuZWxlbWVudC5jbGllbnRXaWR0aCAvIDJcbiAgICB0aGlzLl9yYW5nZUNvbnRhaW5lci5yZW1vdmVDaGlsZChkdW1teUVsZW1lbnQpXG5cbiAgICBjb25zdCBmbG9hdFBvc2l0aW9uID0gbGVmdCA/IFwibGVmdFwiIDogXCJyaWdodFwiXG5cbiAgICBpZiAod2lkdGggPCBNQVJHSU5fVElDSykge1xuICAgICAgLy8gY2VudGVyIHNtYWxsIGl0ZW1zIG9uIHRoZSB0aWNrXG4gICAgICBsYWJlbC5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBgJHtmbG9hdFBvc2l0aW9ufTogJHtNQVJHSU5fVElDSyAtIE1hdGguZmxvb3Iod2lkdGgpfXB4OyB0ZXh0LWFsaWduOiAke2Zsb2F0UG9zaXRpb259O2ApXG4gICAgfVxuICB9XG5cbiAgcHJvdGVjdGVkIF9mb3JtYXRPdXRwdXQodmFsdWU6IG51bWJlciwgc2hvcnQ6IGJvb2xlYW4pIHtcbiAgICBpZiAodGhpcy5fZm9ybWF0dGVyKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZm9ybWF0dGVyKHZhbHVlLCBzaG9ydClcbiAgICB9XG5cbiAgICBjb25zdCBzdHIgPSBwYXJzZUZsb2F0KHZhbHVlLnRvRml4ZWQoMikpXG4gICAgcmV0dXJuIHN0ci50b1N0cmluZygpXG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGVzIGFuZCB1cGRhdGVzIHRoZSByYW5nZSB2YWx1ZS5cbiAgICogQHBhcmFtIHt2YWx1ZX0gdGhlIG5ldyB2YWx1ZSB0byBzZXQuXG4gICAqIEBwYXJhbSB7dXBkYXRlfSB0cnVlIGlmIHRoZSBVSSBzaG91bGQgYmUgdXBkYXRlZDsgb3RoZXJ3aXNlIGZhbHNlLlxuICAgKiBAcGFyYW0ge2FuaW1hdGV9IHRydWUgaWYgdGhlIFVJIHVwZGF0ZSBzaG91bGQgYmUgYW5pbWF0ZWQ7IG90aGVyd2lzZSBmYWxzZS5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByb3RlY3RlZCBfc2V0VmFsdWUoXG4gICAgdmFsdWU6IG51bWJlcixcbiAgICB1cGRhdGUgPSB0cnVlLFxuICAgIGFuaW1hdGUgPSBmYWxzZVxuICApIHtcbiAgICBsZXQgdmFsID0gY2xhbXAodmFsdWUsIHRoaXMuX21pblZhbHVlLCB0aGlzLl9tYXhWYWx1ZSlcbiAgICBsZXQgcG9zaXRpb25cblxuICAgIGlmICh0aGlzLl90aWNrc1dyYXBwZXIuZWxlbWVudC5jaGlsZE5vZGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgIGNvbnN0IHNuYXBWYWx1ZSA9IHRoaXMuX2dldFNuYXBWYWx1ZSh2YWwpXG4gICAgICBwb3NpdGlvbiA9IHNuYXBWYWx1ZS5wb3NpdGlvblxuICAgICAgdmFsID0gc25hcFZhbHVlLnZhbHVlXG4gICAgfSBlbHNlIHtcbiAgICAgIHBvc2l0aW9uID0gKHRoaXMuX3RyYWNrV2lkdGggLyB0aGlzLl90cmFja1ZhbHVlVG90YWwpICogKHZhbHVlIC0gdGhpcy5fbWluVmFsdWUpXG4gICAgfVxuXG4gICAgLy8gSWYgdGhlIGNhbGN1bGF0aW9uIGZhaWxlZCwgZmFsbCBiYWNrIHRvIHRoZSBmaXJzdCB0aWNrIHBvc2l0aW9uIGFuZCBkaXNhYmxlIHRoZSBjb21wb25lbnRcbiAgICBpZiAoIXBvc2l0aW9uKSB7XG4gICAgICBwb3NpdGlvbiA9IHRoaXMuX2dldFNuYXBQb3NpdGlvbih2YWwpLnBvc2l0aW9uXG4gICAgICB0aGlzLmRpc2FibGUoKVxuICAgIH1cblxuICAgIHRoaXMuZWxlbWVudC52YWx1ZSA9IFN0cmluZyh2YWwpXG5cbiAgICBpZiAodGhpcy5fdGh1bWJWYWx1ZSkge1xuICAgICAgdGhpcy5fdGh1bWJWYWx1ZS5zZXRIdG1sKHRoaXMuX2Zvcm1hdE91dHB1dCh2YWwsIHRydWUpKVxuICAgIH1cblxuICAgIGlmICh0aGlzLl9vdXRwdXRMYWJlbCkge1xuICAgICAgdGhpcy5fb3V0cHV0TGFiZWwuc2V0SHRtbCh0aGlzLl9mb3JtYXRPdXRwdXQodmFsLCBmYWxzZSkpXG4gICAgfVxuXG4gICAgaWYgKHVwZGF0ZSkge1xuICAgICAgdGhpcy5fc2V0UG9zaXRpb24ocG9zaXRpb24sIGZhbHNlLCBmYWxzZSwgYW5pbWF0ZSlcbiAgICAgIHRoaXMuX3VwZGF0ZVRpY2tTdGF0ZSgpXG4gICAgfVxuXG4gICAgdGhpcy5kaXNwYXRjaEV2ZW50KFwiaW5wdXRcIilcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSB2YWx1ZSBvZiB0aGUgcmFuZ2Ugc2xpZGVyLlxuICAgKi9cbiAgc2V0IHZhbHVlKHZhbHVlOiBudW1iZXIpIHtcbiAgICB0aGlzLl9zZXRWYWx1ZSh2YWx1ZSwgdHJ1ZSwgdHJ1ZSlcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBjdXJyZW50IHZhbHVlLlxuICAgKi9cbiAgZ2V0IHZhbHVlKCkge1xuICAgIHJldHVybiBwYXJzZUZsb2F0KHRoaXMuZWxlbWVudC52YWx1ZSlcbiAgfVxuXG4gIC8qKlxuICAgKiBGb3JjZSB0aGUgY29tcG9uZW50IHRvIHJlLWxheW91dCBpdHNlbGYuXG4gICAqL1xuICBwdWJsaWMgbGF5b3V0KCkge1xuICAgIHRoaXMuX2dyYWJQb3NpdGlvbiA9IE1hdGgucm91bmQodGhpcy5fcmFuZ2VUaHVtYi5lbGVtZW50Lm9mZnNldFdpZHRoIC8gMilcbiAgICBjb25zdCB0aWNrSXRlbXMgPSB0aGlzLl9yYW5nZUNvbnRhaW5lci5lbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYC4ke0NMQVNTX1RJQ0t9YClcbiAgICBjb25zdCB0aWNrc09mZnNldCA9IHRpY2tJdGVtcyAmJiB0aWNrSXRlbXMubGVuZ3RoID4gMCA/ICgyICogTUFSR0lOX1RJQ0spIDogTUFSR0lOX1RJQ0tcblxuICAgIHRoaXMuX3RyYWNrV2lkdGggPSB0aGlzLl9yYW5nZVRyYWNrLmVsZW1lbnQub2Zmc2V0V2lkdGggLSB0aWNrc09mZnNldFxuXG4gICAgdGhpcy5fdHJhY2tQb3NpdGlvbk1pbiA9IDBcbiAgICB0aGlzLl90cmFja1Bvc2l0aW9uTWF4ID0gdGhpcy5fcmFuZ2VUcmFjay5lbGVtZW50LmNsaWVudFdpZHRoIC0gdGhpcy5fcmFuZ2VUaHVtYi5lbGVtZW50Lm9mZnNldFdpZHRoICsgMVxuICAgIHRoaXMuX3RyYWNrTGVmdFBvc2l0aW9uID0gdGhpcy5fcmFuZ2VUcmFjay5lbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgKyBNQVJHSU5fVElDS1xuXG4gICAgbGV0IGl0ZW1Db3VudCA9IHRpY2tJdGVtcy5sZW5ndGggLSAxXG5cbiAgICB0aGlzLl9pdGVtV2lkdGggPSB0aGlzLl90cmFja1dpZHRoIC8gaXRlbUNvdW50XG4gICAgY29uc3Qgb3V0ZXJJdGVtc1dpZHRoID0gKHRoaXMuX2l0ZW1XaWR0aCAqIDAuNSkgKyBNQVJHSU5fVElDS1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gaXRlbUNvdW50OyBpKyspIHtcbiAgICAgIGxldCB3aWR0aCA9IHRoaXMuX2l0ZW1XaWR0aFxuXG4gICAgICBpZiAoaSA9PT0gMCB8fCBpID09PSBpdGVtQ291bnQpIHtcbiAgICAgICAgd2lkdGggPSBvdXRlckl0ZW1zV2lkdGhcbiAgICAgIH1cblxuICAgICAgbGV0IGl0ZW0gPSBuZXcgRG9tRWxlbWVudCh0aWNrSXRlbXNbaV0pXG4gICAgICBpdGVtLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIGB3aWR0aDogJHtNYXRoLmZsb29yKHdpZHRoKX1weDtgKVxuICAgIH1cblxuICAgIC8vIGFkanVzdCBmaXJzdCBhbmQgbGFzdCBsYWJlbCBwb3NpdGlvbnNcbiAgICBpZiAodGlja0l0ZW1zLmxlbmd0aCA+IDEpIHtcbiAgICAgIHRoaXMuX2FkanVzdFRpY2tMYWJlbFBvc2l0aW9uKHRpY2tJdGVtc1swXSwgdHJ1ZSlcbiAgICAgIHRoaXMuX2FkanVzdFRpY2tMYWJlbFBvc2l0aW9uKHRpY2tJdGVtc1t0aWNrSXRlbXMubGVuZ3RoIC0gMV0sIGZhbHNlKVxuICAgIH1cblxuICAgIC8vIHVwZGF0ZSB0aGUgdmFsdWVcbiAgICB0aGlzLl9zZXRWYWx1ZShwYXJzZUZsb2F0KHRoaXMuZWxlbWVudC52YWx1ZSksIHRydWUsIGZhbHNlKVxuICB9XG5cbiAgLyoqXG4gICAqIERlc3Ryb3lzIHRoZSBjb21wb25lbnRzIGFuZCBmcmVlcyBhbGwgcmVmZXJlbmNlcy5cbiAgICovXG4gIHB1YmxpYyBkZXN0cm95KCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIHRoaXMuX3Jlc2l6ZUhhbmRsZXIpXG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJvcmllbnRhdGlvbmNoYW5nZVwiLCB0aGlzLl9yZXNpemVIYW5kbGVyKTtcblxuICAgICh0aGlzIGFzIGFueSkuX2Rvd25IYW5kbGVyID0gbnVsbDtcbiAgICAodGhpcyBhcyBhbnkpLl9tb3ZlSGFuZGxlciA9IG51bGw7XG4gICAgKHRoaXMgYXMgYW55KS5fZW5kSGFuZGxlciA9IG51bGw7XG4gICAgKHRoaXMgYXMgYW55KS5fZm9jdXNIYW5kbGVyID0gbnVsbDtcbiAgICAodGhpcyBhcyBhbnkpLl9ibHVySGFuZGxlciA9IG51bGw7XG5cbiAgICAodGhpcyBhcyBhbnkpLmVsZW1lbnQgPSBudWxsO1xuICAgICh0aGlzIGFzIGFueSkuX3JhbmdlQ29udGFpbmVyID0gbnVsbDtcbiAgICAodGhpcyBhcyBhbnkpLl93cmFwcGVyRWxlbWVudCA9IG51bGxcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZCB1c2UgZGVzdHJveSgpIGluc3RlYWQuXG4gICAqIEB0b2RvIHJlbW92ZSBpbiB2ZXJzaW9uIDIuMC4wXG4gICAqL1xuICBwdWJsaWMgZGVzdG95KCkge1xuICAgIHRoaXMuZGVzdHJveSgpXG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgY29tcG9uZW50IHRvIHRoZSBlbmFibGVkIHN0YXRlLlxuICAgKi9cbiAgcHVibGljIGVuYWJsZSgpIHtcbiAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIilcbiAgICB0aGlzLl93cmFwcGVyRWxlbWVudC5yZW1vdmVDbGFzcyhDTEFTU19ESVNBQkxFRClcblxuICAgIHRoaXMuX3JhbmdlQ29udGFpbmVyLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCB0aGlzLl9kb3duSGFuZGxlcilcbiAgICB0aGlzLl9yYW5nZUNvbnRhaW5lci5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIHRoaXMuX2Rvd25IYW5kbGVyKVxuICAgIHRoaXMuX3JhbmdlQ29udGFpbmVyLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5fa2V5ZG93bkhhbmRsZXIpXG4gICAgdGhpcy5fcmFuZ2VDb250YWluZXIuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgdGhpcy5fZm9jdXNIYW5kbGVyKVxuICAgIHRoaXMuX3JhbmdlQ29udGFpbmVyLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgdGhpcy5fYmx1ckhhbmRsZXIpXG4gIH1cblxuICAvKipcbiAgICogU2V0cyB0aGUgY29tcG9uZW50IHRvIHRoZSBkaXNhYmxlZCBzdGF0ZS5cbiAgICovXG4gIHB1YmxpYyBkaXNhYmxlKCkge1xuICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcIlwiKVxuICAgIHRoaXMuX3dyYXBwZXJFbGVtZW50LmFkZENsYXNzKENMQVNTX0RJU0FCTEVEKVxuXG4gICAgdGhpcy5fcmFuZ2VDb250YWluZXIuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIHRoaXMuX2Rvd25IYW5kbGVyKVxuICAgIHRoaXMuX3JhbmdlQ29udGFpbmVyLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgdGhpcy5fZW5kSGFuZGxlcilcbiAgICB0aGlzLl9yYW5nZUNvbnRhaW5lci5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIiwgdGhpcy5fbW92ZUhhbmRsZXIpXG5cbiAgICB0aGlzLl9yYW5nZUNvbnRhaW5lci5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0b3VjaHN0YXJ0XCIsIHRoaXMuX2Rvd25IYW5kbGVyKVxuXG4gICAgdGhpcy5fcmFuZ2VDb250YWluZXIuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgdGhpcy5fZm9jdXNIYW5kbGVyKVxuICAgIHRoaXMuX3JhbmdlQ29udGFpbmVyLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgdGhpcy5fYmx1ckhhbmRsZXIpXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGluaXQoKSB7XG4gIHNlYXJjaEFuZEluaXRpYWxpemU8SFRNTElucHV0RWxlbWVudD4oXCJpbnB1dFt0eXBlPSdyYW5nZSddXCIsIChlKSA9PiB7XG4gICAgbmV3IFJhbmdlKGUpXG4gIH0pXG59XG5cbmV4cG9ydCBkZWZhdWx0IFJhbmdlXG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uLy4uLy4uIn0=
