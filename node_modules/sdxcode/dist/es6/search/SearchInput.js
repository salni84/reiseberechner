import * as tslib_1 from "tslib";
import anime from "animejs";
import DomElement from "../DomElement";
import * as Inputs from "../Inputs";
import { searchAndInitialize, preventDefault, internetExplorerOrEdgeVersion } from "../Utils";
import { addClass, removeClass, getAttributeReference, parentWithClass } from "../DomFunctions";
var QUERY_SEARCH_INPUT = "input.search__field";
var QUERY_BTN_CLOSE = ".search__icon-close";
var QUERY_LIVE_SUGESTIONS = ".js-suggestions";
var QUERY_LIVE_FOOTER = ".js-footer";
var CLASS_ACTIVE = "is-active";
var CLASS_OPEN = "is-open";
var CLASS_SEARCH = "search";
var ANIMATION_SUGGESTIONS_DURATION = 300;
var ANIMATION_FOOTER_DURATION = 100;
var ANIMATION_FOOTER_DELAY = ANIMATION_SUGGESTIONS_DURATION - ANIMATION_FOOTER_DURATION;
/**
 * The search input component definition.
 */
var SearchInput = /** @class */ (function (_super) {
    tslib_1.__extends(SearchInput, _super);
    function SearchInput(element) {
        var _this = _super.call(this, element) || this;
        _this._isOpen = false;
        _this._input = _this.element.querySelector(QUERY_SEARCH_INPUT);
        _this._form = _this.element.querySelector("form");
        _this._btnClose = _this.element.querySelector(QUERY_BTN_CLOSE);
        var liveSearch = getAttributeReference(_this.element, "data-live");
        if (liveSearch) {
            _this._liveSuggestions = liveSearch.querySelector(QUERY_LIVE_SUGESTIONS) || undefined;
            _this._liveFooter = liveSearch.querySelector(QUERY_LIVE_FOOTER) || undefined;
            if (_this._liveSuggestions) {
                _this._liveContainer = _this._liveSuggestions.parentNode || undefined;
            }
        }
        _this._focusHandler = _this._handleInputFocus.bind(_this);
        _this._blurHandler = _this._handleInputBlur.bind(_this);
        _this._closeHandler = _this.close.bind(_this);
        _this._windowClickHandler = _this._handleWindowClick.bind(_this);
        _this._keydownHandler = _this._handleKeydown.bind(_this);
        _this._resizeHandler = _this._handleResize.bind(_this);
        _this._initialize();
        return _this;
    }
    SearchInput.prototype._initialize = function () {
        this._input.addEventListener("focus", this._focusHandler);
        this._input.addEventListener("blur", this._blurHandler);
        if (internetExplorerOrEdgeVersion() > 0) {
            // This is a workaround for IE browsers where a focused
            // input's cursor bleeds trough even if hidden
            window.addEventListener("resize", this._resizeHandler);
            window.addEventListener("orientationchange", this._resizeHandler);
        }
        if (this._btnClose) {
            this._btnClose.addEventListener("click", this._closeHandler);
        }
    };
    SearchInput.prototype._handleInputFocus = function () {
        this.addClass(CLASS_ACTIVE);
    };
    SearchInput.prototype._handleInputBlur = function () {
        this.removeClass(CLASS_ACTIVE);
    };
    SearchInput.prototype._handleWindowClick = function (event) {
        var target = event.target;
        if (!parentWithClass(target, CLASS_SEARCH)) {
            this.close();
            return false;
        }
        return true;
    };
    SearchInput.prototype._handleKeydown = function (event) {
        var keycode = event.which || event.keyCode;
        if (keycode === Inputs.KEY_ESCAPE) {
            this.close();
            preventDefault(event);
        }
    };
    SearchInput.prototype._handleResize = function () {
        var style = window.getComputedStyle(this.element);
        if (style.display === "none") {
            this._input.blur();
        }
    };
    SearchInput.prototype._resetMainTimeline = function () {
        if (this.animation) {
            this.animation.pause();
        }
        anime.remove(this._liveSuggestions);
        anime.remove(this._liveFooter);
        this.animation = anime.timeline();
    };
    Object.defineProperty(SearchInput.prototype, "value", {
        /**
         * Gets the search input text content.
         * @returns {String} The input text.
         */
        get: function () {
            return this._input.value;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Opens/activates the search input.
     */
    SearchInput.prototype.open = function () {
        var _this = this;
        this.addClass(CLASS_OPEN);
        this._input.focus();
        setTimeout(function () {
            window.addEventListener("click", _this._windowClickHandler);
            window.addEventListener("touchend", _this._windowClickHandler);
            window.addEventListener("keydown", _this._keydownHandler);
        }, 50);
    };
    /**
     * Closes/deactivates the search input.
     */
    SearchInput.prototype.close = function () {
        this._form.reset();
        this.removeClass(CLASS_OPEN);
        this.closeLiveSearch();
        window.removeEventListener("click", this._windowClickHandler);
        window.removeEventListener("touchend", this._windowClickHandler);
        window.removeEventListener("keydown", this._keydownHandler);
    };
    /**
     * Opens the live search suggestions.
     */
    SearchInput.prototype.openLiveSearch = function () {
        var _this = this;
        if (!this._liveSuggestions || this._isOpen) {
            return;
        }
        this._isOpen = true;
        addClass(this._liveContainer, CLASS_OPEN);
        this._resetMainTimeline();
        this._liveSuggestions.style.display = "block";
        this.animation.add({
            targets: this._liveSuggestions,
            duration: ANIMATION_SUGGESTIONS_DURATION,
            height: this._liveSuggestions.scrollHeight + "px",
            easing: "cubicBezier(0.550, 0.085, 0.320, 1)",
            complete: function () {
                var domEl = new DomElement(_this._liveSuggestions);
                domEl.addClass(CLASS_OPEN);
                domEl.setAttribute("style", "");
            }
        });
        if (this._liveFooter) {
            this._liveFooter.style.display = "block";
            this.animation.add({
                targets: this._liveFooter,
                duration: ANIMATION_FOOTER_DURATION,
                height: this._liveFooter.scrollHeight + "px",
                easing: "cubicBezier(0.550, 0.085, 0.320, 1)",
                offset: ANIMATION_FOOTER_DELAY,
                complete: function () {
                    var domEl = new DomElement(_this._liveFooter);
                    domEl.addClass(CLASS_OPEN);
                    domEl.setAttribute("style", "");
                }
            });
        }
    };
    /**
     * Closes the live search suggestions.
     */
    SearchInput.prototype.closeLiveSearch = function () {
        var _this = this;
        if (!this._liveSuggestions || !this.isOpen) {
            return;
        }
        this._isOpen = false;
        this._resetMainTimeline();
        this._liveSuggestions.style.display = "block";
        this.animation.add({
            targets: this._liveSuggestions,
            duration: ANIMATION_SUGGESTIONS_DURATION,
            height: 0,
            easing: "cubicBezier(0.550, 0.085, 0.320, 1)",
            complete: function () {
                var domEl = new DomElement(_this._liveSuggestions);
                domEl.removeClass(CLASS_OPEN);
                domEl.setAttribute("style", "");
                removeClass(_this._liveContainer, CLASS_OPEN);
            }
        });
        if (this._liveFooter) {
            this._liveFooter.style.display = "block";
            this.animation.add({
                targets: this._liveFooter,
                duration: ANIMATION_FOOTER_DURATION,
                height: 0,
                easing: "cubicBezier(0.550, 0.085, 0.320, 1)",
                offset: 0,
                complete: function () {
                    var domEl = new DomElement(_this._liveFooter);
                    domEl.removeClass(CLASS_OPEN);
                    domEl.setAttribute("style", "");
                }
            });
        }
    };
    /**
     * Destroys the component and clears all references.
     */
    SearchInput.prototype.destroy = function () {
        window.removeEventListener("click", this._windowClickHandler);
        window.removeEventListener("touchend", this._windowClickHandler);
        window.removeEventListener("keydown", this._keydownHandler);
        this._input.removeEventListener("focus", this._focusHandler);
        this._input.removeEventListener("blur", this._blurHandler);
        window.removeEventListener("resize", this._resizeHandler);
        window.removeEventListener("orientationchange", this._resizeHandler);
        if (this._btnClose) {
            this._btnClose.removeEventListener("click", this._closeHandler);
        }
        this._input = null;
        this._form = null;
        this._btnClose = null;
        this._focusHandler = null;
        this._blurHandler = null;
        this._closeHandler = null;
        this._windowClickHandler = null;
        this._keydownHandler = null;
        this._liveSuggestions = null;
        this._liveFooter = null;
    };
    /**
     * Determines if the SearchInput is open/visible.
     * @return {Boolean} - True if open; otherwise false.
     */
    SearchInput.prototype.isOpen = function () {
        return this.hasClass(CLASS_OPEN);
    };
    return SearchInput;
}(DomElement));
export function init() {
    searchAndInitialize(".search.search__input", function (e) {
        new SearchInput(e);
    });
}
export default SearchInput;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4vc3JjL3NlYXJjaC9TZWFyY2hJbnB1dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxLQUFnQyxNQUFNLFNBQVMsQ0FBQTtBQUN0RCxPQUFPLFVBQVUsTUFBTSxlQUFlLENBQUE7QUFDdEMsT0FBTyxLQUFLLE1BQU0sTUFBTSxXQUFXLENBQUE7QUFDbkMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLGNBQWMsRUFBRSw2QkFBNkIsRUFBRSxNQUFNLFVBQVUsQ0FBQTtBQUM3RixPQUFPLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxxQkFBcUIsRUFBRSxlQUFlLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQTtBQUUvRixJQUFNLGtCQUFrQixHQUFHLHFCQUFxQixDQUFBO0FBQ2hELElBQU0sZUFBZSxHQUFHLHFCQUFxQixDQUFBO0FBRTdDLElBQU0scUJBQXFCLEdBQUcsaUJBQWlCLENBQUE7QUFDL0MsSUFBTSxpQkFBaUIsR0FBRyxZQUFZLENBQUE7QUFFdEMsSUFBTSxZQUFZLEdBQUcsV0FBVyxDQUFBO0FBQ2hDLElBQU0sVUFBVSxHQUFHLFNBQVMsQ0FBQTtBQUU1QixJQUFNLFlBQVksR0FBRyxRQUFRLENBQUE7QUFFN0IsSUFBTSw4QkFBOEIsR0FBRyxHQUFHLENBQUE7QUFDMUMsSUFBTSx5QkFBeUIsR0FBRyxHQUFHLENBQUE7QUFDckMsSUFBTSxzQkFBc0IsR0FBRyw4QkFBOEIsR0FBRyx5QkFBeUIsQ0FBQTtBQUV6Rjs7R0FFRztBQUNIO0lBQTBCLHVDQUFVO0lBa0JsQyxxQkFBWSxPQUFvQjtRQUFoQyxZQUNFLGtCQUFNLE9BQU8sQ0FBQyxTQXdCZjtRQTVCTyxhQUFPLEdBQVksS0FBSyxDQUFBO1FBTTlCLEtBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQXFCLENBQUE7UUFDaEYsS0FBSSxDQUFDLEtBQUssR0FBRyxLQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxN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QUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7UUFFcEMsSUFBWSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQztRQUNyQyxJQUFZLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQTtJQUNsQyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksNEJBQU0sR0FBYjtRQUNFLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQTtJQUNsQyxDQUFDO0lBQ0gsa0JBQUM7QUFBRCxDQS9RQSxBQStRQyxDQS9ReUIsVUFBVSxHQStRbkM7QUFFRCxNQUFNLFVBQVUsSUFBSTtJQUNsQixtQkFBbUIsQ0FBYyx1QkFBdUIsRUFBRSxVQUFDLENBQUM7UUFDMUQsSUFBSSxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDcEIsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDO0FBRUQsZUFBZSxXQUFXLENBQUEiLCJmaWxlIjoibWFpbi9zcmMvc2VhcmNoL1NlYXJjaElucHV0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFuaW1lLCB7IEFuaW1lVGltZWxpbmVJbnN0YW5jZSB9IGZyb20gXCJhbmltZWpzXCJcbmltcG9ydCBEb21FbGVtZW50IGZyb20gXCIuLi9Eb21FbGVtZW50XCJcbmltcG9ydCAqIGFzIElucHV0cyBmcm9tIFwiLi4vSW5wdXRzXCJcbmltcG9ydCB7IHNlYXJjaEFuZEluaXRpYWxpemUsIHByZXZlbnREZWZhdWx0LCBpbnRlcm5ldEV4cGxvcmVyT3JFZGdlVmVyc2lvbiB9IGZyb20gXCIuLi9VdGlsc1wiXG5pbXBvcnQgeyBhZGRDbGFzcywgcmVtb3ZlQ2xhc3MsIGdldEF0dHJpYnV0ZVJlZmVyZW5jZSwgcGFyZW50V2l0aENsYXNzIH0gZnJvbSBcIi4uL0RvbUZ1bmN0aW9uc1wiXG5cbmNvbnN0IFFVRVJZX1NFQVJDSF9JTlBVVCA9IFwiaW5wdXQuc2VhcmNoX19maWVsZFwiXG5jb25zdCBRVUVSWV9CVE5fQ0xPU0UgPSBcIi5zZWFyY2hfX2ljb24tY2xvc2VcIlxuXG5jb25zdCBRVUVSWV9MSVZFX1NVR0VTVElPTlMgPSBcIi5qcy1zdWdnZXN0aW9uc1wiXG5jb25zdCBRVUVSWV9MSVZFX0ZPT1RFUiA9IFwiLmpzLWZvb3RlclwiXG5cbmNvbnN0IENMQVNTX0FDVElWRSA9IFwiaXMtYWN0aXZlXCJcbmNvbnN0IENMQVNTX09QRU4gPSBcImlzLW9wZW5cIlxuXG5jb25zdCBDTEFTU19TRUFSQ0ggPSBcInNlYXJjaFwiXG5cbmNvbnN0IEFOSU1BVElPTl9TVUdHRVNUSU9OU19EVVJBVElPTiA9IDMwMFxuY29uc3QgQU5JTUFUSU9OX0ZPT1RFUl9EVVJBVElPTiA9IDEwMFxuY29uc3QgQU5JTUFUSU9OX0ZPT1RFUl9ERUxBWSA9IEFOSU1BVElPTl9TVUdHRVNUSU9OU19EVVJBVElPTiAtIEFOSU1BVElPTl9GT09URVJfRFVSQVRJT05cblxuLyoqXG4gKiBUaGUgc2VhcmNoIGlucHV0IGNvbXBvbmVudCBkZWZpbml0aW9uLlxuICovXG5jbGFzcyBTZWFyY2hJbnB1dCBleHRlbmRzIERvbUVsZW1lbnQge1xuICBwcml2YXRlIF9pbnB1dDogSFRNTElucHV0RWxlbWVudFxuICBwcml2YXRlIF9mb3JtOiBIVE1MRm9ybUVsZW1lbnRcbiAgcHJpdmF0ZSBfYnRuQ2xvc2U6IEhUTUxFbGVtZW50XG4gIHByaXZhdGUgX2xpdmVTdWdnZXN0aW9ucz86IEhUTUxFbGVtZW50XG4gIHByaXZhdGUgX2xpdmVGb290ZXI/OiBIVE1MRWxlbWVudFxuICBwcml2YXRlIF9saXZlQ29udGFpbmVyPzogSFRNTEVsZW1lbnRcblxuICBwcml2YXRlIF9mb2N1c0hhbmRsZXI6IChlOiBFdmVudCkgPT4gdm9pZFxuICBwcml2YXRlIF9ibHVySGFuZGxlcjogKGU6IEV2ZW50KSA9PiB2b2lkXG4gIHByaXZhdGUgX2Nsb3NlSGFuZGxlcjogKGU6IEV2ZW50KSA9PiB2b2lkXG4gIHByaXZhdGUgX3dpbmRvd0NsaWNrSGFuZGxlcjogKGU6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50KSA9PiB2b2lkXG4gIHByaXZhdGUgX2tleWRvd25IYW5kbGVyOiAoZTogS2V5Ym9hcmRFdmVudCkgPT4gdm9pZFxuICBwcml2YXRlIF9yZXNpemVIYW5kbGVyOiAoZTogRXZlbnQpID0+IHZvaWRcblxuICBwcml2YXRlIF9pc09wZW46IGJvb2xlYW4gPSBmYWxzZVxuICBwcml2YXRlIGFuaW1hdGlvbiE6IEFuaW1lVGltZWxpbmVJbnN0YW5jZVxuXG4gIGNvbnN0cnVjdG9yKGVsZW1lbnQ6IEhUTUxFbGVtZW50KSB7XG4gICAgc3VwZXIoZWxlbWVudClcblxuICAgIHRoaXMuX2lucHV0ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoUVVFUllfU0VBUkNIX0lOUFVUKSBhcyBIVE1MSW5wdXRFbGVtZW50XG4gICAgdGhpcy5fZm9ybSA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiZm9ybVwiKSFcbiAgICB0aGlzLl9idG5DbG9zZSA9IHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFFVRVJZX0JUTl9DTE9TRSkgYXMgSFRNTEVsZW1lbnRcblxuICAgIGxldCBsaXZlU2VhcmNoID0gZ2V0QXR0cmlidXRlUmVmZXJlbmNlKHRoaXMuZWxlbWVudCwgXCJkYXRhLWxpdmVcIilcbiAgICBpZiAobGl2ZVNlYXJjaCkge1xuICAgICAgdGhpcy5fbGl2ZVN1Z2dlc3Rpb25zID0gbGl2ZVNlYXJjaC5xdWVyeVNlbGVjdG9yKFFVRVJZX0xJVkVfU1VHRVNUSU9OUykgYXMgSFRNTEVsZW1lbnQgfHwgdW5kZWZpbmVkXG4gICAgICB0aGlzLl9saXZlRm9vdGVyID0gbGl2ZVNlYXJjaC5xdWVyeVNlbGVjdG9yKFFVRVJZX0xJVkVfRk9PVEVSKSBhcyBIVE1MRWxlbWVudCB8fCB1bmRlZmluZWRcblxuICAgICAgaWYgKHRoaXMuX2xpdmVTdWdnZXN0aW9ucykge1xuICAgICAgICB0aGlzLl9saXZlQ29udGFpbmVyID0gdGhpcy5fbGl2ZVN1Z2dlc3Rpb25zLnBhcmVudE5vZGUgYXMgSFRNTEVsZW1lbnQgfHwgdW5kZWZpbmVkXG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5fZm9jdXNIYW5kbGVyID0gdGhpcy5faGFuZGxlSW5wdXRGb2N1cy5iaW5kKHRoaXMpXG4gICAgdGhpcy5fYmx1ckhhbmRsZXIgPSB0aGlzLl9oYW5kbGVJbnB1dEJsdXIuYmluZCh0aGlzKVxuICAgIHRoaXMuX2Nsb3NlSGFuZGxlciA9IHRoaXMuY2xvc2UuYmluZCh0aGlzKVxuICAgIHRoaXMuX3dpbmRvd0NsaWNrSGFuZGxlciA9IHRoaXMuX2hhbmRsZVdpbmRvd0NsaWNrLmJpbmQodGhpcylcbiAgICB0aGlzLl9rZXlkb3duSGFuZGxlciA9IHRoaXMuX2hhbmRsZUtleWRvd24uYmluZCh0aGlzKVxuICAgIHRoaXMuX3Jlc2l6ZUhhbmRsZXIgPSB0aGlzLl9oYW5kbGVSZXNpemUuYmluZCh0aGlzKVxuXG4gICAgdGhpcy5faW5pdGlhbGl6ZSgpXG4gIH1cblxuICBwcm90ZWN0ZWQgX2luaXRpYWxpemUoKSB7XG4gICAgdGhpcy5faW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImZvY3VzXCIsIHRoaXMuX2ZvY3VzSGFuZGxlcilcbiAgICB0aGlzLl9pbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiYmx1clwiLCB0aGlzLl9ibHVySGFuZGxlcilcblxuICAgIGlmIChpbnRlcm5ldEV4cGxvcmVyT3JFZGdlVmVyc2lvbigpID4gMCkge1xuICAgICAgLy8gVGhpcyBpcyBhIHdvcmthcm91bmQgZm9yIElFIGJyb3dzZXJzIHdoZXJlIGEgZm9jdXNlZFxuICAgICAgLy8gaW5wdXQncyBjdXJzb3IgYmxlZWRzIHRyb3VnaCBldmVuIGlmIGhpZGRlblxuXG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCB0aGlzLl9yZXNpemVIYW5kbGVyKVxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJvcmllbnRhdGlvbmNoYW5nZVwiLCB0aGlzLl9yZXNpemVIYW5kbGVyKVxuICAgIH1cblxuICAgIGlmICh0aGlzLl9idG5DbG9zZSkge1xuICAgICAgdGhpcy5fYnRuQ2xvc2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2Nsb3NlSGFuZGxlcilcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgX2hhbmRsZUlucHV0Rm9jdXMoKSB7XG4gICAgdGhpcy5hZGRDbGFzcyhDTEFTU19BQ1RJVkUpXG4gIH1cblxuICBwcm90ZWN0ZWQgX2hhbmRsZUlucHV0Qmx1cigpIHtcbiAgICB0aGlzLnJlbW92ZUNsYXNzKENMQVNTX0FDVElWRSlcbiAgfVxuXG4gIHByb3RlY3RlZCBfaGFuZGxlV2luZG93Q2xpY2soZXZlbnQ6IE1vdXNlRXZlbnQgfCBUb3VjaEV2ZW50KSB7XG4gICAgbGV0IHRhcmdldCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MRWxlbWVudFxuXG4gICAgaWYgKCFwYXJlbnRXaXRoQ2xhc3ModGFyZ2V0LCBDTEFTU19TRUFSQ0gpKSB7XG4gICAgICB0aGlzLmNsb3NlKClcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH1cblxuICAgIHJldHVybiB0cnVlXG4gIH1cblxuICBwcm90ZWN0ZWQgX2hhbmRsZUtleWRvd24oZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICBsZXQga2V5Y29kZSA9IGV2ZW50LndoaWNoIHx8IGV2ZW50LmtleUNvZGVcblxuICAgIGlmIChrZXljb2RlID09PSBJbnB1dHMuS0VZX0VTQ0FQRSkge1xuICAgICAgdGhpcy5jbG9zZSgpXG4gICAgICBwcmV2ZW50RGVmYXVsdChldmVudClcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgX2hhbmRsZVJlc2l6ZSgpIHtcbiAgICBsZXQgc3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmVsZW1lbnQpXG4gICAgaWYgKHN0eWxlLmRpc3BsYXkgPT09IFwibm9uZVwiKSB7XG4gICAgICB0aGlzLl9pbnB1dC5ibHVyKClcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgX3Jlc2V0TWFpblRpbWVsaW5lKCkge1xuICAgIGlmICh0aGlzLmFuaW1hdGlvbikge1xuICAgICAgdGhpcy5hbmltYXRpb24ucGF1c2UoKVxuICAgIH1cbiAgICBhbmltZS5yZW1vdmUodGhpcy5fbGl2ZVN1Z2dlc3Rpb25zISlcbiAgICBhbmltZS5yZW1vdmUodGhpcy5fbGl2ZUZvb3RlciEpXG5cbiAgICB0aGlzLmFuaW1hdGlvbiA9IGFuaW1lLnRpbWVsaW5lKClcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBzZWFyY2ggaW5wdXQgdGV4dCBjb250ZW50LlxuICAgKiBAcmV0dXJucyB7U3RyaW5nfSBUaGUgaW5wdXQgdGV4dC5cbiAgICovXG4gIGdldCB2YWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5faW5wdXQudmFsdWVcbiAgfVxuXG4gIC8qKlxuICAgKiBPcGVucy9hY3RpdmF0ZXMgdGhlIHNlYXJjaCBpbnB1dC5cbiAgICovXG4gIHB1YmxpYyBvcGVuKCkge1xuICAgIHRoaXMuYWRkQ2xhc3MoQ0xBU1NfT1BFTilcbiAgICB0aGlzLl9pbnB1dC5mb2N1cygpXG5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5fd2luZG93Q2xpY2tIYW5kbGVyKVxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCB0aGlzLl93aW5kb3dDbGlja0hhbmRsZXIpXG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5fa2V5ZG93bkhhbmRsZXIpXG4gICAgfSwgNTApXG4gIH1cblxuICAvKipcbiAgICogQ2xvc2VzL2RlYWN0aXZhdGVzIHRoZSBzZWFyY2ggaW5wdXQuXG4gICAqL1xuICBwdWJsaWMgY2xvc2UoKSB7XG4gICAgdGhpcy5fZm9ybS5yZXNldCgpXG4gICAgdGhpcy5yZW1vdmVDbGFzcyhDTEFTU19PUEVOKVxuXG4gICAgdGhpcy5jbG9zZUxpdmVTZWFyY2goKVxuXG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLl93aW5kb3dDbGlja0hhbmRsZXIpXG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0b3VjaGVuZFwiLCB0aGlzLl93aW5kb3dDbGlja0hhbmRsZXIpXG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2tleWRvd25IYW5kbGVyKVxuICB9XG5cbiAgLyoqXG4gICAqIE9wZW5zIHRoZSBsaXZlIHNlYXJjaCBzdWdnZXN0aW9ucy5cbiAgICovXG4gIHB1YmxpYyBvcGVuTGl2ZVNlYXJjaCgpIHtcbiAgICBpZiAoIXRoaXMuX2xpdmVTdWdnZXN0aW9ucyB8fCB0aGlzLl9pc09wZW4pIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHRoaXMuX2lzT3BlbiA9IHRydWVcbiAgICBhZGRDbGFzcyh0aGlzLl9saXZlQ29udGFpbmVyISwgQ0xBU1NfT1BFTilcblxuICAgIHRoaXMuX3Jlc2V0TWFpblRpbWVsaW5lKClcblxuICAgIHRoaXMuX2xpdmVTdWdnZXN0aW9ucy5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiXG5cbiAgICB0aGlzLmFuaW1hdGlvbi5hZGQoe1xuICAgICAgdGFyZ2V0czogdGhpcy5fbGl2ZVN1Z2dlc3Rpb25zLFxuICAgICAgZHVyYXRpb246IEFOSU1BVElPTl9TVUdHRVNUSU9OU19EVVJBVElPTixcbiAgICAgIGhlaWdodDogdGhpcy5fbGl2ZVN1Z2dlc3Rpb25zLnNjcm9sbEhlaWdodCArIFwicHhcIixcbiAgICAgIGVhc2luZzogXCJjdWJpY0JlemllcigwLjU1MCwgMC4wODUsIDAuMzIwLCAxKVwiLFxuICAgICAgY29tcGxldGU6ICgpID0+IHtcbiAgICAgICAgY29uc3QgZG9tRWwgPSBuZXcgRG9tRWxlbWVudCh0aGlzLl9saXZlU3VnZ2VzdGlvbnMhKVxuICAgICAgICBkb21FbC5hZGRDbGFzcyhDTEFTU19PUEVOKVxuICAgICAgICBkb21FbC5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcIlwiKVxuICAgICAgfVxuICAgIH0pXG5cbiAgICBpZiAodGhpcy5fbGl2ZUZvb3Rlcikge1xuICAgICAgdGhpcy5fbGl2ZUZvb3Rlci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiXG5cbiAgICAgIHRoaXMuYW5pbWF0aW9uLmFkZCh7XG4gICAgICAgIHRhcmdldHM6IHRoaXMuX2xpdmVGb290ZXIsXG4gICAgICAgIGR1cmF0aW9uOiBBTklNQVRJT05fRk9PVEVSX0RVUkFUSU9OLFxuICAgICAgICBoZWlnaHQ6IHRoaXMuX2xpdmVGb290ZXIuc2Nyb2xsSGVpZ2h0ICsgXCJweFwiLFxuICAgICAgICBlYXNpbmc6IFwiY3ViaWNCZXppZXIoMC41NTAsIDAuMDg1LCAwLjMyMCwgMSlcIixcbiAgICAgICAgb2Zmc2V0OiBBTklNQVRJT05fRk9PVEVSX0RFTEFZLFxuICAgICAgICBjb21wbGV0ZTogKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IGRvbUVsID0gbmV3IERvbUVsZW1lbnQodGhpcy5fbGl2ZUZvb3RlciEpXG4gICAgICAgICAgZG9tRWwuYWRkQ2xhc3MoQ0xBU1NfT1BFTilcbiAgICAgICAgICBkb21FbC5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcIlwiKVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDbG9zZXMgdGhlIGxpdmUgc2VhcmNoIHN1Z2dlc3Rpb25zLlxuICAgKi9cbiAgcHVibGljIGNsb3NlTGl2ZVNlYXJjaCgpIHtcbiAgICBpZiAoIXRoaXMuX2xpdmVTdWdnZXN0aW9ucyB8fCAhdGhpcy5pc09wZW4pIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHRoaXMuX2lzT3BlbiA9IGZhbHNlXG4gICAgdGhpcy5fcmVzZXRNYWluVGltZWxpbmUoKVxuXG4gICAgdGhpcy5fbGl2ZVN1Z2dlc3Rpb25zLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCJcblxuICAgIHRoaXMuYW5pbWF0aW9uLmFkZCh7XG4gICAgICB0YXJnZXRzOiB0aGlzLl9saXZlU3VnZ2VzdGlvbnMsXG4gICAgICBkdXJhdGlvbjogQU5JTUFUSU9OX1NVR0dFU1RJT05TX0RVUkFUSU9OLFxuICAgICAgaGVpZ2h0OiAwLFxuICAgICAgZWFzaW5nOiBcImN1YmljQmV6aWVyKDAuNTUwLCAwLjA4NSwgMC4zMjAsIDEpXCIsXG4gICAgICBjb21wbGV0ZTogKCkgPT4ge1xuICAgICAgICBjb25zdCBkb21FbCA9IG5ldyBEb21FbGVtZW50KHRoaXMuX2xpdmVTdWdnZXN0aW9ucyEpXG4gICAgICAgIGRvbUVsLnJlbW92ZUNsYXNzKENMQVNTX09QRU4pXG4gICAgICAgIGRvbUVsLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiXCIpXG4gICAgICAgIHJlbW92ZUNsYXNzKHRoaXMuX2xpdmVDb250YWluZXIhLCBDTEFTU19PUEVOKVxuICAgICAgfVxuICAgIH0pXG5cbiAgICBpZiAodGhpcy5fbGl2ZUZvb3Rlcikge1xuICAgICAgdGhpcy5fbGl2ZUZvb3Rlci5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiXG5cbiAgICAgIHRoaXMuYW5pbWF0aW9uLmFkZCh7XG4gICAgICAgIHRhcmdldHM6IHRoaXMuX2xpdmVGb290ZXIsXG4gICAgICAgIGR1cmF0aW9uOiBBTklNQVRJT05fRk9PVEVSX0RVUkFUSU9OLFxuICAgICAgICBoZWlnaHQ6IDAsXG4gICAgICAgIGVhc2luZzogXCJjdWJpY0JlemllcigwLjU1MCwgMC4wODUsIDAuMzIwLCAxKVwiLFxuICAgICAgICBvZmZzZXQ6IDAsXG4gICAgICAgIGNvbXBsZXRlOiAoKSA9PiB7XG4gICAgICAgICAgY29uc3QgZG9tRWwgPSBuZXcgRG9tRWxlbWVudCh0aGlzLl9saXZlRm9vdGVyISlcbiAgICAgICAgICBkb21FbC5yZW1vdmVDbGFzcyhDTEFTU19PUEVOKVxuICAgICAgICAgIGRvbUVsLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwiXCIpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERlc3Ryb3lzIHRoZSBjb21wb25lbnQgYW5kIGNsZWFycyBhbGwgcmVmZXJlbmNlcy5cbiAgICovXG4gIHB1YmxpYyBkZXN0cm95KCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5fd2luZG93Q2xpY2tIYW5kbGVyKVxuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwidG91Y2hlbmRcIiwgdGhpcy5fd2luZG93Q2xpY2tIYW5kbGVyKVxuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9rZXlkb3duSGFuZGxlcilcblxuICAgIHRoaXMuX2lucHV0LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJmb2N1c1wiLCB0aGlzLl9mb2N1c0hhbmRsZXIpXG4gICAgdGhpcy5faW5wdXQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImJsdXJcIiwgdGhpcy5fYmx1ckhhbmRsZXIpXG5cbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInJlc2l6ZVwiLCB0aGlzLl9yZXNpemVIYW5kbGVyKVxuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwib3JpZW50YXRpb25jaGFuZ2VcIiwgdGhpcy5fcmVzaXplSGFuZGxlcilcblxuICAgIGlmICh0aGlzLl9idG5DbG9zZSkge1xuICAgICAgdGhpcy5fYnRuQ2xvc2UucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuX2Nsb3NlSGFuZGxlcilcbiAgICB9XG5cbiAgICAodGhpcyBhcyBhbnkpLl9pbnB1dCA9IG51bGw7XG4gICAgKHRoaXMgYXMgYW55KS5fZm9ybSA9IG51bGw7XG4gICAgKHRoaXMgYXMgYW55KS5fYnRuQ2xvc2UgPSBudWxsO1xuXG4gICAgKHRoaXMgYXMgYW55KS5fZm9jdXNIYW5kbGVyID0gbnVsbDtcbiAgICAodGhpcyBhcyBhbnkpLl9ibHVySGFuZGxlciA9IG51bGw7XG4gICAgKHRoaXMgYXMgYW55KS5fY2xvc2VIYW5kbGVyID0gbnVsbDtcbiAgICAodGhpcyBhcyBhbnkpLl93aW5kb3dDbGlja0hhbmRsZXIgPSBudWxsO1xuICAgICh0aGlzIGFzIGFueSkuX2tleWRvd25IYW5kbGVyID0gbnVsbDtcblxuICAgICh0aGlzIGFzIGFueSkuX2xpdmVTdWdnZXN0aW9ucyA9IG51bGw7XG4gICAgKHRoaXMgYXMgYW55KS5fbGl2ZUZvb3RlciA9IG51bGxcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmVzIGlmIHRoZSBTZWFyY2hJbnB1dCBpcyBvcGVuL3Zpc2libGUuXG4gICAqIEByZXR1cm4ge0Jvb2xlYW59IC0gVHJ1ZSBpZiBvcGVuOyBvdGhlcndpc2UgZmFsc2UuXG4gICAqL1xuICBwdWJsaWMgaXNPcGVuKCkge1xuICAgIHJldHVybiB0aGlzLmhhc0NsYXNzKENMQVNTX09QRU4pXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGluaXQoKSB7XG4gIHNlYXJjaEFuZEluaXRpYWxpemU8SFRNTEVsZW1lbnQ+KFwiLnNlYXJjaC5zZWFyY2hfX2lucHV0XCIsIChlKSA9PiB7XG4gICAgbmV3IFNlYXJjaElucHV0KGUpXG4gIH0pXG59XG5cbmV4cG9ydCBkZWZhdWx0IFNlYXJjaElucHV0XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uLy4uLy4uIn0=
