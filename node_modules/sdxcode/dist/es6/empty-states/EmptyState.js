import * as tslib_1 from "tslib";
import { searchAndInitialize } from "../Utils";
import DomElement from "../DomElement";
import { parentWithClass, getRootElement } from "../DomFunctions";
var CLASS_BORDER = "empty-state__border";
var CLASS_BORDER_MODAL = "empty-state__border--modal";
var CLASS_ACTIVE = "is-active";
var CLASS_HASFILES = "has-files";
var CLASS_MODAL = "empty-state--modal";
var CLASS_MODAL_CONTENT = "modal__content";
var QUERY_MODAL_BODY = ".modal__body";
var QUERY_FILE = "input[type='file']";
/**
 * Empty state pattern
 */
var EmptyState = /** @class */ (function (_super) {
    tslib_1.__extends(EmptyState, _super);
    /**
     * Creates and initializes the Empty-State pattern component.
     * @param {DomElement} - root element of the empty-state pattern.
     */
    function EmptyState(element) {
        var _this = _super.call(this, element) || this;
        _this._fileInput = _this.element.querySelector(QUERY_FILE);
        _this._button = _this.element.querySelector("label");
        _this._fileChangedHandler = _this._handleFileChanged.bind(_this);
        _this._preventEventsHandler = _this._preventDragEvents.bind(_this);
        _this._dragEnterHandler = _this._handleDragEnter.bind(_this);
        _this._dragLeaveHandler = _this._handleDragLeave.bind(_this);
        _this._dropHandler = _this._handleDrop.bind(_this);
        _this._isDragging = false;
        _this._initialize();
        return _this;
    }
    EmptyState.prototype._initialize = function () {
        var e_1, _a;
        if (this.hasClass(CLASS_MODAL)) {
            // handle modal dialogs
            this._dragArea = parentWithClass(this.element, CLASS_MODAL_CONTENT);
            var borderArea = this._dragArea.querySelector(QUERY_MODAL_BODY);
            borderArea.setAttribute("style", "pointer-events: none;");
            this._border = new DomElement("div")
                .addClass(CLASS_BORDER)
                .addClass(CLASS_BORDER_MODAL);
            borderArea.appendChild(this._border.element);
        }
        else {
            // normal modal dialog
            this._dragArea = this.element;
            var borderArea = getRootElement();
            this._border = new DomElement("div")
                .addClass(CLASS_BORDER);
            if (!borderArea.querySelector("." + CLASS_BORDER)) {
                borderArea.appendChild(this._border.element);
            }
        }
        var form = this.element.querySelector("form");
        try {
            for (var _b = tslib_1.__values(["drag", "dragstart", "dragend", "dragover", "dragenter", "dragleave", "drop"]), _c = _b.next(); !_c.done; _c = _b.next()) {
                var event_1 = _c.value;
                this.element.addEventListener(event_1, this._preventEventsHandler);
                form.addEventListener(event_1, this._preventEventsHandler);
                this._dragArea.addEventListener(event_1, this._preventEventsHandler);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        this._dragArea.addEventListener("dragover", this._dragEnterHandler);
        this._dragArea.addEventListener("dragenter", this._dragEnterHandler);
        this._dragArea.addEventListener("dragleave", this._dragLeaveHandler);
        this._dragArea.addEventListener("dragend", this._dragLeaveHandler);
        this._dragArea.addEventListener("drop", this._dragLeaveHandler);
        this._dragArea.addEventListener("drop", this._dropHandler);
        this._fileInput.addEventListener("change", this._fileChangedHandler);
    };
    EmptyState.prototype._preventDragEvents = function (e) {
        e.preventDefault();
        e.stopPropagation();
        return false;
    };
    EmptyState.prototype._handleDragEnter = function () {
        if (this._isDragging === true) {
            return;
        }
        this._isDragging = true;
        this._button.setAttribute("style", "pointer-events: none;");
        this.addClass(CLASS_ACTIVE);
        this._border.addClass(CLASS_ACTIVE);
    };
    EmptyState.prototype._handleDragLeave = function () {
        if (this._isDragging === false) {
            return;
        }
        this._isDragging = false;
        this._button.setAttribute("style", "");
        this.removeClass(CLASS_ACTIVE);
        this._border.removeClass(CLASS_ACTIVE);
    };
    EmptyState.prototype._handleDrop = function (e) {
        var dragEvent = e;
        this._fileInput.files = dragEvent.dataTransfer.files;
    };
    EmptyState.prototype._handleFileChanged = function () {
        var files = this._fileInput.files;
        if (files && files.length > 0) {
            this.addClass(CLASS_HASFILES);
        }
        else {
            this.removeClass(CLASS_HASFILES);
        }
    };
    Object.defineProperty(EmptyState.prototype, "files", {
        /**
         * Gets the currently selected files.
         */
        get: function () {
            return this._fileInput.files;
        },
        enumerable: true,
        configurable: true
    });
    return EmptyState;
}(DomElement));
export function init() {
    searchAndInitialize(".empty-state", function (e) {
        new EmptyState(e);
    });
}
export default EmptyState;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4vc3JjL2VtcHR5LXN0YXRlcy9FbXB0eVN0YXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsTUFBTSxVQUFVLENBQUE7QUFDOUMsT0FBTyxVQUFVLE1BQU0sZUFBZSxDQUFBO0FBQ3RDLE9BQU8sRUFBRSxlQUFlLEVBQUUsY0FBYyxFQUFFLE1BQU0saUJBQWlCLENBQUE7QUFFakUsSUFBTSxZQUFZLEdBQUcscUJBQXFCLENBQUE7QUFDMUMsSUFBTSxrQkFBa0IsR0FBRyw0QkFBNEIsQ0FBQTtBQUN2RCxJQUFNLFlBQVksR0FBRyxXQUFXLENBQUE7QUFDaEMsSUFBTSxjQUFjLEdBQUcsV0FBVyxDQUFBO0FBQ2xDLElBQU0sV0FBVyxHQUFHLG9CQUFvQixDQUFBO0FBQ3hDLElBQU0sbUJBQW1CLEdBQUcsZ0JBQWdCLENBQUE7QUFFNUMsSUFBTSxnQkFBZ0IsR0FBRyxjQUFjLENBQUE7QUFDdkMsSUFBTSxVQUFVLEdBQUcsb0JBQW9CLENBQUE7QUFFdkM7O0dBRUc7QUFDSDtJQUF5QixzQ0FBVTtJQWdCakM7OztPQUdHO0lBQ0gsb0JBQVksT0FBZ0I7UUFBNUIsWUFDRSxrQkFBTSxPQUFPLENBQUMsU0FjZjtRQVpDLEtBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFzQixDQUFBO1FBQzdFLEtBQUksQ0FBQyxPQUFPLEdBQUcsS0FBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFFLENBQUE7UUFFbkQsS0FBSSxDQUFDLG1CQUFtQixHQUFHLEtBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLENBQUE7UUFDN0QsS0FBSSxDQUFDLHFCQUFxQixHQUFHLEtBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsS0FBSSxDQUFDLENBQUE7UUFDL0QsS0FBSSxDQUFDLGlCQUFpQixHQUFHLEtBQUksQ0FBQyxn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QUFNLFNBQVMsR0FBRyxDQUFjLENBQUE7UUFDL0IsSUFBSSxDQUFDLFVBQWtCLENBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQyxZQUFhLENBQUMsS0FBSyxDQUFBO0lBQ2hFLENBQUM7SUFFUyx1Q0FBa0IsR0FBNUI7UUFDRSxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQTtRQUVqQyxJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUM3QixJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxDQUFBO1NBQzlCO2FBQU07WUFDTCxJQUFJLENBQUMsV0FBVyxDQUFDLGNBQWMsQ0FBQyxDQUFBO1NBQ2pDO0lBQ0gsQ0FBQztJQUtELHNCQUFJLDZCQUFLO1FBSFQ7O1dBRUc7YUFDSDtZQUNFLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUE7UUFDOUIsQ0FBQzs7O09BQUE7SUFDSCxpQkFBQztBQUFELENBdElBLEFBc0lDLENBdEl3QixVQUFVLEdBc0lsQztBQUVELE1BQU0sVUFBVSxJQUFJO0lBQ2xCLG1CQUFtQixDQUFDLGNBQWMsRUFBRSxVQUFDLENBQUM7UUFDcEMsSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUE7SUFDbkIsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDO0FBRUQsZUFBZSxVQUFVLENBQUEiLCJmaWxlIjoibWFpbi9zcmMvZW1wdHktc3RhdGVzL0VtcHR5U3RhdGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzZWFyY2hBbmRJbml0aWFsaXplIH0gZnJvbSBcIi4uL1V0aWxzXCJcbmltcG9ydCBEb21FbGVtZW50IGZyb20gXCIuLi9Eb21FbGVtZW50XCJcbmltcG9ydCB7IHBhcmVudFdpdGhDbGFzcywgZ2V0Um9vdEVsZW1lbnQgfSBmcm9tIFwiLi4vRG9tRnVuY3Rpb25zXCJcblxuY29uc3QgQ0xBU1NfQk9SREVSID0gXCJlbXB0eS1zdGF0ZV9fYm9yZGVyXCJcbmNvbnN0IENMQVNTX0JPUkRFUl9NT0RBTCA9IFwiZW1wdHktc3RhdGVfX2JvcmRlci0tbW9kYWxcIlxuY29uc3QgQ0xBU1NfQUNUSVZFID0gXCJpcy1hY3RpdmVcIlxuY29uc3QgQ0xBU1NfSEFTRklMRVMgPSBcImhhcy1maWxlc1wiXG5jb25zdCBDTEFTU19NT0RBTCA9IFwiZW1wdHktc3RhdGUtLW1vZGFsXCJcbmNvbnN0IENMQVNTX01PREFMX0NPTlRFTlQgPSBcIm1vZGFsX19jb250ZW50XCJcblxuY29uc3QgUVVFUllfTU9EQUxfQk9EWSA9IFwiLm1vZGFsX19ib2R5XCJcbmNvbnN0IFFVRVJZX0ZJTEUgPSBcImlucHV0W3R5cGU9J2ZpbGUnXVwiXG5cbi8qKlxuICogRW1wdHkgc3RhdGUgcGF0dGVyblxuICovXG5jbGFzcyBFbXB0eVN0YXRlIGV4dGVuZHMgRG9tRWxlbWVudCB7XG4gIHByaXZhdGUgX2JvcmRlciE6IERvbUVsZW1lbnQ8SFRNTERpdkVsZW1lbnQ+XG5cbiAgcHJpdmF0ZSBfZmlsZUlucHV0OiBIVE1MSW5wdXRFbGVtZW50XG4gIHByaXZhdGUgX2J1dHRvbjogSFRNTExhYmVsRWxlbWVudFxuXG4gIHByaXZhdGUgX2RyYWdBcmVhITogRWxlbWVudFxuXG4gIHByaXZhdGUgX2ZpbGVDaGFuZ2VkSGFuZGxlcjogKGV2ZW50OiBFdmVudCkgPT4gdm9pZFxuICBwcml2YXRlIF9wcmV2ZW50RXZlbnRzSGFuZGxlcjogKGV2ZW50OiBFdmVudCkgPT4gdm9pZFxuICBwcml2YXRlIF9kcmFnRW50ZXJIYW5kbGVyOiAoZXZlbnQ6IEV2ZW50KSA9PiB2b2lkXG4gIHByaXZhdGUgX2RyYWdMZWF2ZUhhbmRsZXI6IChldmVudDogRXZlbnQpID0+IHZvaWRcbiAgcHJpdmF0ZSBfZHJvcEhhbmRsZXI6IChldmVudDogRXZlbnQpID0+IHZvaWRcblxuICBwcml2YXRlIF9pc0RyYWdnaW5nOiBib29sZWFuXG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYW5kIGluaXRpYWxpemVzIHRoZSBFbXB0eS1TdGF0ZSBwYXR0ZXJuIGNvbXBvbmVudC5cbiAgICogQHBhcmFtIHtEb21FbGVtZW50fSAtIHJvb3QgZWxlbWVudCBvZiB0aGUgZW1wdHktc3RhdGUgcGF0dGVybi5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGVsZW1lbnQ6IEVsZW1lbnQpIHtcbiAgICBzdXBlcihlbGVtZW50KVxuXG4gICAgdGhpcy5fZmlsZUlucHV0ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoUVVFUllfRklMRSkhIGFzIEhUTUxJbnB1dEVsZW1lbnRcbiAgICB0aGlzLl9idXR0b24gPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcImxhYmVsXCIpIVxuXG4gICAgdGhpcy5fZmlsZUNoYW5nZWRIYW5kbGVyID0gdGhpcy5faGFuZGxlRmlsZUNoYW5nZWQuYmluZCh0aGlzKVxuICAgIHRoaXMuX3ByZXZlbnRFdmVudHNIYW5kbGVyID0gdGhpcy5fcHJldmVudERyYWdFdmVudHMuYmluZCh0aGlzKVxuICAgIHRoaXMuX2RyYWdFbnRlckhhbmRsZXIgPSB0aGlzLl9oYW5kbGVEcmFnRW50ZXIuYmluZCh0aGlzKVxuICAgIHRoaXMuX2RyYWdMZWF2ZUhhbmRsZXIgPSB0aGlzLl9oYW5kbGVEcmFnTGVhdmUuYmluZCh0aGlzKVxuICAgIHRoaXMuX2Ryb3BIYW5kbGVyID0gdGhpcy5faGFuZGxlRHJvcC5iaW5kKHRoaXMpXG5cbiAgICB0aGlzLl9pc0RyYWdnaW5nID0gZmFsc2VcblxuICAgIHRoaXMuX2luaXRpYWxpemUoKVxuICB9XG5cbiAgcHJvdGVjdGVkIF9pbml0aWFsaXplKCkge1xuICAgIGlmICh0aGlzLmhhc0NsYXNzKENMQVNTX01PREFMKSkge1xuICAgICAgLy8gaGFuZGxlIG1vZGFsIGRpYWxvZ3NcbiAgICAgIHRoaXMuX2RyYWdBcmVhID0gcGFyZW50V2l0aENsYXNzKHRoaXMuZWxlbWVudCwgQ0xBU1NfTU9EQUxfQ09OVEVOVCkhXG4gICAgICBsZXQgYm9yZGVyQXJlYSA9IHRoaXMuX2RyYWdBcmVhLnF1ZXJ5U2VsZWN0b3IoUVVFUllfTU9EQUxfQk9EWSkhXG4gICAgICBib3JkZXJBcmVhLnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIFwicG9pbnRlci1ldmVudHM6IG5vbmU7XCIpXG5cbiAgICAgIHRoaXMuX2JvcmRlciA9IG5ldyBEb21FbGVtZW50PEhUTUxEaXZFbGVtZW50PihcImRpdlwiKVxuICAgICAgICAuYWRkQ2xhc3MoQ0xBU1NfQk9SREVSKVxuICAgICAgICAuYWRkQ2xhc3MoQ0xBU1NfQk9SREVSX01PREFMKVxuXG4gICAgICBib3JkZXJBcmVhLmFwcGVuZENoaWxkKHRoaXMuX2JvcmRlci5lbGVtZW50KVxuXG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIG5vcm1hbCBtb2RhbCBkaWFsb2dcbiAgICAgIHRoaXMuX2RyYWdBcmVhID0gdGhpcy5lbGVtZW50XG4gICAgICBsZXQgYm9yZGVyQXJlYSA9IGdldFJvb3RFbGVtZW50KClcblxuICAgICAgdGhpcy5fYm9yZGVyID0gbmV3IERvbUVsZW1lbnQ8SFRNTERpdkVsZW1lbnQ+KFwiZGl2XCIpXG4gICAgICAgIC5hZGRDbGFzcyhDTEFTU19CT1JERVIpXG5cbiAgICAgIGlmICghYm9yZGVyQXJlYS5xdWVyeVNlbGVjdG9yKGAuJHtDTEFTU19CT1JERVJ9YCkpIHtcbiAgICAgICAgYm9yZGVyQXJlYS5hcHBlbmRDaGlsZCh0aGlzLl9ib3JkZXIuZWxlbWVudClcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBmb3JtID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJmb3JtXCIpIVxuXG4gICAgZm9yIChsZXQgZXZlbnQgb2YgWyBcImRyYWdcIiwgXCJkcmFnc3RhcnRcIiwgXCJkcmFnZW5kXCIsIFwiZHJhZ292ZXJcIiwgXCJkcmFnZW50ZXJcIiwgXCJkcmFnbGVhdmVcIiwgXCJkcm9wXCIgXSkge1xuICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIHRoaXMuX3ByZXZlbnRFdmVudHNIYW5kbGVyKVxuICAgICAgZm9ybS5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCB0aGlzLl9wcmV2ZW50RXZlbnRzSGFuZGxlcilcbiAgICAgIHRoaXMuX2RyYWdBcmVhLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIHRoaXMuX3ByZXZlbnRFdmVudHNIYW5kbGVyKVxuICAgIH1cblxuICAgIHRoaXMuX2RyYWdBcmVhLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCB0aGlzLl9kcmFnRW50ZXJIYW5kbGVyKVxuICAgIHRoaXMuX2RyYWdBcmVhLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnZW50ZXJcIiwgdGhpcy5fZHJhZ0VudGVySGFuZGxlcilcblxuICAgIHRoaXMuX2RyYWdBcmVhLmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnbGVhdmVcIiwgdGhpcy5fZHJhZ0xlYXZlSGFuZGxlcilcbiAgICB0aGlzLl9kcmFnQXJlYS5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ2VuZFwiLCB0aGlzLl9kcmFnTGVhdmVIYW5kbGVyKVxuICAgIHRoaXMuX2RyYWdBcmVhLmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIHRoaXMuX2RyYWdMZWF2ZUhhbmRsZXIpXG5cbiAgICB0aGlzLl9kcmFnQXJlYS5hZGRFdmVudExpc3RlbmVyKFwiZHJvcFwiLCB0aGlzLl9kcm9wSGFuZGxlcilcbiAgICB0aGlzLl9maWxlSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCB0aGlzLl9maWxlQ2hhbmdlZEhhbmRsZXIpXG4gIH1cblxuICBwcm90ZWN0ZWQgX3ByZXZlbnREcmFnRXZlbnRzKGU6IEV2ZW50KSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuXG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICBwcm90ZWN0ZWQgX2hhbmRsZURyYWdFbnRlcigpIHtcbiAgICBpZiAodGhpcy5faXNEcmFnZ2luZyA9PT0gdHJ1ZSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgdGhpcy5faXNEcmFnZ2luZyA9IHRydWVcbiAgICB0aGlzLl9idXR0b24uc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJwb2ludGVyLWV2ZW50czogbm9uZTtcIilcblxuICAgIHRoaXMuYWRkQ2xhc3MoQ0xBU1NfQUNUSVZFKVxuICAgIHRoaXMuX2JvcmRlci5hZGRDbGFzcyhDTEFTU19BQ1RJVkUpXG4gIH1cblxuICBwcm90ZWN0ZWQgX2hhbmRsZURyYWdMZWF2ZSgpIHtcbiAgICBpZiAodGhpcy5faXNEcmFnZ2luZyA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHRoaXMuX2lzRHJhZ2dpbmcgPSBmYWxzZVxuICAgIHRoaXMuX2J1dHRvbi5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcIlwiKVxuXG4gICAgdGhpcy5yZW1vdmVDbGFzcyhDTEFTU19BQ1RJVkUpXG4gICAgdGhpcy5fYm9yZGVyLnJlbW92ZUNsYXNzKENMQVNTX0FDVElWRSlcbiAgfVxuXG4gIHByb3RlY3RlZCBfaGFuZGxlRHJvcChlOiBFdmVudCkge1xuICAgIGNvbnN0IGRyYWdFdmVudCA9IGUgYXMgRHJhZ0V2ZW50XG4gICAgKHRoaXMuX2ZpbGVJbnB1dCBhcyBhbnkpLmZpbGVzID0gZHJhZ0V2ZW50LmRhdGFUcmFuc2ZlciEuZmlsZXNcbiAgfVxuXG4gIHByb3RlY3RlZCBfaGFuZGxlRmlsZUNoYW5nZWQoKSB7XG4gICAgbGV0IGZpbGVzID0gdGhpcy5fZmlsZUlucHV0LmZpbGVzXG5cbiAgICBpZiAoZmlsZXMgJiYgZmlsZXMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5hZGRDbGFzcyhDTEFTU19IQVNGSUxFUylcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yZW1vdmVDbGFzcyhDTEFTU19IQVNGSUxFUylcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgY3VycmVudGx5IHNlbGVjdGVkIGZpbGVzLlxuICAgKi9cbiAgZ2V0IGZpbGVzKCkge1xuICAgIHJldHVybiB0aGlzLl9maWxlSW5wdXQuZmlsZXNcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaW5pdCgpIHtcbiAgc2VhcmNoQW5kSW5pdGlhbGl6ZShcIi5lbXB0eS1zdGF0ZVwiLCAoZSkgPT4ge1xuICAgIG5ldyBFbXB0eVN0YXRlKGUpXG4gIH0pXG59XG5cbmV4cG9ydCBkZWZhdWx0IEVtcHR5U3RhdGVcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4vLi4ifQ==
